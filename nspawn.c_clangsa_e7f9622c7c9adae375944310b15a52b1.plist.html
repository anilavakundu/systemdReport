<!DOCTYPE html>
<html>
  <head>
    <title>Plist HTML Viewer</title>

    <meta charset="UTF-8">

    <style type="text/css">
      .CodeMirror{font-family:monospace;height:300px;color:#000;direction:ltr}.CodeMirror-lines{padding:4px 0}.CodeMirror pre{padding:0 4px}.CodeMirror-gutter-filler,.CodeMirror-scrollbar-filler{background-color:#fff}.CodeMirror-gutters{border-right:1px solid #ddd;background-color:#f7f7f7;white-space:nowrap}.CodeMirror-linenumber{padding:0 3px 0 5px;min-width:20px;text-align:right;color:#999;white-space:nowrap}.CodeMirror-guttermarker{color:#000}.CodeMirror-guttermarker-subtle{color:#999}.CodeMirror-cursor{border-left:1px solid #000;border-right:none;width:0}.CodeMirror div.CodeMirror-secondarycursor{border-left:1px solid silver}.cm-fat-cursor .CodeMirror-cursor{width:auto;border:0!important;background:#7e7}.cm-fat-cursor div.CodeMirror-cursors{z-index:1}.cm-animate-fat-cursor{width:auto;border:0;-webkit-animation:blink 1.06s steps(1) infinite;-moz-animation:blink 1.06s steps(1) infinite;animation:blink 1.06s steps(1) infinite;background-color:#7e7}@-moz-keyframes blink{50%{background-color:transparent}}@-webkit-keyframes blink{50%{background-color:transparent}}@keyframes blink{50%{background-color:transparent}}.cm-tab{display:inline-block;text-decoration:inherit}.CodeMirror-rulers{position:absolute;left:0;right:0;top:-50px;bottom:-20px;overflow:hidden}.CodeMirror-ruler{border-left:1px solid #ccc;top:0;bottom:0;position:absolute}.cm-s-default .cm-header{color:#00f}.cm-s-default .cm-quote{color:#090}.cm-negative{color:#d44}.cm-positive{color:#292}.cm-header,.cm-strong{font-weight:700}.cm-em{font-style:italic}.cm-link{text-decoration:underline}.cm-strikethrough{text-decoration:line-through}.cm-s-default .cm-keyword{color:#708}.cm-s-default .cm-atom{color:#219}.cm-s-default .cm-number{color:#164}.cm-s-default .cm-def{color:#00f}.cm-s-default .cm-variable-2{color:#05a}.cm-s-default .cm-type,.cm-s-default .cm-variable-3{color:#085}.cm-s-default .cm-comment{color:#a50}.cm-s-default .cm-string{color:#a11}.cm-s-default .cm-string-2{color:#f50}.cm-s-default .cm-meta{color:#555}.cm-s-default .cm-qualifier{color:#555}.cm-s-default .cm-builtin{color:#30a}.cm-s-default .cm-bracket{color:#997}.cm-s-default .cm-tag{color:#170}.cm-s-default .cm-attribute{color:#00c}.cm-s-default .cm-hr{color:#999}.cm-s-default .cm-link{color:#00c}.cm-s-default .cm-error{color:red}.cm-invalidchar{color:red}.CodeMirror-composing{border-bottom:2px solid}div.CodeMirror span.CodeMirror-matchingbracket{color:#0f0}div.CodeMirror span.CodeMirror-nonmatchingbracket{color:#f22}.CodeMirror-matchingtag{background:rgba(255,150,0,.3)}.CodeMirror-activeline-background{background:#e8f2ff}.CodeMirror{position:relative;overflow:hidden;background:#fff}.CodeMirror-scroll{overflow:scroll!important;margin-bottom:-30px;margin-right:-30px;padding-bottom:30px;height:100%;outline:0;position:relative}.CodeMirror-sizer{position:relative;border-right:30px solid transparent}.CodeMirror-gutter-filler,.CodeMirror-hscrollbar,.CodeMirror-scrollbar-filler,.CodeMirror-vscrollbar{position:absolute;z-index:6;display:none}.CodeMirror-vscrollbar{right:0;top:0;overflow-x:hidden;overflow-y:scroll}.CodeMirror-hscrollbar{bottom:0;left:0;overflow-y:hidden;overflow-x:scroll}.CodeMirror-scrollbar-filler{right:0;bottom:0}.CodeMirror-gutter-filler{left:0;bottom:0}.CodeMirror-gutters{position:absolute;left:0;top:0;min-height:100%;z-index:3}.CodeMirror-gutter{white-space:normal;height:100%;display:inline-block;vertical-align:top;margin-bottom:-30px}.CodeMirror-gutter-wrapper{position:absolute;z-index:4;background:0 0!important;border:none!important}.CodeMirror-gutter-background{position:absolute;top:0;bottom:0;z-index:4}.CodeMirror-gutter-elt{position:absolute;cursor:default;z-index:4}.CodeMirror-gutter-wrapper ::selection{background-color:transparent}.CodeMirror-gutter-wrapper ::-moz-selection{background-color:transparent}.CodeMirror-lines{cursor:text;min-height:1px}.CodeMirror pre{-moz-border-radius:0;-webkit-border-radius:0;border-radius:0;border-width:0;background:0 0;font-family:inherit;font-size:inherit;margin:0;white-space:pre;word-wrap:normal;line-height:inherit;color:inherit;z-index:2;position:relative;overflow:visible;-webkit-tap-highlight-color:transparent;-webkit-font-variant-ligatures:contextual;font-variant-ligatures:contextual}.CodeMirror-wrap pre{word-wrap:break-word;white-space:pre-wrap;word-break:normal}.CodeMirror-linebackground{position:absolute;left:0;right:0;top:0;bottom:0;z-index:0}.CodeMirror-linewidget{position:relative;z-index:2;overflow:auto}.CodeMirror-rtl pre{direction:rtl}.CodeMirror-code{outline:0}.CodeMirror-gutter,.CodeMirror-gutters,.CodeMirror-linenumber,.CodeMirror-scroll,.CodeMirror-sizer{-moz-box-sizing:content-box;box-sizing:content-box}.CodeMirror-measure{position:absolute;width:100%;height:0;overflow:hidden;visibility:hidden}.CodeMirror-cursor{position:absolute;pointer-events:none}.CodeMirror-measure pre{position:static}div.CodeMirror-cursors{visibility:hidden;position:relative;z-index:3}div.CodeMirror-dragcursors{visibility:visible}.CodeMirror-focused div.CodeMirror-cursors{visibility:visible}.CodeMirror-selected{background:#d9d9d9}.CodeMirror-focused .CodeMirror-selected{background:#d7d4f0}.CodeMirror-crosshair{cursor:crosshair}.CodeMirror-line::selection,.CodeMirror-line>span::selection,.CodeMirror-line>span>span::selection{background:#d7d4f0}.CodeMirror-line::-moz-selection,.CodeMirror-line>span::-moz-selection,.CodeMirror-line>span>span::-moz-selection{background:#d7d4f0}.cm-searching{background-color:#ffa;background-color:rgba(255,255,0,.4)}.cm-force-border{padding-right:.1px}@media print{.CodeMirror div.CodeMirror-cursors{visibility:hidden}}.cm-tab-wrap-hack:after{content:''}span.CodeMirror-selectedtext{background:0 0}
/*# sourceMappingURL=codemirror.min.css.map */

      .severity-low {
  background-color: #669603;
}

.severity-low:after {
  content : 'L';
}

.severity-unspecified {
  background-color: #666666;
}

.severity-unspecified:after {
  content : 'U';
}

.severity-style {
  background-color: #9932cc;
}

.severity-style:after {
  content : 'S';
}

.severity-medium {
  background-color: #a9d323;
  color: black;
}

.severity-medium:after {
  content : 'M';
}

.severity-high {
  background-color: #ffa800;
}

.severity-high:after {
  content : 'H';
}

.severity-critical {
  background-color: #e92625;
}

.severity-critical:after {
  content : 'C';
}

i[class*="severity-"] {
  line-height: normal;
  text-transform: capitalize;
  font-size: 0.8em;
  font-weight: bold;
  color: white;
  display: inline-block;
  width: 16px;
  height: 16px;
  text-align: center;
  font-family: sans-serif;
}

      html, body {
  width: 100%;
  height: 100%;
  padding: 0px;
  margin: 0px;
}

div.container {
  padding: 10px;
}

#content {
  height: 100%;
  display: block;
  overflow: hidden;
}

#content > div {
  margin: 10px;
  overflow: hidden;
  border: 1px solid #ddd;
  border-radius: 3px;
  overflow: hidden;
  height: 97%;
}

.button {
  background-color: #f1f1f1;
  text-decoration: none;
  display: inline-block;
  padding: 8px 16px;
  color: black;
  cursor: pointer;
}

.button:hover {
  background-color: #ddd;
  color: black;
}

.review-status {
  color: white;
  text-align: center;
}

.review-status-confirmed {
  background-color: #e92625;
}

.review-status-false-positive {
  background-color: grey;
}

.review-status-intentional {
  background-color: #669603;
}

      div.container {
  width: 100%;
  height: 100%;
  padding: 0px;
}

#editor-wrapper {
  margin: 10px;
}

#side-bar {
  float: left;
  width: 260px;
  margin: 0px;
}

#report-nav ul {
  list-style-type: none;
  padding: 0;
  margin: 0;
  overflow-y: auto;
  height: 100%;
}

#report-nav ul > li {
  padding: .4em;
  background-color: #fff;
  border-bottom: 1px solid rgba(0,0,0,.125);
  text-align: left;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

#report-nav ul > li.active {
  background-color: #427ea9;
  color: white;
}

#report-nav ul > li:hover {
  background-color: #427ea9;
  color: white;
  cursor: pointer;
}

#report-nav ul a {
  text-decoration: none;
}

#report-nav i[class*="severity-"] {
  margin-right: 5px;
}

.header {
  border-bottom: 1px solid lightgrey;
  font-family: monospace;
  padding: 10px;
  background-color: #fafbfc;
  border-bottom: 1px solid #e1e4e8;
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}

#report-nav .header {
  font-weight: bold;
}

#editor-wrapper .header > div {
  padding-top: 2px;
}

#file-path,
#checker-name {
  color: #195ea2;
}

#review-status {
  padding: 0px 5px;
}

#file-path {
  font-family: monospace;
}

.check-msg {
  display: inline-block;
  padding: 3px 6px;
  margin: 1px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
}

.check-msg.info {
  color: #00546f;
  background-color: #bfdfe9;
  border: 1px solid #87a8b3;
}

.check-msg.error {
  background-color: #f2dede;
  color: #a94442;
  border: 1px solid #ebcccc;
}

.check-msg.macro {
  background-color: #d7dac2;
  color: #4f5c6d;
  border: 1px solid #d7dac2;
}

.check-msg.note {
  background-color: #d7d7d7;
  color: #4f5c6d;
  border: 1px solid #bfbfbf;
}

.check-msg.current {
  border: 2px dashed #3692ff;
}

.check-msg .tag {
  padding: 1px 5px;
  text-align: center;
  border-radius: 2px;
  margin-right: 5px;
  text-decoration: inherit;
}

.check-msg .tag.macro {
  background-color: #83876a;
  color: white;
  text-transform: capitalize;
}

.check-msg .tag.note {
  background-color: #9299a1;
  color: white;
  text-transform: capitalize;
}

.checker-enum {
  color: white;
  padding: 1px 5px;
  text-align: center;
  border-radius: 25px;
  margin-right: 5px;
  text-decoration: inherit;
}

.checker-enum.info {
  background-color: #427ea9;
}

.checker-enum.error {
  background-color: #a94442;
}

.arrow {
  border: solid black;
  border-width: 0 3px 3px 0;
  display: inline-block;
  padding: 3px;
  cursor: pointer;
  margin: 0px 5px;
}

.arrow:hover {
  border: solid #437ea8;
  border-width: 0 3px 3px 0;
}

.left-arrow {
  transform: rotate(135deg);
  -webkit-transform: rotate(135deg);
}

.right-arrow {
  transform: rotate(-45deg);
  -webkit-transform: rotate(-45deg);
}

    </style>

    <script type="text/javascript">
      function setNonCompatibleBrowserMessage() {
  document.body.innerHTML =
    '<h2 style="margin-left: 20px;">Your browser is not compatible with CodeChecker Viewer!</h2> \
     <p style="margin-left: 20px;">The version required for the following browsers are:</p> \
     <ul style="margin-left: 20px;"> \
     <li>Internet Explorer: version 9 or newer</li> \
     <li>Firefox: version 22.0 or newer</li> \
     </ul>';
}

// http://stackoverflow.com/questions/5916900/how-can-you-detect-the-version-of-a-browser
var browserVersion = (function(){
  var ua = navigator.userAgent, tem,
    M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];

  if (/trident/i.test(M[1])) {
    tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
    return 'IE ' + (tem[1] || '');
  }

  if (M[1] === 'Chrome') {
    tem = ua.match(/\b(OPR|Edge)\/(\d+)/);
    if (tem != null) return tem.slice(1).join(' ').replace('OPR', 'Opera');
  }

  M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, '-?'];
  if ((tem = ua.match(/version\/(\d+)/i)) != null) M.splice(1, 1, tem[1]);
    return M.join(' ');
})();

var pos = browserVersion.indexOf(' ');
var browser = browserVersion.substr(0, pos);
var version = parseInt(browserVersion.substr(pos + 1));

var browserCompatible
  = browser === 'Firefox'
  ? version >= 22
  : browser === 'IE'
  ? version >= 9
  : true;


      /* MIT License

Copyright (C) 2017 by Marijn Haverbeke <marijnh@gmail.com> and others

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
 */
      !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.CodeMirror=t()}(this,function(){"use strict";function e(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}function t(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function r(e,r){return t(e).appendChild(r)}function n(e,t,r,n){var i=document.createElement(e);if(r&&(i.className=r),n&&(i.style.cssText=n),"string"==typeof t)i.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)i.appendChild(t[o]);return i}function i(e,t,r,i){var o=n(e,t,r,i);return o.setAttribute("role","presentation"),o}function o(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function l(){var e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function s(t,r){var n=t.className;e(r).test(n)||(t.className+=(n?" ":"")+r)}function a(t,r){for(var n=t.split(" "),i=0;i<n.length;i++)n[i]&&!e(n[i]).test(r)&&(r+=" "+n[i]);return r}function u(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function c(e,t,r){t||(t={});for(var n in e)!e.hasOwnProperty(n)||!1===r&&t.hasOwnProperty(n)||(t[n]=e[n]);return t}function f(e,t,r,n,i){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var o=n||0,l=i||0;;){var s=e.indexOf("\t",o);if(s<0||s>=t)return l+(t-o);l+=s-o,l+=r-l%r,o=s+1}}function h(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return r;return-1}function d(e,t,r){for(var n=0,i=0;;){var o=e.indexOf("\t",n);-1==o&&(o=e.length);var l=o-n;if(o==e.length||i+l>=t)return n+Math.min(l,t-i);if(i+=o-n,i+=r-i%r,n=o+1,i>=t)return n}}function p(e){for(;Kl.length<=e;)Kl.push(g(Kl)+" ");return Kl[e]}function g(e){return e[e.length-1]}function v(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=t(e[n],n);return r}function m(e,t,r){for(var n=0,i=r(t);n<e.length&&r(e[n])<=i;)n++;e.splice(n,0,t)}function y(){}function b(e,t){var r;return Object.create?r=Object.create(e):(y.prototype=e,r=new y),t&&c(t,r),r}function w(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||jl.test(e))}function x(e,t){return t?!!(t.source.indexOf("\\w")>-1&&w(e))||t.test(e):w(e)}function C(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function S(e){return e.charCodeAt(0)>=768&&Xl.test(e)}function L(e,t,r){for(;(r<0?t>0:t<e.length)&&S(e.charAt(t));)t+=r;return t}function k(e,t,r){for(var n=t>r?-1:1;;){if(t==r)return t;var i=(t+r)/2,o=n<0?Math.ceil(i):Math.floor(i);if(o==t)return e(o)?t:r;e(o)?r=o:t=o+n}}function T(e,t,r){var o=this;this.input=r,o.scrollbarFiller=n("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=n("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=i("div",null,"CodeMirror-code"),o.selectionDiv=n("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=n("div",null,"CodeMirror-cursors"),o.measure=n("div",null,"CodeMirror-measure"),o.lineMeasure=n("div",null,"CodeMirror-measure"),o.lineSpace=i("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var l=i("div",[o.lineSpace],"CodeMirror-lines");o.mover=n("div",[l],null,"position: relative"),o.sizer=n("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=n("div",null,null,"position: absolute; height: "+Rl+"px; width: 1px;"),o.gutters=n("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=n("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=n("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),gl&&vl<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),ml||fl&&Tl||(o.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(o.wrapper):e(o.wrapper)),o.viewFrom=o.viewTo=t.first,o.reportedViewFrom=o.reportedViewTo=t.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,r.init(o)}function M(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var r=e;!r.lines;)for(var n=0;;++n){var i=r.children[n],o=i.chunkSize();if(t<o){r=i;break}t-=o}return r.lines[t]}function N(e,t,r){var n=[],i=t.line;return e.iter(t.line,r.line+1,function(e){var o=e.text;i==r.line&&(o=o.slice(0,r.ch)),i==t.line&&(o=o.slice(t.ch)),n.push(o),++i}),n}function O(e,t,r){var n=[];return e.iter(t,r,function(e){n.push(e.text)}),n}function A(e,t){var r=t-e.height;if(r)for(var n=e;n;n=n.parent)n.height+=r}function W(e){if(null==e.parent)return null;for(var t=e.parent,r=h(t.lines,e),n=t.parent;n;t=n,n=n.parent)for(var i=0;n.children[i]!=t;++i)r+=n.children[i].chunkSize();return r+t.first}function D(e,t){var r=e.first;e:do{for(var n=0;n<e.children.length;++n){var i=e.children[n],o=i.height;if(t<o){e=i;continue e}t-=o,r+=i.chunkSize()}return r}while(!e.lines);for(var l=0;l<e.lines.length;++l){var s=e.lines[l].height;if(t<s)break;t-=s}return r+l}function H(e,t){return t>=e.first&&t<e.first+e.size}function F(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function E(e,t,r){if(void 0===r&&(r=null),!(this instanceof E))return new E(e,t,r);this.line=e,this.ch=t,this.sticky=r}function P(e,t){return e.line-t.line||e.ch-t.ch}function I(e,t){return e.sticky==t.sticky&&0==P(e,t)}function z(e){return E(e.line,e.ch)}function R(e,t){return P(e,t)<0?t:e}function B(e,t){return P(e,t)<0?e:t}function G(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function U(e,t){if(t.line<e.first)return E(e.first,0);var r=e.first+e.size-1;return t.line>r?E(r,M(e,r).text.length):V(t,M(e,t.line).text.length)}function V(e,t){var r=e.ch;return null==r||r>t?E(e.line,t):r<0?E(e.line,0):e}function K(e,t){for(var r=[],n=0;n<t.length;n++)r[n]=U(e,t[n]);return r}function j(){Yl=!0}function X(){_l=!0}function Y(e,t,r){this.marker=e,this.from=t,this.to=r}function _(e,t){if(e)for(var r=0;r<e.length;++r){var n=e[r];if(n.marker==t)return n}}function $(e,t){for(var r,n=0;n<e.length;++n)e[n]!=t&&(r||(r=[])).push(e[n]);return r}function q(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}function Z(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],l=o.marker;if(null==o.from||(l.inclusiveLeft?o.from<=t:o.from<t)||o.from==t&&"bookmark"==l.type&&(!r||!o.marker.insertLeft)){var s=null==o.to||(l.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new Y(l,o.from,s?null:o.to))}}return n}function Q(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],l=o.marker;if(null==o.to||(l.inclusiveRight?o.to>=t:o.to>t)||o.from==t&&"bookmark"==l.type&&(!r||o.marker.insertLeft)){var s=null==o.from||(l.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new Y(l,s?null:o.from-t,null==o.to?null:o.to-t))}}return n}function J(e,t){if(t.full)return null;var r=H(e,t.from.line)&&M(e,t.from.line).markedSpans,n=H(e,t.to.line)&&M(e,t.to.line).markedSpans;if(!r&&!n)return null;var i=t.from.ch,o=t.to.ch,l=0==P(t.from,t.to),s=Z(r,i,l),a=Q(n,o,l),u=1==t.text.length,c=g(t.text).length+(u?i:0);if(s)for(var f=0;f<s.length;++f){var h=s[f];if(null==h.to){var d=_(a,h.marker);d?u&&(h.to=null==d.to?null:d.to+c):h.to=i}}if(a)for(var p=0;p<a.length;++p){var v=a[p];null!=v.to&&(v.to+=c),null==v.from?_(s,v.marker)||(v.from=c,u&&(s||(s=[])).push(v)):(v.from+=c,u&&(s||(s=[])).push(v))}s&&(s=ee(s)),a&&a!=s&&(a=ee(a));var m=[s];if(!u){var y,b=t.text.length-2;if(b>0&&s)for(var w=0;w<s.length;++w)null==s[w].to&&(y||(y=[])).push(new Y(s[w].marker,null,null));for(var x=0;x<b;++x)m.push(y);m.push(a)}return m}function ee(e){for(var t=0;t<e.length;++t){var r=e[t];null!=r.from&&r.from==r.to&&!1!==r.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function te(e,t,r){var n=null;if(e.iter(t.line,r.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var r=e.markedSpans[t].marker;!r.readOnly||n&&-1!=h(n,r)||(n||(n=[])).push(r)}}),!n)return null;for(var i=[{from:t,to:r}],o=0;o<n.length;++o)for(var l=n[o],s=l.find(0),a=0;a<i.length;++a){var u=i[a];if(!(P(u.to,s.from)<0||P(u.from,s.to)>0)){var c=[a,1],f=P(u.from,s.from),d=P(u.to,s.to);(f<0||!l.inclusiveLeft&&!f)&&c.push({from:u.from,to:s.from}),(d>0||!l.inclusiveRight&&!d)&&c.push({from:s.to,to:u.to}),i.splice.apply(i,c),a+=c.length-3}}return i}function re(e){var t=e.markedSpans;if(t){for(var r=0;r<t.length;++r)t[r].marker.detachLine(e);e.markedSpans=null}}function ne(e,t){if(t){for(var r=0;r<t.length;++r)t[r].marker.attachLine(e);e.markedSpans=t}}function ie(e){return e.inclusiveLeft?-1:0}function oe(e){return e.inclusiveRight?1:0}function le(e,t){var r=e.lines.length-t.lines.length;if(0!=r)return r;var n=e.find(),i=t.find(),o=P(n.from,i.from)||ie(e)-ie(t);if(o)return-o;var l=P(n.to,i.to)||oe(e)-oe(t);return l||t.id-e.id}function se(e,t){var r,n=_l&&e.markedSpans;if(n)for(var i=void 0,o=0;o<n.length;++o)(i=n[o]).marker.collapsed&&null==(t?i.from:i.to)&&(!r||le(r,i.marker)<0)&&(r=i.marker);return r}function ae(e){return se(e,!0)}function ue(e){return se(e,!1)}function ce(e,t,r,n,i){var o=M(e,t),l=_l&&o.markedSpans;if(l)for(var s=0;s<l.length;++s){var a=l[s];if(a.marker.collapsed){var u=a.marker.find(0),c=P(u.from,r)||ie(a.marker)-ie(i),f=P(u.to,n)||oe(a.marker)-oe(i);if(!(c>=0&&f<=0||c<=0&&f>=0)&&(c<=0&&(a.marker.inclusiveRight&&i.inclusiveLeft?P(u.to,r)>=0:P(u.to,r)>0)||c>=0&&(a.marker.inclusiveRight&&i.inclusiveLeft?P(u.from,n)<=0:P(u.from,n)<0)))return!0}}}function fe(e){for(var t;t=ae(e);)e=t.find(-1,!0).line;return e}function he(e){for(var t;t=ue(e);)e=t.find(1,!0).line;return e}function de(e){for(var t,r;t=ue(e);)e=t.find(1,!0).line,(r||(r=[])).push(e);return r}function pe(e,t){var r=M(e,t),n=fe(r);return r==n?t:W(n)}function ge(e,t){if(t>e.lastLine())return t;var r,n=M(e,t);if(!ve(e,n))return t;for(;r=ue(n);)n=r.find(1,!0).line;return W(n)+1}function ve(e,t){var r=_l&&t.markedSpans;if(r)for(var n=void 0,i=0;i<r.length;++i)if((n=r[i]).marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&me(e,t,n))return!0}}function me(e,t,r){if(null==r.to){var n=r.marker.find(1,!0);return me(e,n.line,_(n.line.markedSpans,r.marker))}if(r.marker.inclusiveRight&&r.to==t.text.length)return!0;for(var i=void 0,o=0;o<t.markedSpans.length;++o)if((i=t.markedSpans[o]).marker.collapsed&&!i.marker.widgetNode&&i.from==r.to&&(null==i.to||i.to!=r.from)&&(i.marker.inclusiveLeft||r.marker.inclusiveRight)&&me(e,t,i))return!0}function ye(e){for(var t=0,r=(e=fe(e)).parent,n=0;n<r.lines.length;++n){var i=r.lines[n];if(i==e)break;t+=i.height}for(var o=r.parent;o;r=o,o=r.parent)for(var l=0;l<o.children.length;++l){var s=o.children[l];if(s==r)break;t+=s.height}return t}function be(e){if(0==e.height)return 0;for(var t,r=e.text.length,n=e;t=ae(n);){var i=t.find(0,!0);n=i.from.line,r+=i.from.ch-i.to.ch}for(n=e;t=ue(n);){var o=t.find(0,!0);r-=n.text.length-o.from.ch,r+=(n=o.to.line).text.length-o.to.ch}return r}function we(e){var t=e.display,r=e.doc;t.maxLine=M(r,r.first),t.maxLineLength=be(t.maxLine),t.maxLineChanged=!0,r.iter(function(e){var r=be(e);r>t.maxLineLength&&(t.maxLineLength=r,t.maxLine=e)})}function xe(e,t,r,n){if(!e)return n(t,r,"ltr",0);for(var i=!1,o=0;o<e.length;++o){var l=e[o];(l.from<r&&l.to>t||t==r&&l.to==t)&&(n(Math.max(l.from,t),Math.min(l.to,r),1==l.level?"rtl":"ltr",o),i=!0)}i||n(t,r,"ltr")}function Ce(e,t,r){var n;$l=null;for(var i=0;i<e.length;++i){var o=e[i];if(o.from<t&&o.to>t)return i;o.to==t&&(o.from!=o.to&&"before"==r?n=i:$l=i),o.from==t&&(o.from!=o.to&&"before"!=r?n=i:$l=i)}return null!=n?n:$l}function Se(e,t){var r=e.order;return null==r&&(r=e.order=ql(e.text,t)),r}function Le(e,t){return e._handlers&&e._handlers[t]||Zl}function ke(e,t,r){if(e.removeEventListener)e.removeEventListener(t,r,!1);else if(e.detachEvent)e.detachEvent("on"+t,r);else{var n=e._handlers,i=n&&n[t];if(i){var o=h(i,r);o>-1&&(n[t]=i.slice(0,o).concat(i.slice(o+1)))}}}function Te(e,t){var r=Le(e,t);if(r.length)for(var n=Array.prototype.slice.call(arguments,2),i=0;i<r.length;++i)r[i].apply(null,n)}function Me(e,t,r){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),Te(e,r||t.type,e,t),He(t)||t.codemirrorIgnore}function Ne(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var r=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),n=0;n<t.length;++n)-1==h(r,t[n])&&r.push(t[n])}function Oe(e,t){return Le(e,t).length>0}function Ae(e){e.prototype.on=function(e,t){Ql(this,e,t)},e.prototype.off=function(e,t){ke(this,e,t)}}function We(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function De(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function He(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function Fe(e){We(e),De(e)}function Ee(e){return e.target||e.srcElement}function Pe(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),Ml&&e.ctrlKey&&1==t&&(t=3),t}function Ie(e){if(null==Il){var t=n("span","​");r(e,n("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Il=t.offsetWidth<=1&&t.offsetHeight>2&&!(gl&&vl<8))}var i=Il?n("span","​"):n("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return i.setAttribute("cm-text",""),i}function ze(e){if(null!=zl)return zl;var n=r(e,document.createTextNode("AخA")),i=Wl(n,0,1).getBoundingClientRect(),o=Wl(n,1,2).getBoundingClientRect();return t(e),!(!i||i.left==i.right)&&(zl=o.right-i.right<3)}function Re(e){if(null!=ns)return ns;var t=r(e,n("span","x")),i=t.getBoundingClientRect(),o=Wl(t,0,1).getBoundingClientRect();return ns=Math.abs(i.left-o.left)>1}function Be(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),is[e]=t}function Ge(e){if("string"==typeof e&&os.hasOwnProperty(e))e=os[e];else if(e&&"string"==typeof e.name&&os.hasOwnProperty(e.name)){var t=os[e.name];"string"==typeof t&&(t={name:t}),(e=b(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Ge("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Ge("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function Ue(e,t){t=Ge(t);var r=is[t.name];if(!r)return Ue(e,"text/plain");var n=r(e,t);if(ls.hasOwnProperty(t.name)){var i=ls[t.name];for(var o in i)i.hasOwnProperty(o)&&(n.hasOwnProperty(o)&&(n["_"+o]=n[o]),n[o]=i[o])}if(n.name=t.name,t.helperType&&(n.helperType=t.helperType),t.modeProps)for(var l in t.modeProps)n[l]=t.modeProps[l];return n}function Ve(e,t){c(t,ls.hasOwnProperty(e)?ls[e]:ls[e]={})}function Ke(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var r={};for(var n in t){var i=t[n];i instanceof Array&&(i=i.concat([])),r[n]=i}return r}function je(e,t){for(var r;e.innerMode&&(r=e.innerMode(t))&&r.mode!=e;)t=r.state,e=r.mode;return r||{mode:e,state:t}}function Xe(e,t,r){return!e.startState||e.startState(t,r)}function Ye(e,t,r,n){var i=[e.state.modeGen],o={};tt(e,t.text,e.doc.mode,r,function(e,t){return i.push(e,t)},o,n);for(var l=r.state,s=0;s<e.state.overlays.length;++s)!function(n){var l=e.state.overlays[n],s=1,a=0;r.state=!0,tt(e,t.text,l.mode,r,function(e,t){for(var r=s;a<e;){var n=i[s];n>e&&i.splice(s,1,e,i[s+1],n),s+=2,a=Math.min(e,n)}if(t)if(l.opaque)i.splice(r,s-r,e,"overlay "+t),s=r+2;else for(;r<s;r+=2){var o=i[r+1];i[r+1]=(o?o+" ":"")+"overlay "+t}},o)}(s);return r.state=l,{styles:i,classes:o.bgClass||o.textClass?o:null}}function _e(e,t,r){if(!t.styles||t.styles[0]!=e.state.modeGen){var n=$e(e,W(t)),i=t.text.length>e.options.maxHighlightLength&&Ke(e.doc.mode,n.state),o=Ye(e,t,n);i&&(n.state=i),t.stateAfter=n.save(!i),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),r===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function $e(e,t,r){var n=e.doc,i=e.display;if(!n.mode.startState)return new us(n,!0,t);var o=rt(e,t,r),l=o>n.first&&M(n,o-1).stateAfter,s=l?us.fromSaved(n,l,o):new us(n,Xe(n.mode),o);return n.iter(o,t,function(r){qe(e,r.text,s);var n=s.line;r.stateAfter=n==t-1||n%5==0||n>=i.viewFrom&&n<i.viewTo?s.save():null,s.nextLine()}),r&&(n.modeFrontier=s.line),s}function qe(e,t,r,n){var i=e.doc.mode,o=new ss(t,e.options.tabSize,r);for(o.start=o.pos=n||0,""==t&&Ze(i,r.state);!o.eol();)Qe(i,o,r.state),o.start=o.pos}function Ze(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var r=je(e,t);return r.mode.blankLine?r.mode.blankLine(r.state):void 0}}function Qe(e,t,r,n){for(var i=0;i<10;i++){n&&(n[0]=je(e,r).mode);var o=e.token(t,r);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}function Je(e,t,r,n){var i,o,l=e.doc,s=l.mode,a=M(l,(t=U(l,t)).line),u=$e(e,t.line,r),c=new ss(a.text,e.options.tabSize,u);for(n&&(o=[]);(n||c.pos<t.ch)&&!c.eol();)c.start=c.pos,i=Qe(s,c,u.state),n&&o.push(new cs(c,i,Ke(l.mode,u.state)));return n?o:new cs(c,i,u.state)}function et(e,t){if(e)for(;;){var r=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!r)break;e=e.slice(0,r.index)+e.slice(r.index+r[0].length);var n=r[1]?"bgClass":"textClass";null==t[n]?t[n]=r[2]:new RegExp("(?:^|s)"+r[2]+"(?:$|s)").test(t[n])||(t[n]+=" "+r[2])}return e}function tt(e,t,r,n,i,o,l){var s=r.flattenSpans;null==s&&(s=e.options.flattenSpans);var a,u=0,c=null,f=new ss(t,e.options.tabSize,n),h=e.options.addModeClass&&[null];for(""==t&&et(Ze(r,n.state),o);!f.eol();){if(f.pos>e.options.maxHighlightLength?(s=!1,l&&qe(e,t,n,f.pos),f.pos=t.length,a=null):a=et(Qe(r,f,n.state,h),o),h){var d=h[0].name;d&&(a="m-"+(a?d+" "+a:d))}if(!s||c!=a){for(;u<f.start;)i(u=Math.min(f.start,u+5e3),c);c=a}f.start=f.pos}for(;u<f.pos;){var p=Math.min(f.pos,u+5e3);i(p,c),u=p}}function rt(e,t,r){for(var n,i,o=e.doc,l=r?-1:t-(e.doc.mode.innerMode?1e3:100),s=t;s>l;--s){if(s<=o.first)return o.first;var a=M(o,s-1),u=a.stateAfter;if(u&&(!r||s+(u instanceof as?u.lookAhead:0)<=o.modeFrontier))return s;var c=f(a.text,null,e.options.tabSize);(null==i||n>c)&&(i=s-1,n=c)}return i}function nt(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var r=e.first,n=t-1;n>r;n--){var i=M(e,n).stateAfter;if(i&&(!(i instanceof as)||n+i.lookAhead<t)){r=n+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,r)}}function it(e,t,r,n){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),re(e),ne(e,r);var i=n?n(e):1;i!=e.height&&A(e,i)}function ot(e){e.parent=null,re(e)}function lt(e,t){if(!e||/^\s*$/.test(e))return null;var r=t.addModeClass?ps:ds;return r[e]||(r[e]=e.replace(/\S+/g,"cm-$&"))}function st(e,t){var r=i("span",null,null,ml?"padding-right: .1px":null),n={pre:i("pre",[r],"CodeMirror-line"),content:r,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:(gl||ml)&&e.getOption("lineWrapping")};t.measure={};for(var o=0;o<=(t.rest?t.rest.length:0);o++){var l=o?t.rest[o-1]:t.line,s=void 0;n.pos=0,n.addToken=ut,ze(e.display.measure)&&(s=Se(l,e.doc.direction))&&(n.addToken=ft(n.addToken,s)),n.map=[],dt(l,n,_e(e,l,t!=e.display.externalMeasured&&W(l))),l.styleClasses&&(l.styleClasses.bgClass&&(n.bgClass=a(l.styleClasses.bgClass,n.bgClass||"")),l.styleClasses.textClass&&(n.textClass=a(l.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild(Ie(e.display.measure))),0==o?(t.measure.map=n.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(n.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(ml){var u=n.content.lastChild;(/\bcm-tab\b/.test(u.className)||u.querySelector&&u.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return Te(e,"renderLine",e,t.line,n.pre),n.pre.className&&(n.textClass=a(n.pre.className,n.textClass||"")),n}function at(e){var t=n("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function ut(e,t,r,i,o,l,s){if(t){var a,u=e.splitSpaces?ct(t,e.trailingSpace):t,c=e.cm.state.specialChars,f=!1;if(c.test(t)){a=document.createDocumentFragment();for(var h=0;;){c.lastIndex=h;var d=c.exec(t),g=d?d.index-h:t.length-h;if(g){var v=document.createTextNode(u.slice(h,h+g));gl&&vl<9?a.appendChild(n("span",[v])):a.appendChild(v),e.map.push(e.pos,e.pos+g,v),e.col+=g,e.pos+=g}if(!d)break;h+=g+1;var m=void 0;if("\t"==d[0]){var y=e.cm.options.tabSize,b=y-e.col%y;(m=a.appendChild(n("span",p(b),"cm-tab"))).setAttribute("role","presentation"),m.setAttribute("cm-text","\t"),e.col+=b}else"\r"==d[0]||"\n"==d[0]?((m=a.appendChild(n("span","\r"==d[0]?"␍":"␤","cm-invalidchar"))).setAttribute("cm-text",d[0]),e.col+=1):((m=e.cm.options.specialCharPlaceholder(d[0])).setAttribute("cm-text",d[0]),gl&&vl<9?a.appendChild(n("span",[m])):a.appendChild(m),e.col+=1);e.map.push(e.pos,e.pos+1,m),e.pos++}}else e.col+=t.length,a=document.createTextNode(u),e.map.push(e.pos,e.pos+t.length,a),gl&&vl<9&&(f=!0),e.pos+=t.length;if(e.trailingSpace=32==u.charCodeAt(t.length-1),r||i||o||f||s){var w=r||"";i&&(w+=i),o&&(w+=o);var x=n("span",[a],w,s);return l&&(x.title=l),e.content.appendChild(x)}e.content.appendChild(a)}}function ct(e,t){if(e.length>1&&!/  /.test(e))return e;for(var r=t,n="",i=0;i<e.length;i++){var o=e.charAt(i);" "!=o||!r||i!=e.length-1&&32!=e.charCodeAt(i+1)||(o=" "),n+=o,r=" "==o}return n}function ft(e,t){return function(r,n,i,o,l,s,a){i=i?i+" cm-force-border":"cm-force-border";for(var u=r.pos,c=u+n.length;;){for(var f=void 0,h=0;h<t.length&&!((f=t[h]).to>u&&f.from<=u);h++);if(f.to>=c)return e(r,n,i,o,l,s,a);e(r,n.slice(0,f.to-u),i,o,null,s,a),o=null,n=n.slice(f.to-u),u=f.to}}}function ht(e,t,r,n){var i=!n&&r.widgetNode;i&&e.map.push(e.pos,e.pos+t,i),!n&&e.cm.display.input.needsContentAttribute&&(i||(i=e.content.appendChild(document.createElement("span"))),i.setAttribute("cm-marker",r.id)),i&&(e.cm.display.input.setUneditable(i),e.content.appendChild(i)),e.pos+=t,e.trailingSpace=!1}function dt(e,t,r){var n=e.markedSpans,i=e.text,o=0;if(n)for(var l,s,a,u,c,f,h,d=i.length,p=0,g=1,v="",m=0;;){if(m==p){a=u=c=f=s="",h=null,m=1/0;for(var y=[],b=void 0,w=0;w<n.length;++w){var x=n[w],C=x.marker;"bookmark"==C.type&&x.from==p&&C.widgetNode?y.push(C):x.from<=p&&(null==x.to||x.to>p||C.collapsed&&x.to==p&&x.from==p)?(null!=x.to&&x.to!=p&&m>x.to&&(m=x.to,u=""),C.className&&(a+=" "+C.className),C.css&&(s=(s?s+";":"")+C.css),C.startStyle&&x.from==p&&(c+=" "+C.startStyle),C.endStyle&&x.to==m&&(b||(b=[])).push(C.endStyle,x.to),C.title&&!f&&(f=C.title),C.collapsed&&(!h||le(h.marker,C)<0)&&(h=x)):x.from>p&&m>x.from&&(m=x.from)}if(b)for(var S=0;S<b.length;S+=2)b[S+1]==m&&(u+=" "+b[S]);if(!h||h.from==p)for(var L=0;L<y.length;++L)ht(t,0,y[L]);if(h&&(h.from||0)==p){if(ht(t,(null==h.to?d+1:h.to)-p,h.marker,null==h.from),null==h.to)return;h.to==p&&(h=!1)}}if(p>=d)break;for(var k=Math.min(d,m);;){if(v){var T=p+v.length;if(!h){var M=T>k?v.slice(0,k-p):v;t.addToken(t,M,l?l+a:a,c,p+M.length==m?u:"",f,s)}if(T>=k){v=v.slice(k-p),p=k;break}p=T,c=""}v=i.slice(o,o=r[g++]),l=lt(r[g++],t.cm.options)}}else for(var N=1;N<r.length;N+=2)t.addToken(t,i.slice(o,o=r[N]),lt(r[N+1],t.cm.options))}function pt(e,t,r){this.line=t,this.rest=de(t),this.size=this.rest?W(g(this.rest))-r+1:1,this.node=this.text=null,this.hidden=ve(e,t)}function gt(e,t,r){for(var n,i=[],o=t;o<r;o=n){var l=new pt(e.doc,M(e.doc,o),o);n=o+l.size,i.push(l)}return i}function vt(e){gs?gs.ops.push(e):e.ownsGroup=gs={ops:[e],delayedCallbacks:[]}}function mt(e){var t=e.delayedCallbacks,r=0;do{for(;r<t.length;r++)t[r].call(null);for(var n=0;n<e.ops.length;n++){var i=e.ops[n];if(i.cursorActivityHandlers)for(;i.cursorActivityCalled<i.cursorActivityHandlers.length;)i.cursorActivityHandlers[i.cursorActivityCalled++].call(null,i.cm)}}while(r<t.length)}function yt(e,t){var r=e.ownsGroup;if(r)try{mt(r)}finally{gs=null,t(r)}}function bt(e,t){var r=Le(e,t);if(r.length){var n,i=Array.prototype.slice.call(arguments,2);gs?n=gs.delayedCallbacks:vs?n=vs:(n=vs=[],setTimeout(wt,0));for(var o=0;o<r.length;++o)!function(e){n.push(function(){return r[e].apply(null,i)})}(o)}}function wt(){var e=vs;vs=null;for(var t=0;t<e.length;++t)e[t]()}function xt(e,t,r,n){for(var i=0;i<t.changes.length;i++){var o=t.changes[i];"text"==o?kt(e,t):"gutter"==o?Mt(e,t,r,n):"class"==o?Tt(e,t):"widget"==o&&Nt(e,t,n)}t.changes=null}function Ct(e){return e.node==e.text&&(e.node=n("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),gl&&vl<8&&(e.node.style.zIndex=2)),e.node}function St(e,t){var r=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(r&&(r+=" CodeMirror-linebackground"),t.background)r?t.background.className=r:(t.background.parentNode.removeChild(t.background),t.background=null);else if(r){var i=Ct(t);t.background=i.insertBefore(n("div",null,r),i.firstChild),e.display.input.setUneditable(t.background)}}function Lt(e,t){var r=e.display.externalMeasured;return r&&r.line==t.line?(e.display.externalMeasured=null,t.measure=r.measure,r.built):st(e,t)}function kt(e,t){var r=t.text.className,n=Lt(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,Tt(e,t)):r&&(t.text.className=r)}function Tt(e,t){St(e,t),t.line.wrapClass?Ct(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var r=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=r||""}function Mt(e,t,r,i){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var o=Ct(t);t.gutterBackground=n("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px; width: "+i.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),o.insertBefore(t.gutterBackground,t.text)}var l=t.line.gutterMarkers;if(e.options.lineNumbers||l){var s=Ct(t),a=t.gutter=n("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px");if(e.display.input.setUneditable(a),s.insertBefore(a,t.text),t.line.gutterClass&&(a.className+=" "+t.line.gutterClass),!e.options.lineNumbers||l&&l["CodeMirror-linenumbers"]||(t.lineNumber=a.appendChild(n("div",F(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+i.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),l)for(var u=0;u<e.options.gutters.length;++u){var c=e.options.gutters[u],f=l.hasOwnProperty(c)&&l[c];f&&a.appendChild(n("div",[f],"CodeMirror-gutter-elt","left: "+i.gutterLeft[c]+"px; width: "+i.gutterWidth[c]+"px"))}}}function Nt(e,t,r){t.alignable&&(t.alignable=null);for(var n=t.node.firstChild,i=void 0;n;n=i)i=n.nextSibling,"CodeMirror-linewidget"==n.className&&t.node.removeChild(n);At(e,t,r)}function Ot(e,t,r,n){var i=Lt(e,t);return t.text=t.node=i.pre,i.bgClass&&(t.bgClass=i.bgClass),i.textClass&&(t.textClass=i.textClass),Tt(e,t),Mt(e,t,r,n),At(e,t,n),t.node}function At(e,t,r){if(Wt(e,t.line,t,r,!0),t.rest)for(var n=0;n<t.rest.length;n++)Wt(e,t.rest[n],t,r,!1)}function Wt(e,t,r,i,o){if(t.widgets)for(var l=Ct(r),s=0,a=t.widgets;s<a.length;++s){var u=a[s],c=n("div",[u.node],"CodeMirror-linewidget");u.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),Dt(u,c,r,i),e.display.input.setUneditable(c),o&&u.above?l.insertBefore(c,r.gutter||r.text):l.appendChild(c),bt(u,"redraw")}}function Dt(e,t,r,n){if(e.noHScroll){(r.alignable||(r.alignable=[])).push(t);var i=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(i-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=i+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}function Ht(e){if(null!=e.height)return e.height;var t=e.doc.cm;if(!t)return 0;if(!o(document.body,e.node)){var i="position: relative;";e.coverGutter&&(i+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(i+="width: "+t.display.wrapper.clientWidth+"px;"),r(t.display.measure,n("div",[e.node],null,i))}return e.height=e.node.parentNode.offsetHeight}function Ft(e,t){for(var r=Ee(t);r!=e.wrapper;r=r.parentNode)if(!r||1==r.nodeType&&"true"==r.getAttribute("cm-ignore-events")||r.parentNode==e.sizer&&r!=e.mover)return!0}function Et(e){return e.lineSpace.offsetTop}function Pt(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function It(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=r(e.measure,n("pre","x")),i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,o={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(o.left)||isNaN(o.right)||(e.cachedPaddingH=o),o}function zt(e){return Rl-e.display.nativeBarWidth}function Rt(e){return e.display.scroller.clientWidth-zt(e)-e.display.barWidth}function Bt(e){return e.display.scroller.clientHeight-zt(e)-e.display.barHeight}function Gt(e,t,r){var n=e.options.lineWrapping,i=n&&Rt(e);if(!t.measure.heights||n&&t.measure.width!=i){var o=t.measure.heights=[];if(n){t.measure.width=i;for(var l=t.text.firstChild.getClientRects(),s=0;s<l.length-1;s++){var a=l[s],u=l[s+1];Math.abs(a.bottom-u.bottom)>2&&o.push((a.bottom+u.top)/2-r.top)}}o.push(r.bottom-r.top)}}function Ut(e,t,r){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var n=0;n<e.rest.length;n++)if(e.rest[n]==t)return{map:e.measure.maps[n],cache:e.measure.caches[n]};for(var i=0;i<e.rest.length;i++)if(W(e.rest[i])>r)return{map:e.measure.maps[i],cache:e.measure.caches[i],before:!0}}function Vt(e,t){var n=W(t=fe(t)),i=e.display.externalMeasured=new pt(e.doc,t,n);i.lineN=n;var o=i.built=st(e,i);return i.text=o.pre,r(e.display.lineMeasure,o.pre),i}function Kt(e,t,r,n){return Yt(e,Xt(e,t),r,n)}function jt(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[Lr(e,t)];var r=e.display.externalMeasured;return r&&t>=r.lineN&&t<r.lineN+r.size?r:void 0}function Xt(e,t){var r=W(t),n=jt(e,r);n&&!n.text?n=null:n&&n.changes&&(xt(e,n,r,br(e)),e.curOp.forceUpdate=!0),n||(n=Vt(e,t));var i=Ut(n,t,r);return{line:t,view:n,rect:null,map:i.map,cache:i.cache,before:i.before,hasHeights:!1}}function Yt(e,t,r,n,i){t.before&&(r=-1);var o,l=r+(n||"");return t.cache.hasOwnProperty(l)?o=t.cache[l]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(Gt(e,t.view,t.rect),t.hasHeights=!0),(o=qt(e,t,r,n)).bogus||(t.cache[l]=o)),{left:o.left,right:o.right,top:i?o.rtop:o.top,bottom:i?o.rbottom:o.bottom}}function _t(e,t,r){for(var n,i,o,l,s,a,u=0;u<e.length;u+=3)if(s=e[u],a=e[u+1],t<s?(i=0,o=1,l="left"):t<a?o=(i=t-s)+1:(u==e.length-3||t==a&&e[u+3]>t)&&(i=(o=a-s)-1,t>=a&&(l="right")),null!=i){if(n=e[u+2],s==a&&r==(n.insertLeft?"left":"right")&&(l=r),"left"==r&&0==i)for(;u&&e[u-2]==e[u-3]&&e[u-1].insertLeft;)n=e[2+(u-=3)],l="left";if("right"==r&&i==a-s)for(;u<e.length-3&&e[u+3]==e[u+4]&&!e[u+5].insertLeft;)n=e[(u+=3)+2],l="right";break}return{node:n,start:i,end:o,collapse:l,coverStart:s,coverEnd:a}}function $t(e,t){var r=ms;if("left"==t)for(var n=0;n<e.length&&(r=e[n]).left==r.right;n++);else for(var i=e.length-1;i>=0&&(r=e[i]).left==r.right;i--);return r}function qt(e,t,r,n){var i,o=_t(t.map,r,n),l=o.node,s=o.start,a=o.end,u=o.collapse;if(3==l.nodeType){for(var c=0;c<4;c++){for(;s&&S(t.line.text.charAt(o.coverStart+s));)--s;for(;o.coverStart+a<o.coverEnd&&S(t.line.text.charAt(o.coverStart+a));)++a;if((i=gl&&vl<9&&0==s&&a==o.coverEnd-o.coverStart?l.parentNode.getBoundingClientRect():$t(Wl(l,s,a).getClientRects(),n)).left||i.right||0==s)break;a=s,s-=1,u="right"}gl&&vl<11&&(i=Zt(e.display.measure,i))}else{s>0&&(u=n="right");var f;i=e.options.lineWrapping&&(f=l.getClientRects()).length>1?f["right"==n?f.length-1:0]:l.getBoundingClientRect()}if(gl&&vl<9&&!s&&(!i||!i.left&&!i.right)){var h=l.parentNode.getClientRects()[0];i=h?{left:h.left,right:h.left+yr(e.display),top:h.top,bottom:h.bottom}:ms}for(var d=i.top-t.rect.top,p=i.bottom-t.rect.top,g=(d+p)/2,v=t.view.measure.heights,m=0;m<v.length-1&&!(g<v[m]);m++);var y=m?v[m-1]:0,b=v[m],w={left:("right"==u?i.right:i.left)-t.rect.left,right:("left"==u?i.left:i.right)-t.rect.left,top:y,bottom:b};return i.left||i.right||(w.bogus=!0),e.options.singleCursorHeightPerLine||(w.rtop=d,w.rbottom=p),w}function Zt(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!Re(e))return t;var r=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*r,right:t.right*r,top:t.top*n,bottom:t.bottom*n}}function Qt(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function Jt(e){e.display.externalMeasure=null,t(e.display.lineMeasure);for(var r=0;r<e.display.view.length;r++)Qt(e.display.view[r])}function er(e){Jt(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function tr(){return bl&&kl?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function rr(){return bl&&kl?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function nr(e){var t=0;if(e.widgets)for(var r=0;r<e.widgets.length;++r)e.widgets[r].above&&(t+=Ht(e.widgets[r]));return t}function ir(e,t,r,n,i){if(!i){var o=nr(t);r.top+=o,r.bottom+=o}if("line"==n)return r;n||(n="local");var l=ye(t);if("local"==n?l+=Et(e.display):l-=e.display.viewOffset,"page"==n||"window"==n){var s=e.display.lineSpace.getBoundingClientRect();l+=s.top+("window"==n?0:rr());var a=s.left+("window"==n?0:tr());r.left+=a,r.right+=a}return r.top+=l,r.bottom+=l,r}function or(e,t,r){if("div"==r)return t;var n=t.left,i=t.top;if("page"==r)n-=tr(),i-=rr();else if("local"==r||!r){var o=e.display.sizer.getBoundingClientRect();n+=o.left,i+=o.top}var l=e.display.lineSpace.getBoundingClientRect();return{left:n-l.left,top:i-l.top}}function lr(e,t,r,n,i){return n||(n=M(e.doc,t.line)),ir(e,n,Kt(e,n,t.ch,i),r)}function sr(e,t,r,n,i,o){function l(t,l){var s=Yt(e,i,t,l?"right":"left",o);return l?s.left=s.right:s.right=s.left,ir(e,n,s,r)}function s(e,t,r){var n=1==a[t].level;return l(r?e-1:e,n!=r)}n=n||M(e.doc,t.line),i||(i=Xt(e,n));var a=Se(n,e.doc.direction),u=t.ch,c=t.sticky;if(u>=n.text.length?(u=n.text.length,c="before"):u<=0&&(u=0,c="after"),!a)return l("before"==c?u-1:u,"before"==c);var f=Ce(a,u,c),h=$l,d=s(u,f,"before"==c);return null!=h&&(d.other=s(u,h,"before"!=c)),d}function ar(e,t){var r=0;t=U(e.doc,t),e.options.lineWrapping||(r=yr(e.display)*t.ch);var n=M(e.doc,t.line),i=ye(n)+Et(e.display);return{left:r,right:r,top:i,bottom:i+n.height}}function ur(e,t,r,n,i){var o=E(e,t,r);return o.xRel=i,n&&(o.outside=!0),o}function cr(e,t,r){var n=e.doc;if((r+=e.display.viewOffset)<0)return ur(n.first,0,null,!0,-1);var i=D(n,r),o=n.first+n.size-1;if(i>o)return ur(n.first+n.size-1,M(n,o).text.length,null,!0,1);t<0&&(t=0);for(var l=M(n,i);;){var s=pr(e,l,i,t,r),a=ue(l),u=a&&a.find(0,!0);if(!a||!(s.ch>u.from.ch||s.ch==u.from.ch&&s.xRel>0))return s;i=W(l=u.to.line)}}function fr(e,t,r,n){n-=nr(t);var i=t.text.length,o=k(function(t){return Yt(e,r,t-1).bottom<=n},i,0);return i=k(function(t){return Yt(e,r,t).top>n},o,i),{begin:o,end:i}}function hr(e,t,r,n){return r||(r=Xt(e,t)),fr(e,t,r,ir(e,t,Yt(e,r,n),"line").top)}function dr(e,t,r,n){return!(e.bottom<=r)&&(e.top>r||(n?e.left:e.right)>t)}function pr(e,t,r,n,i){i-=ye(t);var o=Xt(e,t),l=nr(t),s=0,a=t.text.length,u=!0,c=Se(t,e.doc.direction);if(c){var f=(e.options.lineWrapping?vr:gr)(e,t,r,o,c,n,i);s=(u=1!=f.level)?f.from:f.to-1,a=u?f.to:f.from-1}var h,d,p=null,g=null,v=k(function(t){var r=Yt(e,o,t);return r.top+=l,r.bottom+=l,!!dr(r,n,i,!1)&&(r.top<=i&&r.left<=n&&(p=t,g=r),!0)},s,a),m=!1;if(g){var y=n-g.left<g.right-n,b=y==u;v=p+(b?0:1),d=b?"after":"before",h=y?g.left:g.right}else{u||v!=a&&v!=s||v++,d=0==v?"after":v==t.text.length?"before":Yt(e,o,v-(u?1:0)).bottom+l<=i==u?"after":"before";var w=sr(e,E(r,v,d),"line",t,o);h=w.left,m=i<w.top||i>=w.bottom}return v=L(t.text,v,1),ur(r,v,d,m,n-h)}function gr(e,t,r,n,i,o,l){var s=k(function(s){var a=i[s],u=1!=a.level;return dr(sr(e,E(r,u?a.to:a.from,u?"before":"after"),"line",t,n),o,l,!0)},0,i.length-1),a=i[s];if(s>0){var u=1!=a.level,c=sr(e,E(r,u?a.from:a.to,u?"after":"before"),"line",t,n);dr(c,o,l,!0)&&c.top>l&&(a=i[s-1])}return a}function vr(e,t,r,n,i,o,l){for(var s=fr(e,t,n,l),a=s.begin,u=s.end,c=null,f=null,h=0;h<i.length;h++){var d=i[h];if(!(d.from>=u||d.to<=a)){var p=Yt(e,n,1!=d.level?Math.min(u,d.to)-1:Math.max(a,d.from)).right,g=p<o?o-p+1e9:p-o;(!c||f>g)&&(c=d,f=g)}}return c||(c=i[i.length-1]),c.from<a&&(c={from:a,to:c.to,level:c.level}),c.to>u&&(c={from:c.from,to:u,level:c.level}),c}function mr(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==hs){hs=n("pre");for(var i=0;i<49;++i)hs.appendChild(document.createTextNode("x")),hs.appendChild(n("br"));hs.appendChild(document.createTextNode("x"))}r(e.measure,hs);var o=hs.offsetHeight/50;return o>3&&(e.cachedTextHeight=o),t(e.measure),o||1}function yr(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=n("span","xxxxxxxxxx"),i=n("pre",[t]);r(e.measure,i);var o=t.getBoundingClientRect(),l=(o.right-o.left)/10;return l>2&&(e.cachedCharWidth=l),l||10}function br(e){for(var t=e.display,r={},n={},i=t.gutters.clientLeft,o=t.gutters.firstChild,l=0;o;o=o.nextSibling,++l)r[e.options.gutters[l]]=o.offsetLeft+o.clientLeft+i,n[e.options.gutters[l]]=o.clientWidth;return{fixedPos:wr(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:r,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function wr(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function xr(e){var t=mr(e.display),r=e.options.lineWrapping,n=r&&Math.max(5,e.display.scroller.clientWidth/yr(e.display)-3);return function(i){if(ve(e.doc,i))return 0;var o=0;if(i.widgets)for(var l=0;l<i.widgets.length;l++)i.widgets[l].height&&(o+=i.widgets[l].height);return r?o+(Math.ceil(i.text.length/n)||1)*t:o+t}}function Cr(e){var t=e.doc,r=xr(e);t.iter(function(e){var t=r(e);t!=e.height&&A(e,t)})}function Sr(e,t,r,n){var i=e.display;if(!r&&"true"==Ee(t).getAttribute("cm-not-content"))return null;var o,l,s=i.lineSpace.getBoundingClientRect();try{o=t.clientX-s.left,l=t.clientY-s.top}catch(t){return null}var a,u=cr(e,o,l);if(n&&1==u.xRel&&(a=M(e.doc,u.line).text).length==u.ch){var c=f(a,a.length,e.options.tabSize)-a.length;u=E(u.line,Math.max(0,Math.round((o-It(e.display).left)/yr(e.display))-c))}return u}function Lr(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var r=e.display.view,n=0;n<r.length;n++)if((t-=r[n].size)<0)return n}function kr(e){e.display.input.showSelection(e.display.input.prepareSelection())}function Tr(e,t){void 0===t&&(t=!0);for(var r=e.doc,n={},i=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),l=0;l<r.sel.ranges.length;l++)if(t||l!=r.sel.primIndex){var s=r.sel.ranges[l];if(!(s.from().line>=e.display.viewTo||s.to().line<e.display.viewFrom)){var a=s.empty();(a||e.options.showCursorWhenSelecting)&&Mr(e,s.head,i),a||Or(e,s,o)}}return n}function Mr(e,t,r){var i=sr(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),o=r.appendChild(n("div"," ","CodeMirror-cursor"));if(o.style.left=i.left+"px",o.style.top=i.top+"px",o.style.height=Math.max(0,i.bottom-i.top)*e.options.cursorHeight+"px",i.other){var l=r.appendChild(n("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));l.style.display="",l.style.left=i.other.left+"px",l.style.top=i.other.top+"px",l.style.height=.85*(i.other.bottom-i.other.top)+"px"}}function Nr(e,t){return e.top-t.top||e.left-t.left}function Or(e,t,r){function i(e,t,r,i){t<0&&(t=0),t=Math.round(t),i=Math.round(i),a.appendChild(n("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==r?f-e:r)+"px;\n                             height: "+(i-t)+"px"))}function o(t,r,n){function o(r,n){return lr(e,E(t,r),"div",u,n)}var l,a,u=M(s,t),h=u.text.length,d=Se(u,s.direction);return xe(d,r||0,null==n?h:n,function(t,s,p,g){var v=o(t,"ltr"==p?"left":"right"),m=o(s-1,"ltr"==p?"right":"left");if("ltr"==p){var y=null==r&&0==t?c:v.left,b=null==n&&s==h?f:m.right;m.top-v.top<=3?i(y,m.top,b-y,m.bottom):(i(y,v.top,null,v.bottom),v.bottom<m.top&&i(c,v.bottom,null,m.top),i(c,m.top,m.right,m.bottom))}else if(t<s){var w=null==r&&0==t?f:v.right,x=null==n&&s==h?c:m.left;if(m.top-v.top<=3)i(x,m.top,w-x,m.bottom);else{var C=c;if(g){var S=hr(e,u,null,t).end;C=o(S-(/\s/.test(u.text.charAt(S-1))?2:1),"left").left}i(C,v.top,w-C,v.bottom),v.bottom<m.top&&i(c,v.bottom,null,m.top);var L=null;d.length,L=o(hr(e,u,null,s).begin,"right").right-x,i(x,m.top,L,m.bottom)}}(!l||Nr(v,l)<0)&&(l=v),Nr(m,l)<0&&(l=m),(!a||Nr(v,a)<0)&&(a=v),Nr(m,a)<0&&(a=m)}),{start:l,end:a}}var l=e.display,s=e.doc,a=document.createDocumentFragment(),u=It(e.display),c=u.left,f=Math.max(l.sizerWidth,Rt(e)-l.sizer.offsetLeft)-u.right,h=t.from(),d=t.to();if(h.line==d.line)o(h.line,h.ch,d.ch);else{var p=M(s,h.line),g=M(s,d.line),v=fe(p)==fe(g),m=o(h.line,h.ch,v?p.text.length+1:null).end,y=o(d.line,v?0:null,d.ch).start;v&&(m.top<y.top-2?(i(m.right,m.top,null,m.bottom),i(c,y.top,y.left,y.bottom)):i(m.right,m.top,y.left-m.right,m.bottom)),m.bottom<y.top&&i(c,m.bottom,null,y.top)}r.appendChild(a)}function Ar(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var r=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval(function(){return t.cursorDiv.style.visibility=(r=!r)?"":"hidden"},e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function Wr(e){e.state.focused||(e.display.input.focus(),Hr(e))}function Dr(e){e.state.delayingBlurEvent=!0,setTimeout(function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,Fr(e))},100)}function Hr(e,t){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(Te(e,"focus",e,t),e.state.focused=!0,s(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),ml&&setTimeout(function(){return e.display.input.reset(!0)},20)),e.display.input.receivedFocus()),Ar(e))}function Fr(e,t){e.state.delayingBlurEvent||(e.state.focused&&(Te(e,"blur",e,t),e.state.focused=!1,Fl(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150))}function Er(e){for(var t=e.display,r=t.lineDiv.offsetTop,n=0;n<t.view.length;n++){var i=t.view[n],o=void 0;if(!i.hidden){if(gl&&vl<8){var l=i.node.offsetTop+i.node.offsetHeight;o=l-r,r=l}else{var s=i.node.getBoundingClientRect();o=s.bottom-s.top}var a=i.line.height-o;if(o<2&&(o=mr(t)),(a>.005||a<-.005)&&(A(i.line,o),Pr(i.line),i.rest))for(var u=0;u<i.rest.length;u++)Pr(i.rest[u])}}}function Pr(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.parentNode.offsetHeight}function Ir(e,t,r){var n=r&&null!=r.top?Math.max(0,r.top):e.scroller.scrollTop;n=Math.floor(n-Et(e));var i=r&&null!=r.bottom?r.bottom:n+e.wrapper.clientHeight,o=D(t,n),l=D(t,i);if(r&&r.ensure){var s=r.ensure.from.line,a=r.ensure.to.line;s<o?(o=s,l=D(t,ye(M(t,s))+e.wrapper.clientHeight)):Math.min(a,t.lastLine())>=l&&(o=D(t,ye(M(t,a))-e.wrapper.clientHeight),l=a)}return{from:o,to:Math.max(l,o+1)}}function zr(e){var t=e.display,r=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var n=wr(t)-t.scroller.scrollLeft+e.doc.scrollLeft,i=t.gutters.offsetWidth,o=n+"px",l=0;l<r.length;l++)if(!r[l].hidden){e.options.fixedGutter&&(r[l].gutter&&(r[l].gutter.style.left=o),r[l].gutterBackground&&(r[l].gutterBackground.style.left=o));var s=r[l].alignable;if(s)for(var a=0;a<s.length;a++)s[a].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=n+i+"px")}}function Rr(e){if(!e.options.lineNumbers)return!1;var t=e.doc,r=F(e.options,t.first+t.size-1),i=e.display;if(r.length!=i.lineNumChars){var o=i.measure.appendChild(n("div",[n("div",r)],"CodeMirror-linenumber CodeMirror-gutter-elt")),l=o.firstChild.offsetWidth,s=o.offsetWidth-l;return i.lineGutter.style.width="",i.lineNumInnerWidth=Math.max(l,i.lineGutter.offsetWidth-s)+1,i.lineNumWidth=i.lineNumInnerWidth+s,i.lineNumChars=i.lineNumInnerWidth?r.length:-1,i.lineGutter.style.width=i.lineNumWidth+"px",Wn(e),!0}return!1}function Br(e,t){if(!Me(e,"scrollCursorIntoView")){var r=e.display,i=r.sizer.getBoundingClientRect(),o=null;if(t.top+i.top<0?o=!0:t.bottom+i.top>(window.innerHeight||document.documentElement.clientHeight)&&(o=!1),null!=o&&!Sl){var l=n("div","​",null,"position: absolute;\n                         top: "+(t.top-r.viewOffset-Et(e.display))+"px;\n                         height: "+(t.bottom-t.top+zt(e)+r.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(l),l.scrollIntoView(o),e.display.lineSpace.removeChild(l)}}}function Gr(e,t,r,n){null==n&&(n=0);var i;e.options.lineWrapping||t!=r||(r="before"==(t=t.ch?E(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t).sticky?E(t.line,t.ch+1,"before"):t);for(var o=0;o<5;o++){var l=!1,s=sr(e,t),a=r&&r!=t?sr(e,r):s,u=Vr(e,i={left:Math.min(s.left,a.left),top:Math.min(s.top,a.top)-n,right:Math.max(s.left,a.left),bottom:Math.max(s.bottom,a.bottom)+n}),c=e.doc.scrollTop,f=e.doc.scrollLeft;if(null!=u.scrollTop&&(qr(e,u.scrollTop),Math.abs(e.doc.scrollTop-c)>1&&(l=!0)),null!=u.scrollLeft&&(Qr(e,u.scrollLeft),Math.abs(e.doc.scrollLeft-f)>1&&(l=!0)),!l)break}return i}function Ur(e,t){var r=Vr(e,t);null!=r.scrollTop&&qr(e,r.scrollTop),null!=r.scrollLeft&&Qr(e,r.scrollLeft)}function Vr(e,t){var r=e.display,n=mr(e.display);t.top<0&&(t.top=0);var i=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:r.scroller.scrollTop,o=Bt(e),l={};t.bottom-t.top>o&&(t.bottom=t.top+o);var s=e.doc.height+Pt(r),a=t.top<n,u=t.bottom>s-n;if(t.top<i)l.scrollTop=a?0:t.top;else if(t.bottom>i+o){var c=Math.min(t.top,(u?s:t.bottom)-o);c!=i&&(l.scrollTop=c)}var f=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:r.scroller.scrollLeft,h=Rt(e)-(e.options.fixedGutter?r.gutters.offsetWidth:0),d=t.right-t.left>h;return d&&(t.right=t.left+h),t.left<10?l.scrollLeft=0:t.left<f?l.scrollLeft=Math.max(0,t.left-(d?0:10)):t.right>h+f-3&&(l.scrollLeft=t.right+(d?0:10)-h),l}function Kr(e,t){null!=t&&(_r(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function jr(e){_r(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function Xr(e,t,r){null==t&&null==r||_r(e),null!=t&&(e.curOp.scrollLeft=t),null!=r&&(e.curOp.scrollTop=r)}function Yr(e,t){_r(e),e.curOp.scrollToPos=t}function _r(e){var t=e.curOp.scrollToPos;t&&(e.curOp.scrollToPos=null,$r(e,ar(e,t.from),ar(e,t.to),t.margin))}function $r(e,t,r,n){var i=Vr(e,{left:Math.min(t.left,r.left),top:Math.min(t.top,r.top)-n,right:Math.max(t.right,r.right),bottom:Math.max(t.bottom,r.bottom)+n});Xr(e,i.scrollLeft,i.scrollTop)}function qr(e,t){Math.abs(e.doc.scrollTop-t)<2||(fl||On(e,{top:t}),Zr(e,t,!0),fl&&On(e),Cn(e,100))}function Zr(e,t,r){t=Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t),(e.display.scroller.scrollTop!=t||r)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function Qr(e,t,r,n){t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),(r?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!n||(e.doc.scrollLeft=t,zr(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function Jr(e){var t=e.display,r=t.gutters.offsetWidth,n=Math.round(e.doc.height+Pt(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?r:0,docHeight:n,scrollHeight:n+zt(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:r}}function en(e,t){t||(t=Jr(e));var r=e.display.barWidth,n=e.display.barHeight;tn(e,t);for(var i=0;i<4&&r!=e.display.barWidth||n!=e.display.barHeight;i++)r!=e.display.barWidth&&e.options.lineWrapping&&Er(e),tn(e,Jr(e)),r=e.display.barWidth,n=e.display.barHeight}function tn(e,t){var r=e.display,n=r.scrollbars.update(t);r.sizer.style.paddingRight=(r.barWidth=n.right)+"px",r.sizer.style.paddingBottom=(r.barHeight=n.bottom)+"px",r.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(r.scrollbarFiller.style.display="block",r.scrollbarFiller.style.height=n.bottom+"px",r.scrollbarFiller.style.width=n.right+"px"):r.scrollbarFiller.style.display="",n.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(r.gutterFiller.style.display="block",r.gutterFiller.style.height=n.bottom+"px",r.gutterFiller.style.width=t.gutterWidth+"px"):r.gutterFiller.style.display=""}function rn(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&Fl(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new ws[e.options.scrollbarStyle](function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),Ql(t,"mousedown",function(){e.state.focused&&setTimeout(function(){return e.display.input.focus()},0)}),t.setAttribute("cm-not-content","true")},function(t,r){"horizontal"==r?Qr(e,t):qr(e,t)},e),e.display.scrollbars.addClass&&s(e.display.wrapper,e.display.scrollbars.addClass)}function nn(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++xs},vt(e.curOp)}function on(e){yt(e.curOp,function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;ln(e)})}function ln(e){for(var t=e.ops,r=0;r<t.length;r++)sn(t[r]);for(var n=0;n<t.length;n++)an(t[n]);for(var i=0;i<t.length;i++)un(t[i]);for(var o=0;o<t.length;o++)cn(t[o]);for(var l=0;l<t.length;l++)fn(t[l])}function sn(e){var t=e.cm,r=t.display;Ln(t),e.updateMaxLine&&we(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<r.viewFrom||e.scrollToPos.to.line>=r.viewTo)||r.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new Cs(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function an(e){e.updatedDisplay=e.mustUpdate&&Mn(e.cm,e.update)}function un(e){var t=e.cm,r=t.display;e.updatedDisplay&&Er(t),e.barMeasure=Jr(t),r.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=Kt(t,r.maxLine,r.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(r.scroller.clientWidth,r.sizer.offsetLeft+e.adjustWidthTo+zt(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,r.sizer.offsetLeft+e.adjustWidthTo-Rt(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=r.input.prepareSelection())}function cn(e){var t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&Qr(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var r=e.focus&&e.focus==l();e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,r),(e.updatedDisplay||e.startHeight!=t.doc.height)&&en(t,e.barMeasure),e.updatedDisplay&&Dn(t,e.barMeasure),e.selectionChanged&&Ar(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),r&&Wr(e.cm)}function fn(e){var t=e.cm,r=t.display,n=t.doc;e.updatedDisplay&&Nn(t,e.update),null==r.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(r.wheelStartX=r.wheelStartY=null),null!=e.scrollTop&&Zr(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&Qr(t,e.scrollLeft,!0,!0),e.scrollToPos&&Br(t,Gr(t,U(n,e.scrollToPos.from),U(n,e.scrollToPos.to),e.scrollToPos.margin));var i=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(i)for(var l=0;l<i.length;++l)i[l].lines.length||Te(i[l],"hide");if(o)for(var s=0;s<o.length;++s)o[s].lines.length&&Te(o[s],"unhide");r.wrapper.offsetHeight&&(n.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&Te(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function hn(e,t){if(e.curOp)return t();nn(e);try{return t()}finally{on(e)}}function dn(e,t){return function(){if(e.curOp)return t.apply(e,arguments);nn(e);try{return t.apply(e,arguments)}finally{on(e)}}}function pn(e){return function(){if(this.curOp)return e.apply(this,arguments);nn(this);try{return e.apply(this,arguments)}finally{on(this)}}}function gn(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);nn(t);try{return e.apply(this,arguments)}finally{on(t)}}}function vn(e,t,r,n){null==t&&(t=e.doc.first),null==r&&(r=e.doc.first+e.doc.size),n||(n=0);var i=e.display;if(n&&r<i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>t)&&(i.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=i.viewTo)_l&&pe(e.doc,t)<i.viewTo&&yn(e);else if(r<=i.viewFrom)_l&&ge(e.doc,r+n)>i.viewFrom?yn(e):(i.viewFrom+=n,i.viewTo+=n);else if(t<=i.viewFrom&&r>=i.viewTo)yn(e);else if(t<=i.viewFrom){var o=bn(e,r,r+n,1);o?(i.view=i.view.slice(o.index),i.viewFrom=o.lineN,i.viewTo+=n):yn(e)}else if(r>=i.viewTo){var l=bn(e,t,t,-1);l?(i.view=i.view.slice(0,l.index),i.viewTo=l.lineN):yn(e)}else{var s=bn(e,t,t,-1),a=bn(e,r,r+n,1);s&&a?(i.view=i.view.slice(0,s.index).concat(gt(e,s.lineN,a.lineN)).concat(i.view.slice(a.index)),i.viewTo+=n):yn(e)}var u=i.externalMeasured;u&&(r<u.lineN?u.lineN+=n:t<u.lineN+u.size&&(i.externalMeasured=null))}function mn(e,t,r){e.curOp.viewChanged=!0;var n=e.display,i=e.display.externalMeasured;if(i&&t>=i.lineN&&t<i.lineN+i.size&&(n.externalMeasured=null),!(t<n.viewFrom||t>=n.viewTo)){var o=n.view[Lr(e,t)];if(null!=o.node){var l=o.changes||(o.changes=[]);-1==h(l,r)&&l.push(r)}}}function yn(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function bn(e,t,r,n){var i,o=Lr(e,t),l=e.display.view;if(!_l||r==e.doc.first+e.doc.size)return{index:o,lineN:r};for(var s=e.display.viewFrom,a=0;a<o;a++)s+=l[a].size;if(s!=t){if(n>0){if(o==l.length-1)return null;i=s+l[o].size-t,o++}else i=s-t;t+=i,r+=i}for(;pe(e.doc,r)!=r;){if(o==(n<0?0:l.length-1))return null;r+=n*l[o-(n<0?1:0)].size,o+=n}return{index:o,lineN:r}}function wn(e,t,r){var n=e.display;0==n.view.length||t>=n.viewTo||r<=n.viewFrom?(n.view=gt(e,t,r),n.viewFrom=t):(n.viewFrom>t?n.view=gt(e,t,n.viewFrom).concat(n.view):n.viewFrom<t&&(n.view=n.view.slice(Lr(e,t))),n.viewFrom=t,n.viewTo<r?n.view=n.view.concat(gt(e,n.viewTo,r)):n.viewTo>r&&(n.view=n.view.slice(0,Lr(e,r)))),n.viewTo=r}function xn(e){for(var t=e.display.view,r=0,n=0;n<t.length;n++){var i=t[n];i.hidden||i.node&&!i.changes||++r}return r}function Cn(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,u(Sn,e))}function Sn(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var r=+new Date+e.options.workTime,n=$e(e,t.highlightFrontier),i=[];t.iter(n.line,Math.min(t.first+t.size,e.display.viewTo+500),function(o){if(n.line>=e.display.viewFrom){var l=o.styles,s=o.text.length>e.options.maxHighlightLength?Ke(t.mode,n.state):null,a=Ye(e,o,n,!0);s&&(n.state=s),o.styles=a.styles;var u=o.styleClasses,c=a.classes;c?o.styleClasses=c:u&&(o.styleClasses=null);for(var f=!l||l.length!=o.styles.length||u!=c&&(!u||!c||u.bgClass!=c.bgClass||u.textClass!=c.textClass),h=0;!f&&h<l.length;++h)f=l[h]!=o.styles[h];f&&i.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=e.options.maxHighlightLength&&qe(e,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>r)return Cn(e,e.options.workDelay),!0}),t.highlightFrontier=n.line,t.modeFrontier=Math.max(t.modeFrontier,n.line),i.length&&hn(e,function(){for(var t=0;t<i.length;t++)mn(e,i[t],"text")})}}function Ln(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=zt(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=zt(e)+"px",t.scrollbarsClipped=!0)}function kn(e){if(e.hasFocus())return null;var t=l();if(!t||!o(e.display.lineDiv,t))return null;var r={activeElt:t};if(window.getSelection){var n=window.getSelection();n.anchorNode&&n.extend&&o(e.display.lineDiv,n.anchorNode)&&(r.anchorNode=n.anchorNode,r.anchorOffset=n.anchorOffset,r.focusNode=n.focusNode,r.focusOffset=n.focusOffset)}return r}function Tn(e){if(e&&e.activeElt&&e.activeElt!=l()&&(e.activeElt.focus(),e.anchorNode&&o(document.body,e.anchorNode)&&o(document.body,e.focusNode))){var t=window.getSelection(),r=document.createRange();r.setEnd(e.anchorNode,e.anchorOffset),r.collapse(!1),t.removeAllRanges(),t.addRange(r),t.extend(e.focusNode,e.focusOffset)}}function Mn(e,r){var n=e.display,i=e.doc;if(r.editorIsHidden)return yn(e),!1;if(!r.force&&r.visible.from>=n.viewFrom&&r.visible.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&n.renderedView==n.view&&0==xn(e))return!1;Rr(e)&&(yn(e),r.dims=br(e));var o=i.first+i.size,l=Math.max(r.visible.from-e.options.viewportMargin,i.first),s=Math.min(o,r.visible.to+e.options.viewportMargin);n.viewFrom<l&&l-n.viewFrom<20&&(l=Math.max(i.first,n.viewFrom)),n.viewTo>s&&n.viewTo-s<20&&(s=Math.min(o,n.viewTo)),_l&&(l=pe(e.doc,l),s=ge(e.doc,s));var a=l!=n.viewFrom||s!=n.viewTo||n.lastWrapHeight!=r.wrapperHeight||n.lastWrapWidth!=r.wrapperWidth;wn(e,l,s),n.viewOffset=ye(M(e.doc,n.viewFrom)),e.display.mover.style.top=n.viewOffset+"px";var u=xn(e);if(!a&&0==u&&!r.force&&n.renderedView==n.view&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo))return!1;var c=kn(e);return u>4&&(n.lineDiv.style.display="none"),An(e,n.updateLineNumbers,r.dims),u>4&&(n.lineDiv.style.display=""),n.renderedView=n.view,Tn(c),t(n.cursorDiv),t(n.selectionDiv),n.gutters.style.height=n.sizer.style.minHeight=0,a&&(n.lastWrapHeight=r.wrapperHeight,n.lastWrapWidth=r.wrapperWidth,Cn(e,400)),n.updateLineNumbers=null,!0}function Nn(e,t){for(var r=t.viewport,n=!0;(n&&e.options.lineWrapping&&t.oldDisplayWidth!=Rt(e)||(r&&null!=r.top&&(r={top:Math.min(e.doc.height+Pt(e.display)-Bt(e),r.top)}),t.visible=Ir(e.display,e.doc,r),!(t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)))&&Mn(e,t);n=!1){Er(e);var i=Jr(e);kr(e),en(e,i),Dn(e,i),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function On(e,t){var r=new Cs(e,t);if(Mn(e,r)){Er(e),Nn(e,r);var n=Jr(e);kr(e),en(e,n),Dn(e,n),r.finish()}}function An(e,r,n){function i(t){var r=t.nextSibling;return ml&&Ml&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),r}for(var o=e.display,l=e.options.lineNumbers,s=o.lineDiv,a=s.firstChild,u=o.view,c=o.viewFrom,f=0;f<u.length;f++){var d=u[f];if(d.hidden);else if(d.node&&d.node.parentNode==s){for(;a!=d.node;)a=i(a);var p=l&&null!=r&&r<=c&&d.lineNumber;d.changes&&(h(d.changes,"gutter")>-1&&(p=!1),xt(e,d,c,n)),p&&(t(d.lineNumber),d.lineNumber.appendChild(document.createTextNode(F(e.options,c)))),a=d.node.nextSibling}else{var g=Ot(e,d,c,n);s.insertBefore(g,a)}c+=d.size}for(;a;)a=i(a)}function Wn(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px"}function Dn(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+zt(e)+"px"}function Hn(e){var r=e.display.gutters,i=e.options.gutters;t(r);for(var o=0;o<i.length;++o){var l=i[o],s=r.appendChild(n("div",null,"CodeMirror-gutter "+l));"CodeMirror-linenumbers"==l&&(e.display.lineGutter=s,s.style.width=(e.display.lineNumWidth||1)+"px")}r.style.display=o?"":"none",Wn(e)}function Fn(e){var t=h(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}function En(e){var t=e.wheelDeltaX,r=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==r&&e.detail&&e.axis==e.VERTICAL_AXIS?r=e.detail:null==r&&(r=e.wheelDelta),{x:t,y:r}}function Pn(e){var t=En(e);return t.x*=Ls,t.y*=Ls,t}function In(e,t){var r=En(t),n=r.x,i=r.y,o=e.display,l=o.scroller,s=l.scrollWidth>l.clientWidth,a=l.scrollHeight>l.clientHeight;if(n&&s||i&&a){if(i&&Ml&&ml)e:for(var u=t.target,c=o.view;u!=l;u=u.parentNode)for(var f=0;f<c.length;f++)if(c[f].node==u){e.display.currentWheelTarget=u;break e}if(n&&!fl&&!wl&&null!=Ls)return i&&a&&qr(e,Math.max(0,l.scrollTop+i*Ls)),Qr(e,Math.max(0,l.scrollLeft+n*Ls)),(!i||i&&a)&&We(t),void(o.wheelStartX=null);if(i&&null!=Ls){var h=i*Ls,d=e.doc.scrollTop,p=d+o.wrapper.clientHeight;h<0?d=Math.max(0,d+h-50):p=Math.min(e.doc.height,p+h+50),On(e,{top:d,bottom:p})}Ss<20&&(null==o.wheelStartX?(o.wheelStartX=l.scrollLeft,o.wheelStartY=l.scrollTop,o.wheelDX=n,o.wheelDY=i,setTimeout(function(){if(null!=o.wheelStartX){var e=l.scrollLeft-o.wheelStartX,t=l.scrollTop-o.wheelStartY,r=t&&o.wheelDY&&t/o.wheelDY||e&&o.wheelDX&&e/o.wheelDX;o.wheelStartX=o.wheelStartY=null,r&&(Ls=(Ls*Ss+r)/(Ss+1),++Ss)}},200)):(o.wheelDX+=n,o.wheelDY+=i))}}function zn(e,t){var r=e[t];e.sort(function(e,t){return P(e.from(),t.from())}),t=h(e,r);for(var n=1;n<e.length;n++){var i=e[n],o=e[n-1];if(P(o.to(),i.from())>=0){var l=B(o.from(),i.from()),s=R(o.to(),i.to()),a=o.empty()?i.from()==i.head:o.from()==o.head;n<=t&&--t,e.splice(--n,2,new Ts(a?s:l,a?l:s))}}return new ks(e,t)}function Rn(e,t){return new ks([new Ts(e,t||e)],0)}function Bn(e){return e.text?E(e.from.line+e.text.length-1,g(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function Gn(e,t){if(P(e,t.from)<0)return e;if(P(e,t.to)<=0)return Bn(t);var r=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;return e.line==t.to.line&&(n+=Bn(t).ch-t.to.ch),E(r,n)}function Un(e,t){for(var r=[],n=0;n<e.sel.ranges.length;n++){var i=e.sel.ranges[n];r.push(new Ts(Gn(i.anchor,t),Gn(i.head,t)))}return zn(r,e.sel.primIndex)}function Vn(e,t,r){return e.line==t.line?E(r.line,e.ch-t.ch+r.ch):E(r.line+(e.line-t.line),e.ch)}function Kn(e,t,r){for(var n=[],i=E(e.first,0),o=i,l=0;l<t.length;l++){var s=t[l],a=Vn(s.from,i,o),u=Vn(Bn(s),i,o);if(i=s.to,o=u,"around"==r){var c=e.sel.ranges[l],f=P(c.head,c.anchor)<0;n[l]=new Ts(f?u:a,f?a:u)}else n[l]=new Ts(a,a)}return new ks(n,e.sel.primIndex)}function jn(e){e.doc.mode=Ue(e.options,e.doc.modeOption),Xn(e)}function Xn(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,Cn(e,100),e.state.modeGen++,e.curOp&&vn(e)}function Yn(e,t){return 0==t.from.ch&&0==t.to.ch&&""==g(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function _n(e,t,r,n){function i(e){return r?r[e]:null}function o(e,r,i){it(e,r,i,n),bt(e,"change",e,t)}function l(e,t){for(var r=[],o=e;o<t;++o)r.push(new fs(u[o],i(o),n));return r}var s=t.from,a=t.to,u=t.text,c=M(e,s.line),f=M(e,a.line),h=g(u),d=i(u.length-1),p=a.line-s.line;if(t.full)e.insert(0,l(0,u.length)),e.remove(u.length,e.size-u.length);else if(Yn(e,t)){var v=l(0,u.length-1);o(f,f.text,d),p&&e.remove(s.line,p),v.length&&e.insert(s.line,v)}else if(c==f)if(1==u.length)o(c,c.text.slice(0,s.ch)+h+c.text.slice(a.ch),d);else{var m=l(1,u.length-1);m.push(new fs(h+c.text.slice(a.ch),d,n)),o(c,c.text.slice(0,s.ch)+u[0],i(0)),e.insert(s.line+1,m)}else if(1==u.length)o(c,c.text.slice(0,s.ch)+u[0]+f.text.slice(a.ch),i(0)),e.remove(s.line+1,p);else{o(c,c.text.slice(0,s.ch)+u[0],i(0)),o(f,h+f.text.slice(a.ch),d);var y=l(1,u.length-1);p>1&&e.remove(s.line+1,p-1),e.insert(s.line+1,y)}bt(e,"change",e,t)}function $n(e,t,r){function n(e,i,o){if(e.linked)for(var l=0;l<e.linked.length;++l){var s=e.linked[l];if(s.doc!=i){var a=o&&s.sharedHist;r&&!a||(t(s.doc,a),n(s.doc,e,a))}}}n(e,null,!0)}function qn(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,Cr(e),jn(e),Zn(e),e.options.lineWrapping||we(e),e.options.mode=t.modeOption,vn(e)}function Zn(e){("rtl"==e.doc.direction?s:Fl)(e.display.lineDiv,"CodeMirror-rtl")}function Qn(e){hn(e,function(){Zn(e),vn(e)})}function Jn(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function ei(e,t){var r={from:z(t.from),to:Bn(t),text:N(e,t.from,t.to)};return si(e,r,t.from.line,t.to.line+1),$n(e,function(e){return si(e,r,t.from.line,t.to.line+1)},!0),r}function ti(e){for(;e.length&&g(e).ranges;)e.pop()}function ri(e,t){return t?(ti(e.done),g(e.done)):e.done.length&&!g(e.done).ranges?g(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),g(e.done)):void 0}function ni(e,t,r,n){var i=e.history;i.undone.length=0;var o,l,s=+new Date;if((i.lastOp==n||i.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&i.lastModTime>s-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))&&(o=ri(i,i.lastOp==n)))l=g(o.changes),0==P(t.from,t.to)&&0==P(t.from,l.to)?l.to=Bn(t):o.changes.push(ei(e,t));else{var a=g(i.done);for(a&&a.ranges||li(e.sel,i.done),o={changes:[ei(e,t)],generation:i.generation},i.done.push(o);i.done.length>i.undoDepth;)i.done.shift(),i.done[0].ranges||i.done.shift()}i.done.push(r),i.generation=++i.maxGeneration,i.lastModTime=i.lastSelTime=s,i.lastOp=i.lastSelOp=n,i.lastOrigin=i.lastSelOrigin=t.origin,l||Te(e,"historyAdded")}function ii(e,t,r,n){var i=t.charAt(0);return"*"==i||"+"==i&&r.ranges.length==n.ranges.length&&r.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function oi(e,t,r,n){var i=e.history,o=n&&n.origin;r==i.lastSelOp||o&&i.lastSelOrigin==o&&(i.lastModTime==i.lastSelTime&&i.lastOrigin==o||ii(e,o,g(i.done),t))?i.done[i.done.length-1]=t:li(t,i.done),i.lastSelTime=+new Date,i.lastSelOrigin=o,i.lastSelOp=r,n&&!1!==n.clearRedo&&ti(i.undone)}function li(e,t){var r=g(t);r&&r.ranges&&r.equals(e)||t.push(e)}function si(e,t,r,n){var i=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,r),Math.min(e.first+e.size,n),function(r){r.markedSpans&&((i||(i=t["spans_"+e.id]={}))[o]=r.markedSpans),++o})}function ai(e){if(!e)return null;for(var t,r=0;r<e.length;++r)e[r].marker.explicitlyCleared?t||(t=e.slice(0,r)):t&&t.push(e[r]);return t?t.length?t:null:e}function ui(e,t){var r=t["spans_"+e.id];if(!r)return null;for(var n=[],i=0;i<t.text.length;++i)n.push(ai(r[i]));return n}function ci(e,t){var r=ui(e,t),n=J(e,t);if(!r)return n;if(!n)return r;for(var i=0;i<r.length;++i){var o=r[i],l=n[i];if(o&&l)e:for(var s=0;s<l.length;++s){for(var a=l[s],u=0;u<o.length;++u)if(o[u].marker==a.marker)continue e;o.push(a)}else l&&(r[i]=l)}return r}function fi(e,t,r){for(var n=[],i=0;i<e.length;++i){var o=e[i];if(o.ranges)n.push(r?ks.prototype.deepCopy.call(o):o);else{var l=o.changes,s=[];n.push({changes:s});for(var a=0;a<l.length;++a){var u=l[a],c=void 0;if(s.push({from:u.from,to:u.to,text:u.text}),t)for(var f in u)(c=f.match(/^spans_(\d+)$/))&&h(t,Number(c[1]))>-1&&(g(s)[f]=u[f],delete u[f])}}}return n}function hi(e,t,r,n){if(n){var i=e.anchor;if(r){var o=P(t,i)<0;o!=P(r,i)<0?(i=t,t=r):o!=P(t,r)<0&&(t=r)}return new Ts(i,t)}return new Ts(r||t,t)}function di(e,t,r,n,i){null==i&&(i=e.cm&&(e.cm.display.shift||e.extend)),bi(e,new ks([hi(e.sel.primary(),t,r,i)],0),n)}function pi(e,t,r){for(var n=[],i=e.cm&&(e.cm.display.shift||e.extend),o=0;o<e.sel.ranges.length;o++)n[o]=hi(e.sel.ranges[o],t[o],null,i);bi(e,zn(n,e.sel.primIndex),r)}function gi(e,t,r,n){var i=e.sel.ranges.slice(0);i[t]=r,bi(e,zn(i,e.sel.primIndex),n)}function vi(e,t,r,n){bi(e,Rn(t,r),n)}function mi(e,t,r){var n={ranges:t.ranges,update:function(t){var r=this;this.ranges=[];for(var n=0;n<t.length;n++)r.ranges[n]=new Ts(U(e,t[n].anchor),U(e,t[n].head))},origin:r&&r.origin};return Te(e,"beforeSelectionChange",e,n),e.cm&&Te(e.cm,"beforeSelectionChange",e.cm,n),n.ranges!=t.ranges?zn(n.ranges,n.ranges.length-1):t}function yi(e,t,r){var n=e.history.done,i=g(n);i&&i.ranges?(n[n.length-1]=t,wi(e,t,r)):bi(e,t,r)}function bi(e,t,r){wi(e,t,r),oi(e,e.sel,e.cm?e.cm.curOp.id:NaN,r)}function wi(e,t,r){(Oe(e,"beforeSelectionChange")||e.cm&&Oe(e.cm,"beforeSelectionChange"))&&(t=mi(e,t,r)),xi(e,Si(e,t,r&&r.bias||(P(t.primary().head,e.sel.primary().head)<0?-1:1),!0)),r&&!1===r.scroll||!e.cm||jr(e.cm)}function xi(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=!0,Ne(e.cm)),bt(e,"cursorActivity",e))}function Ci(e){xi(e,Si(e,e.sel,null,!1))}function Si(e,t,r,n){for(var i,o=0;o<t.ranges.length;o++){var l=t.ranges[o],s=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],a=ki(e,l.anchor,s&&s.anchor,r,n),u=ki(e,l.head,s&&s.head,r,n);(i||a!=l.anchor||u!=l.head)&&(i||(i=t.ranges.slice(0,o)),i[o]=new Ts(a,u))}return i?zn(i,t.primIndex):t}function Li(e,t,r,n,i){var o=M(e,t.line);if(o.markedSpans)for(var l=0;l<o.markedSpans.length;++l){var s=o.markedSpans[l],a=s.marker;if((null==s.from||(a.inclusiveLeft?s.from<=t.ch:s.from<t.ch))&&(null==s.to||(a.inclusiveRight?s.to>=t.ch:s.to>t.ch))){if(i&&(Te(a,"beforeCursorEnter"),a.explicitlyCleared)){if(o.markedSpans){--l;continue}break}if(!a.atomic)continue;if(r){var u=a.find(n<0?1:-1),c=void 0;if((n<0?a.inclusiveRight:a.inclusiveLeft)&&(u=Ti(e,u,-n,u&&u.line==t.line?o:null)),u&&u.line==t.line&&(c=P(u,r))&&(n<0?c<0:c>0))return Li(e,u,t,n,i)}var f=a.find(n<0?-1:1);return(n<0?a.inclusiveLeft:a.inclusiveRight)&&(f=Ti(e,f,n,f.line==t.line?o:null)),f?Li(e,f,t,n,i):null}}return t}function ki(e,t,r,n,i){var o=n||1,l=Li(e,t,r,o,i)||!i&&Li(e,t,r,o,!0)||Li(e,t,r,-o,i)||!i&&Li(e,t,r,-o,!0);return l||(e.cantEdit=!0,E(e.first,0))}function Ti(e,t,r,n){return r<0&&0==t.ch?t.line>e.first?U(e,E(t.line-1)):null:r>0&&t.ch==(n||M(e,t.line)).text.length?t.line<e.first+e.size-1?E(t.line+1,0):null:new E(t.line,t.ch+r)}function Mi(e){e.setSelection(E(e.firstLine(),0),E(e.lastLine()),Gl)}function Ni(e,t,r){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return n.canceled=!0}};return r&&(n.update=function(t,r,i,o){t&&(n.from=U(e,t)),r&&(n.to=U(e,r)),i&&(n.text=i),void 0!==o&&(n.origin=o)}),Te(e,"beforeChange",e,n),e.cm&&Te(e.cm,"beforeChange",e.cm,n),n.canceled?null:{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Oi(e,t,r){if(e.cm){if(!e.cm.curOp)return dn(e.cm,Oi)(e,t,r);if(e.cm.state.suppressEdits)return}if(!(Oe(e,"beforeChange")||e.cm&&Oe(e.cm,"beforeChange"))||(t=Ni(e,t,!0))){var n=Yl&&!r&&te(e,t.from,t.to);if(n)for(var i=n.length-1;i>=0;--i)Ai(e,{from:n[i].from,to:n[i].to,text:i?[""]:t.text,origin:t.origin});else Ai(e,t)}}function Ai(e,t){if(1!=t.text.length||""!=t.text[0]||0!=P(t.from,t.to)){var r=Un(e,t);ni(e,t,r,e.cm?e.cm.curOp.id:NaN),Hi(e,t,r,J(e,t));var n=[];$n(e,function(e,r){r||-1!=h(n,e.history)||(zi(e.history,t),n.push(e.history)),Hi(e,t,null,J(e,t))})}}function Wi(e,t,r){if(!e.cm||!e.cm.state.suppressEdits||r){for(var n,i=e.history,o=e.sel,l="undo"==t?i.done:i.undone,s="undo"==t?i.undone:i.done,a=0;a<l.length&&(n=l[a],r?!n.ranges||n.equals(e.sel):n.ranges);a++);if(a!=l.length){for(i.lastOrigin=i.lastSelOrigin=null;(n=l.pop()).ranges;){if(li(n,s),r&&!n.equals(e.sel))return void bi(e,n,{clearRedo:!1});o=n}var u=[];li(o,s),s.push({changes:u,generation:i.generation}),i.generation=n.generation||++i.maxGeneration;for(var c=Oe(e,"beforeChange")||e.cm&&Oe(e.cm,"beforeChange"),f=n.changes.length-1;f>=0;--f){var d=function(r){var i=n.changes[r];if(i.origin=t,c&&!Ni(e,i,!1))return l.length=0,{};u.push(ei(e,i));var o=r?Un(e,i):g(l);Hi(e,i,o,ci(e,i)),!r&&e.cm&&e.cm.scrollIntoView({from:i.from,to:Bn(i)});var s=[];$n(e,function(e,t){t||-1!=h(s,e.history)||(zi(e.history,i),s.push(e.history)),Hi(e,i,null,ci(e,i))})}(f);if(d)return d.v}}}}function Di(e,t){if(0!=t&&(e.first+=t,e.sel=new ks(v(e.sel.ranges,function(e){return new Ts(E(e.anchor.line+t,e.anchor.ch),E(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm)){vn(e.cm,e.first,e.first-t,t);for(var r=e.cm.display,n=r.viewFrom;n<r.viewTo;n++)mn(e.cm,n,"gutter")}}function Hi(e,t,r,n){if(e.cm&&!e.cm.curOp)return dn(e.cm,Hi)(e,t,r,n);if(t.to.line<e.first)Di(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var i=t.text.length-1-(e.first-t.from.line);Di(e,i),t={from:E(e.first,0),to:E(t.to.line+i,t.to.ch),text:[g(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:E(o,M(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=N(e,t.from,t.to),r||(r=Un(e,t)),e.cm?Fi(e.cm,t,n):_n(e,t,n),wi(e,r,Gl)}}function Fi(e,t,r){var n=e.doc,i=e.display,o=t.from,l=t.to,s=!1,a=o.line;e.options.lineWrapping||(a=W(fe(M(n,o.line))),n.iter(a,l.line+1,function(e){if(e==i.maxLine)return s=!0,!0})),n.sel.contains(t.from,t.to)>-1&&Ne(e),_n(n,t,r,xr(e)),e.options.lineWrapping||(n.iter(a,o.line+t.text.length,function(e){var t=be(e);t>i.maxLineLength&&(i.maxLine=e,i.maxLineLength=t,i.maxLineChanged=!0,s=!1)}),s&&(e.curOp.updateMaxLine=!0)),nt(n,o.line),Cn(e,400);var u=t.text.length-(l.line-o.line)-1;t.full?vn(e):o.line!=l.line||1!=t.text.length||Yn(e.doc,t)?vn(e,o.line,l.line+1,u):mn(e,o.line,"text");var c=Oe(e,"changes"),f=Oe(e,"change");if(f||c){var h={from:o,to:l,text:t.text,removed:t.removed,origin:t.origin};f&&bt(e,"change",e,h),c&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(h)}e.display.selForContextMenu=null}function Ei(e,t,r,n,i){if(n||(n=r),P(n,r)<0){var o;r=(o=[n,r])[0],n=o[1]}"string"==typeof t&&(t=e.splitLines(t)),Oi(e,{from:r,to:n,text:t,origin:i})}function Pi(e,t,r,n){r<e.line?e.line+=n:t<e.line&&(e.line=t,e.ch=0)}function Ii(e,t,r,n){for(var i=0;i<e.length;++i){var o=e[i],l=!0;if(o.ranges){o.copied||((o=e[i]=o.deepCopy()).copied=!0);for(var s=0;s<o.ranges.length;s++)Pi(o.ranges[s].anchor,t,r,n),Pi(o.ranges[s].head,t,r,n)}else{for(var a=0;a<o.changes.length;++a){var u=o.changes[a];if(r<u.from.line)u.from=E(u.from.line+n,u.from.ch),u.to=E(u.to.line+n,u.to.ch);else if(t<=u.to.line){l=!1;break}}l||(e.splice(0,i+1),i=0)}}}function zi(e,t){var r=t.from.line,n=t.to.line,i=t.text.length-(n-r)-1;Ii(e.done,r,n,i),Ii(e.undone,r,n,i)}function Ri(e,t,r,n){var i=t,o=t;return"number"==typeof t?o=M(e,G(e,t)):i=W(t),null==i?null:(n(o,i)&&e.cm&&mn(e.cm,i,r),o)}function Bi(e){var t=this;this.lines=e,this.parent=null;for(var r=0,n=0;n<e.length;++n)e[n].parent=t,r+=e[n].height;this.height=r}function Gi(e){var t=this;this.children=e;for(var r=0,n=0,i=0;i<e.length;++i){var o=e[i];r+=o.chunkSize(),n+=o.height,o.parent=t}this.size=r,this.height=n,this.parent=null}function Ui(e,t,r){ye(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&Kr(e,r)}function Vi(e,t,r,n){var i=new Ms(e,r,n),o=e.cm;return o&&i.noHScroll&&(o.display.alignWidgets=!0),Ri(e,t,"widget",function(t){var r=t.widgets||(t.widgets=[]);if(null==i.insertAt?r.push(i):r.splice(Math.min(r.length-1,Math.max(0,i.insertAt)),0,i),i.line=t,o&&!ve(e,t)){var n=ye(t)<e.scrollTop;A(t,t.height+Ht(i)),n&&Kr(o,i.height),o.curOp.forceUpdate=!0}return!0}),bt(o,"lineWidgetAdded",o,i,"number"==typeof t?t:W(t)),i}function Ki(e,t,r,n,o){if(n&&n.shared)return ji(e,t,r,n,o);if(e.cm&&!e.cm.curOp)return dn(e.cm,Ki)(e,t,r,n,o);var l=new Os(e,o),s=P(t,r);if(n&&c(n,l,!1),s>0||0==s&&!1!==l.clearWhenEmpty)return l;if(l.replacedWith&&(l.collapsed=!0,l.widgetNode=i("span",[l.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||l.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(l.widgetNode.insertLeft=!0)),l.collapsed){if(ce(e,t.line,t,r,l)||t.line!=r.line&&ce(e,r.line,t,r,l))throw new Error("Inserting collapsed marker partially overlapping an existing one");X()}l.addToHistory&&ni(e,{from:t,to:r,origin:"markText"},e.sel,NaN);var a,u=t.line,f=e.cm;if(e.iter(u,r.line+1,function(e){f&&l.collapsed&&!f.options.lineWrapping&&fe(e)==f.display.maxLine&&(a=!0),l.collapsed&&u!=t.line&&A(e,0),q(e,new Y(l,u==t.line?t.ch:null,u==r.line?r.ch:null)),++u}),l.collapsed&&e.iter(t.line,r.line+1,function(t){ve(e,t)&&A(t,0)}),l.clearOnEnter&&Ql(l,"beforeCursorEnter",function(){return l.clear()}),l.readOnly&&(j(),(e.history.done.length||e.history.undone.length)&&e.clearHistory()),l.collapsed&&(l.id=++Ns,l.atomic=!0),f){if(a&&(f.curOp.updateMaxLine=!0),l.collapsed)vn(f,t.line,r.line+1);else if(l.className||l.title||l.startStyle||l.endStyle||l.css)for(var h=t.line;h<=r.line;h++)mn(f,h,"text");l.atomic&&Ci(f.doc),bt(f,"markerAdded",f,l)}return l}function ji(e,t,r,n,i){(n=c(n)).shared=!1;var o=[Ki(e,t,r,n,i)],l=o[0],s=n.widgetNode;return $n(e,function(e){s&&(n.widgetNode=s.cloneNode(!0)),o.push(Ki(e,U(e,t),U(e,r),n,i));for(var a=0;a<e.linked.length;++a)if(e.linked[a].isParent)return;l=g(o)}),new As(o,l)}function Xi(e){return e.findMarks(E(e.first,0),e.clipPos(E(e.lastLine())),function(e){return e.parent})}function Yi(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=n.find(),o=e.clipPos(i.from),l=e.clipPos(i.to);if(P(o,l)){var s=Ki(e,o,l,n.primary,n.primary.type);n.markers.push(s),s.parent=n}}}function _i(e){for(var t=0;t<e.length;t++)!function(t){var r=e[t],n=[r.primary.doc];$n(r.primary.doc,function(e){return n.push(e)});for(var i=0;i<r.markers.length;i++){var o=r.markers[i];-1==h(n,o.doc)&&(o.parent=null,r.markers.splice(i--,1))}}(t)}function $i(e){var t=this;if(Qi(t),!Me(t,e)&&!Ft(t.display,e)){We(e),gl&&(Hs=+new Date);var r=Sr(t,e,!0),n=e.dataTransfer.files;if(r&&!t.isReadOnly())if(n&&n.length&&window.FileReader&&window.File)for(var i=n.length,o=Array(i),l=0,s=0;s<i;++s)!function(e,n){if(!t.options.allowDropFileTypes||-1!=h(t.options.allowDropFileTypes,e.type)){var s=new FileReader;s.onload=dn(t,function(){var e=s.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(e)&&(e=""),o[n]=e,++l==i){var a={from:r=U(t.doc,r),to:r,text:t.doc.splitLines(o.join(t.doc.lineSeparator())),origin:"paste"};Oi(t.doc,a),yi(t.doc,Rn(r,Bn(a)))}}),s.readAsText(e)}}(n[s],s);else{if(t.state.draggingText&&t.doc.sel.contains(r)>-1)return t.state.draggingText(e),void setTimeout(function(){return t.display.input.focus()},20);try{var a=e.dataTransfer.getData("Text");if(a){var u;if(t.state.draggingText&&!t.state.draggingText.copy&&(u=t.listSelections()),wi(t.doc,Rn(r,r)),u)for(var c=0;c<u.length;++c)Ei(t.doc,"",u[c].anchor,u[c].head,"drag");t.replaceSelection(a,"around","paste"),t.display.input.focus()}}catch(e){}}}}function qi(e,t){if(gl&&(!e.state.draggingText||+new Date-Hs<100))Fe(t);else if(!Me(e,t)&&!Ft(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!xl)){var r=n("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",wl&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),wl&&r.parentNode.removeChild(r)}}function Zi(e,t){var i=Sr(e,t);if(i){var o=document.createDocumentFragment();Mr(e,i,o),e.display.dragCursor||(e.display.dragCursor=n("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),r(e.display.dragCursor,o)}}function Qi(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Ji(e){if(document.getElementsByClassName)for(var t=document.getElementsByClassName("CodeMirror"),r=0;r<t.length;r++){var n=t[r].CodeMirror;n&&e(n)}}function eo(){Fs||(to(),Fs=!0)}function to(){var e;Ql(window,"resize",function(){null==e&&(e=setTimeout(function(){e=null,Ji(ro)},100))}),Ql(window,"blur",function(){return Ji(Fr)})}function ro(e){var t=e.display;t.lastWrapHeight==t.wrapper.clientHeight&&t.lastWrapWidth==t.wrapper.clientWidth||(t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize())}function no(e){var t=e.split(/-(?!$)/);e=t[t.length-1];for(var r,n,i,o,l=0;l<t.length-1;l++){var s=t[l];if(/^(cmd|meta|m)$/i.test(s))o=!0;else if(/^a(lt)?$/i.test(s))r=!0;else if(/^(c|ctrl|control)$/i.test(s))n=!0;else{if(!/^s(hift)?$/i.test(s))throw new Error("Unrecognized modifier name: "+s);i=!0}}return r&&(e="Alt-"+e),n&&(e="Ctrl-"+e),o&&(e="Cmd-"+e),i&&(e="Shift-"+e),e}function io(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];if(/^(name|fallthrough|(de|at)tach)$/.test(r))continue;if("..."==n){delete e[r];continue}for(var i=v(r.split(" "),no),o=0;o<i.length;o++){var l=void 0,s=void 0;o==i.length-1?(s=i.join(" "),l=n):(s=i.slice(0,o+1).join(" "),l="...");var a=t[s];if(a){if(a!=l)throw new Error("Inconsistent bindings for "+s)}else t[s]=l}delete e[r]}for(var u in t)e[u]=t[u];return e}function oo(e,t,r,n){var i=(t=uo(t)).call?t.call(e,n):t[e];if(!1===i)return"nothing";if("..."===i)return"multi";if(null!=i&&r(i))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return oo(e,t.fallthrough,r,n);for(var o=0;o<t.fallthrough.length;o++){var l=oo(e,t.fallthrough[o],r,n);if(l)return l}}}function lo(e){var t="string"==typeof e?e:Es[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function so(e,t,r){var n=e;return t.altKey&&"Alt"!=n&&(e="Alt-"+e),(Dl?t.metaKey:t.ctrlKey)&&"Ctrl"!=n&&(e="Ctrl-"+e),(Dl?t.ctrlKey:t.metaKey)&&"Cmd"!=n&&(e="Cmd-"+e),!r&&t.shiftKey&&"Shift"!=n&&(e="Shift-"+e),e}function ao(e,t){if(wl&&34==e.keyCode&&e.char)return!1;var r=Es[e.keyCode];return null!=r&&!e.altGraphKey&&so(r,e,t)}function uo(e){return"string"==typeof e?Rs[e]:e}function co(e,t){for(var r=e.doc.sel.ranges,n=[],i=0;i<r.length;i++){for(var o=t(r[i]);n.length&&P(o.from,g(n).to)<=0;){var l=n.pop();if(P(l.from,o.from)<0){o.from=l.from;break}}n.push(o)}hn(e,function(){for(var t=n.length-1;t>=0;t--)Ei(e.doc,"",n[t].from,n[t].to,"+delete");jr(e)})}function fo(e,t,r){var n=L(e.text,t+r,r);return n<0||n>e.text.length?null:n}function ho(e,t,r){var n=fo(e,t.ch,r);return null==n?null:new E(t.line,n,r<0?"after":"before")}function po(e,t,r,n,i){if(e){var o=Se(r,t.doc.direction);if(o){var l,s=i<0?g(o):o[0],a=i<0==(1==s.level)?"after":"before";if(s.level>0){var u=Xt(t,r);l=i<0?r.text.length-1:0;var c=Yt(t,u,l).top;l=k(function(e){return Yt(t,u,e).top==c},i<0==(1==s.level)?s.from:s.to-1,l),"before"==a&&(l=fo(r,l,1))}else l=i<0?s.to:s.from;return new E(n,l,a)}}return new E(n,i<0?r.text.length:0,i<0?"before":"after")}function go(e,t,r,n){var i=Se(t,e.doc.direction);if(!i)return ho(t,r,n);r.ch>=t.text.length?(r.ch=t.text.length,r.sticky="before"):r.ch<=0&&(r.ch=0,r.sticky="after");var o=Ce(i,r.ch,r.sticky),l=i[o];if("ltr"==e.doc.direction&&l.level%2==0&&(n>0?l.to>r.ch:l.from<r.ch))return ho(t,r,n);var s,a=function(e,r){return fo(t,e instanceof E?e.ch:e,r)},u=function(r){return e.options.lineWrapping?(s=s||Xt(e,t),hr(e,t,s,r)):{begin:0,end:t.text.length}},c=u("before"==r.sticky?a(r,-1):r.ch);if("rtl"==e.doc.direction||1==l.level){var f=1==l.level==n<0,h=a(r,f?1:-1);if(null!=h&&(f?h<=l.to&&h<=c.end:h>=l.from&&h>=c.begin)){var d=f?"before":"after";return new E(r.line,h,d)}}var p=function(e,t,n){for(var o=function(e,t){return t?new E(r.line,a(e,1),"before"):new E(r.line,e,"after")};e>=0&&e<i.length;e+=t){var l=i[e],s=t>0==(1!=l.level),u=s?n.begin:a(n.end,-1);if(l.from<=u&&u<l.to)return o(u,s);if(u=s?l.from:a(l.to,-1),n.begin<=u&&u<n.end)return o(u,s)}},g=p(o+n,n,c);if(g)return g;var v=n>0?c.end:a(c.begin,-1);return null==v||n>0&&v==t.text.length||!(g=p(n>0?0:i.length-1,n,u(v)))?null:g}function vo(e,t){var r=M(e.doc,t),n=fe(r);return n!=r&&(t=W(n)),po(!0,e,n,t,1)}function mo(e,t){var r=M(e.doc,t),n=he(r);return n!=r&&(t=W(n)),po(!0,e,r,t,-1)}function yo(e,t){var r=vo(e,t.line),n=M(e.doc,r.line),i=Se(n,e.doc.direction);if(!i||0==i[0].level){var o=Math.max(0,n.text.search(/\S/)),l=t.line==r.line&&t.ch<=o&&t.ch;return E(r.line,l?0:o,r.sticky)}return r}function bo(e,t,r){if("string"==typeof t&&!(t=Bs[t]))return!1;e.display.input.ensurePolled();var n=e.display.shift,i=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),r&&(e.display.shift=!1),i=t(e)!=Bl}finally{e.display.shift=n,e.state.suppressEdits=!1}return i}function wo(e,t,r){for(var n=0;n<e.state.keyMaps.length;n++){var i=oo(t,e.state.keyMaps[n],r,e);if(i)return i}return e.options.extraKeys&&oo(t,e.options.extraKeys,r,e)||oo(t,e.options.keyMap,r,e)}function xo(e,t,r,n){var i=e.state.keySeq;if(i){if(lo(t))return"handled";Gs.set(50,function(){e.state.keySeq==i&&(e.state.keySeq=null,e.display.input.reset())}),t=i+" "+t}var o=wo(e,t,n);return"multi"==o&&(e.state.keySeq=t),"handled"==o&&bt(e,"keyHandled",e,t,r),"handled"!=o&&"multi"!=o||(We(r),Ar(e)),i&&!o&&/\'$/.test(t)?(We(r),!0):!!o}function Co(e,t){var r=ao(t,!0);return!!r&&(t.shiftKey&&!e.state.keySeq?xo(e,"Shift-"+r,t,function(t){return bo(e,t,!0)})||xo(e,r,t,function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return bo(e,t)}):xo(e,r,t,function(t){return bo(e,t)}))}function So(e,t,r){return xo(e,"'"+r+"'",t,function(t){return bo(e,t,!0)})}function Lo(e){var t=this;if(t.curOp.focus=l(),!Me(t,e)){gl&&vl<11&&27==e.keyCode&&(e.returnValue=!1);var r=e.keyCode;t.display.shift=16==r||e.shiftKey;var n=Co(t,e);wl&&(Us=n?r:null,!n&&88==r&&!rs&&(Ml?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),18!=r||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||ko(t)}}function ko(e){function t(e){18!=e.keyCode&&e.altKey||(Fl(r,"CodeMirror-crosshair"),ke(document,"keyup",t),ke(document,"mouseover",t))}var r=e.display.lineDiv;s(r,"CodeMirror-crosshair"),Ql(document,"keyup",t),Ql(document,"mouseover",t)}function To(e){16==e.keyCode&&(this.doc.sel.shift=!1),Me(this,e)}function Mo(e){var t=this;if(!(Ft(t.display,e)||Me(t,e)||e.ctrlKey&&!e.altKey||Ml&&e.metaKey)){var r=e.keyCode,n=e.charCode;if(wl&&r==Us)return Us=null,void We(e);if(!wl||e.which&&!(e.which<10)||!Co(t,e)){var i=String.fromCharCode(null==n?r:n);"\b"!=i&&(So(t,e,i)||t.display.input.onKeyPress(e))}}}function No(e,t){var r=+new Date;return js&&js.compare(r,e,t)?(Ks=js=null,"triple"):Ks&&Ks.compare(r,e,t)?(js=new Vs(r,e,t),Ks=null,"double"):(Ks=new Vs(r,e,t),js=null,"single")}function Oo(e){var t=this,r=t.display;if(!(Me(t,e)||r.activeTouch&&r.input.supportsTouch()))if(r.input.ensurePolled(),r.shift=e.shiftKey,Ft(r,e))ml||(r.scroller.draggable=!1,setTimeout(function(){return r.scroller.draggable=!0},100));else if(!zo(t,e)){var n=Sr(t,e),i=Pe(e),o=n?No(n,i):"single";window.focus(),1==i&&t.state.selectingText&&t.state.selectingText(e),n&&Ao(t,i,n,o,e)||(1==i?n?Do(t,n,o,e):Ee(e)==r.scroller&&We(e):2==i?(n&&di(t.doc,n),setTimeout(function(){return r.input.focus()},20)):3==i&&(Hl?Ro(t,e):Dr(t)))}}function Ao(e,t,r,n,i){var o="Click";return"double"==n?o="Double"+o:"triple"==n&&(o="Triple"+o),o=(1==t?"Left":2==t?"Middle":"Right")+o,xo(e,so(o,i),i,function(t){if("string"==typeof t&&(t=Bs[t]),!t)return!1;var n=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),n=t(e,r)!=Bl}finally{e.state.suppressEdits=!1}return n})}function Wo(e,t,r){var n=e.getOption("configureMouse"),i=n?n(e,t,r):{};if(null==i.unit){var o=Nl?r.shiftKey&&r.metaKey:r.altKey;i.unit=o?"rectangle":"single"==t?"char":"double"==t?"word":"line"}return(null==i.extend||e.doc.extend)&&(i.extend=e.doc.extend||r.shiftKey),null==i.addNew&&(i.addNew=Ml?r.metaKey:r.ctrlKey),null==i.moveOnDrag&&(i.moveOnDrag=!(Ml?r.altKey:r.ctrlKey)),i}function Do(e,t,r,n){gl?setTimeout(u(Wr,e),0):e.curOp.focus=l();var i,o=Wo(e,r,n),s=e.doc.sel;e.options.dragDrop&&Jl&&!e.isReadOnly()&&"single"==r&&(i=s.contains(t))>-1&&(P((i=s.ranges[i]).from(),t)<0||t.xRel>0)&&(P(i.to(),t)>0||t.xRel<0)?Ho(e,n,t,o):Eo(e,n,t,o)}function Ho(e,t,r,n){var i=e.display,o=!1,l=dn(e,function(t){ml&&(i.scroller.draggable=!1),e.state.draggingText=!1,ke(document,"mouseup",l),ke(document,"mousemove",s),ke(i.scroller,"dragstart",a),ke(i.scroller,"drop",l),o||(We(t),n.addNew||di(e.doc,r,null,null,n.extend),ml||gl&&9==vl?setTimeout(function(){document.body.focus(),i.input.focus()},20):i.input.focus())}),s=function(e){o=o||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},a=function(){return o=!0};ml&&(i.scroller.draggable=!0),e.state.draggingText=l,l.copy=!n.moveOnDrag,i.scroller.dragDrop&&i.scroller.dragDrop(),Ql(document,"mouseup",l),Ql(document,"mousemove",s),Ql(i.scroller,"dragstart",a),Ql(i.scroller,"drop",l),Dr(e),setTimeout(function(){return i.input.focus()},20)}function Fo(e,t,r){if("char"==r)return new Ts(t,t);if("word"==r)return e.findWordAt(t);if("line"==r)return new Ts(E(t.line,0),U(e.doc,E(t.line+1,0)));var n=r(e,t);return new Ts(n.from,n.to)}function Eo(e,t,r,n){function i(t){if(0!=P(m,t))if(m=t,"rectangle"==n.unit){for(var i=[],o=e.options.tabSize,l=f(M(u,r.line).text,r.ch,o),s=f(M(u,t.line).text,t.ch,o),a=Math.min(l,s),g=Math.max(l,s),v=Math.min(r.line,t.line),y=Math.min(e.lastLine(),Math.max(r.line,t.line));v<=y;v++){var b=M(u,v).text,w=d(b,a,o);a==g?i.push(new Ts(E(v,w),E(v,w))):b.length>w&&i.push(new Ts(E(v,w),E(v,d(b,g,o))))}i.length||i.push(new Ts(r,r)),bi(u,zn(p.ranges.slice(0,h).concat(i),h),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var x,C=c,S=Fo(e,t,n.unit),L=C.anchor;P(S.anchor,L)>0?(x=S.head,L=B(C.from(),S.anchor)):(x=S.anchor,L=R(C.to(),S.head));var k=p.ranges.slice(0);k[h]=Po(e,new Ts(U(u,L),x)),bi(u,zn(k,h),Ul)}}function o(t){var r=++b,s=Sr(e,t,!0,"rectangle"==n.unit);if(s)if(0!=P(s,m)){e.curOp.focus=l(),i(s);var c=Ir(a,u);(s.line>=c.to||s.line<c.from)&&setTimeout(dn(e,function(){b==r&&o(t)}),150)}else{var f=t.clientY<y.top?-20:t.clientY>y.bottom?20:0;f&&setTimeout(dn(e,function(){b==r&&(a.scroller.scrollTop+=f,o(t))}),50)}}function s(t){e.state.selectingText=!1,b=1/0,We(t),a.input.focus(),ke(document,"mousemove",w),ke(document,"mouseup",x),u.history.lastSelOrigin=null}var a=e.display,u=e.doc;We(t);var c,h,p=u.sel,g=p.ranges;if(n.addNew&&!n.extend?(h=u.sel.contains(r),c=h>-1?g[h]:new Ts(r,r)):(c=u.sel.primary(),h=u.sel.primIndex),"rectangle"==n.unit)n.addNew||(c=new Ts(r,r)),r=Sr(e,t,!0,!0),h=-1;else{var v=Fo(e,r,n.unit);c=n.extend?hi(c,v.anchor,v.head,n.extend):v}n.addNew?-1==h?(h=g.length,bi(u,zn(g.concat([c]),h),{scroll:!1,origin:"*mouse"})):g.length>1&&g[h].empty()&&"char"==n.unit&&!n.extend?(bi(u,zn(g.slice(0,h).concat(g.slice(h+1)),0),{scroll:!1,origin:"*mouse"}),p=u.sel):gi(u,h,c,Ul):(h=0,bi(u,new ks([c],0),Ul),p=u.sel);var m=r,y=a.wrapper.getBoundingClientRect(),b=0,w=dn(e,function(e){Pe(e)?o(e):s(e)}),x=dn(e,s);e.state.selectingText=x,Ql(document,"mousemove",w),Ql(document,"mouseup",x)}function Po(e,t){var r=t.anchor,n=t.head,i=M(e.doc,r.line);if(0==P(r,n)&&r.sticky==n.sticky)return t;var o=Se(i);if(!o)return t;var l=Ce(o,r.ch,r.sticky),s=o[l];if(s.from!=r.ch&&s.to!=r.ch)return t;var a=l+(s.from==r.ch==(1!=s.level)?0:1);if(0==a||a==o.length)return t;var u;if(n.line!=r.line)u=(n.line-r.line)*("ltr"==e.doc.direction?1:-1)>0;else{var c=Ce(o,n.ch,n.sticky),f=c-l||(n.ch-r.ch)*(1==s.level?-1:1);u=c==a-1||c==a?f<0:f>0}var h=o[a+(u?-1:0)],d=u==(1==h.level),p=d?h.from:h.to,g=d?"after":"before";return r.ch==p&&r.sticky==g?t:new Ts(new E(r.line,p,g),n)}function Io(e,t,r,n){var i,o;if(t.touches)i=t.touches[0].clientX,o=t.touches[0].clientY;else try{i=t.clientX,o=t.clientY}catch(t){return!1}if(i>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;n&&We(t);var l=e.display,s=l.lineDiv.getBoundingClientRect();if(o>s.bottom||!Oe(e,r))return He(t);o-=s.top-l.viewOffset;for(var a=0;a<e.options.gutters.length;++a){var u=l.gutters.childNodes[a];if(u&&u.getBoundingClientRect().right>=i)return Te(e,r,e,D(e.doc,o),e.options.gutters[a],t),He(t)}}function zo(e,t){return Io(e,t,"gutterClick",!0)}function Ro(e,t){Ft(e.display,t)||Bo(e,t)||Me(e,t,"contextmenu")||e.display.input.onContextMenu(t)}function Bo(e,t){return!!Oe(e,"gutterContextMenu")&&Io(e,t,"gutterContextMenu",!1)}function Go(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),er(e)}function Uo(e){Hn(e),vn(e),zr(e)}function Vo(e,t,r){if(!t!=!(r&&r!=Xs)){var n=e.display.dragFunctions,i=t?Ql:ke;i(e.display.scroller,"dragstart",n.start),i(e.display.scroller,"dragenter",n.enter),i(e.display.scroller,"dragover",n.over),i(e.display.scroller,"dragleave",n.leave),i(e.display.scroller,"drop",n.drop)}}function Ko(e){e.options.lineWrapping?(s(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(Fl(e.display.wrapper,"CodeMirror-wrap"),we(e)),Cr(e),vn(e),er(e),setTimeout(function(){return en(e)},100)}function jo(e,t){var r=this;if(!(this instanceof jo))return new jo(e,t);this.options=t=t?c(t):{},c(Ys,t,!1),Fn(t);var n=t.value;"string"==typeof n&&(n=new Ds(n,t.mode,null,t.lineSeparator,t.direction)),this.doc=n;var i=new jo.inputStyles[t.inputStyle](this),o=this.display=new T(e,n,i);o.wrapper.CodeMirror=this,Hn(this),Go(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),rn(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new Pl,keySeq:null,specialChars:null},t.autofocus&&!Tl&&o.input.focus(),gl&&vl<11&&setTimeout(function(){return r.display.input.reset(!0)},20),Xo(this),eo(),nn(this),this.curOp.forceUpdate=!0,qn(this,n),t.autofocus&&!Tl||this.hasFocus()?setTimeout(u(Hr,this),20):Fr(this);for(var l in _s)_s.hasOwnProperty(l)&&_s[l](r,t[l],Xs);Rr(this),t.finishInit&&t.finishInit(this);for(var s=0;s<$s.length;++s)$s[s](r);on(this),ml&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function Xo(e){function t(){i.activeTouch&&(o=setTimeout(function(){return i.activeTouch=null},1e3),(l=i.activeTouch).end=+new Date)}function r(e){if(1!=e.touches.length)return!1;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function n(e,t){if(null==t.left)return!0;var r=t.left-e.left,n=t.top-e.top;return r*r+n*n>400}var i=e.display;Ql(i.scroller,"mousedown",dn(e,Oo)),gl&&vl<11?Ql(i.scroller,"dblclick",dn(e,function(t){if(!Me(e,t)){var r=Sr(e,t);if(r&&!zo(e,t)&&!Ft(e.display,t)){We(t);var n=e.findWordAt(r);di(e.doc,n.anchor,n.head)}}})):Ql(i.scroller,"dblclick",function(t){return Me(e,t)||We(t)}),Hl||Ql(i.scroller,"contextmenu",function(t){return Ro(e,t)});var o,l={end:0};Ql(i.scroller,"touchstart",function(t){if(!Me(e,t)&&!r(t)&&!zo(e,t)){i.input.ensurePolled(),clearTimeout(o);var n=+new Date;i.activeTouch={start:n,moved:!1,prev:n-l.end<=300?l:null},1==t.touches.length&&(i.activeTouch.left=t.touches[0].pageX,i.activeTouch.top=t.touches[0].pageY)}}),Ql(i.scroller,"touchmove",function(){i.activeTouch&&(i.activeTouch.moved=!0)}),Ql(i.scroller,"touchend",function(r){var o=i.activeTouch;if(o&&!Ft(i,r)&&null!=o.left&&!o.moved&&new Date-o.start<300){var l,s=e.coordsChar(i.activeTouch,"page");l=!o.prev||n(o,o.prev)?new Ts(s,s):!o.prev.prev||n(o,o.prev.prev)?e.findWordAt(s):new Ts(E(s.line,0),U(e.doc,E(s.line+1,0))),e.setSelection(l.anchor,l.head),e.focus(),We(r)}t()}),Ql(i.scroller,"touchcancel",t),Ql(i.scroller,"scroll",function(){i.scroller.clientHeight&&(qr(e,i.scroller.scrollTop),Qr(e,i.scroller.scrollLeft,!0),Te(e,"scroll",e))}),Ql(i.scroller,"mousewheel",function(t){return In(e,t)}),Ql(i.scroller,"DOMMouseScroll",function(t){return In(e,t)}),Ql(i.wrapper,"scroll",function(){return i.wrapper.scrollTop=i.wrapper.scrollLeft=0}),i.dragFunctions={enter:function(t){Me(e,t)||Fe(t)},over:function(t){Me(e,t)||(Zi(e,t),Fe(t))},start:function(t){return qi(e,t)},drop:dn(e,$i),leave:function(t){Me(e,t)||Qi(e)}};var s=i.input.getField();Ql(s,"keyup",function(t){return To.call(e,t)}),Ql(s,"keydown",dn(e,Lo)),Ql(s,"keypress",dn(e,Mo)),Ql(s,"focus",function(t){return Hr(e,t)}),Ql(s,"blur",function(t){return Fr(e,t)})}function Yo(e,t,r,n){var i,o=e.doc;null==r&&(r="add"),"smart"==r&&(o.mode.indent?i=$e(e,t).state:r="prev");var l=e.options.tabSize,s=M(o,t),a=f(s.text,null,l);s.stateAfter&&(s.stateAfter=null);var u,c=s.text.match(/^\s*/)[0];if(n||/\S/.test(s.text)){if("smart"==r&&((u=o.mode.indent(i,s.text.slice(c.length),s.text))==Bl||u>150)){if(!n)return;r="prev"}}else u=0,r="not";"prev"==r?u=t>o.first?f(M(o,t-1).text,null,l):0:"add"==r?u=a+e.options.indentUnit:"subtract"==r?u=a-e.options.indentUnit:"number"==typeof r&&(u=a+r),u=Math.max(0,u);var h="",d=0;if(e.options.indentWithTabs)for(var g=Math.floor(u/l);g;--g)d+=l,h+="\t";if(d<u&&(h+=p(u-d)),h!=c)return Ei(o,h,E(t,0),E(t,c.length),"+input"),s.stateAfter=null,!0;for(var v=0;v<o.sel.ranges.length;v++){var m=o.sel.ranges[v];if(m.head.line==t&&m.head.ch<c.length){var y=E(t,c.length);gi(o,v,new Ts(y,y));break}}}function _o(e){qs=e}function $o(e,t,r,n,i){var o=e.doc;e.display.shift=!1,n||(n=o.sel);var l=e.state.pasteIncoming||"paste"==i,s=es(t),a=null;if(l&&n.ranges.length>1)if(qs&&qs.text.join("\n")==t){if(n.ranges.length%qs.text.length==0){a=[];for(var u=0;u<qs.text.length;u++)a.push(o.splitLines(qs.text[u]))}}else s.length==n.ranges.length&&e.options.pasteLinesPerSelection&&(a=v(s,function(e){return[e]}));for(var c,f=n.ranges.length-1;f>=0;f--){var h=n.ranges[f],d=h.from(),p=h.to();h.empty()&&(r&&r>0?d=E(d.line,d.ch-r):e.state.overwrite&&!l?p=E(p.line,Math.min(M(o,p.line).text.length,p.ch+g(s).length)):qs&&qs.lineWise&&qs.text.join("\n")==t&&(d=p=E(d.line,0))),c=e.curOp.updateInput;var m={from:d,to:p,text:a?a[f%a.length]:s,origin:i||(l?"paste":e.state.cutIncoming?"cut":"+input")};Oi(e.doc,m),bt(e,"inputRead",e,m)}t&&!l&&Zo(e,t),jr(e),e.curOp.updateInput=c,e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=!1}function qo(e,t){var r=e.clipboardData&&e.clipboardData.getData("Text");if(r)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||hn(t,function(){return $o(t,r,0,null,"paste")}),!0}function Zo(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var r=e.doc.sel,n=r.ranges.length-1;n>=0;n--){var i=r.ranges[n];if(!(i.head.ch>100||n&&r.ranges[n-1].head.line==i.head.line)){var o=e.getModeAt(i.head),l=!1;if(o.electricChars){for(var s=0;s<o.electricChars.length;s++)if(t.indexOf(o.electricChars.charAt(s))>-1){l=Yo(e,i.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(M(e.doc,i.head.line).text.slice(0,i.head.ch))&&(l=Yo(e,i.head.line,"smart"));l&&bt(e,"electricInput",e,i.head.line)}}}function Qo(e){for(var t=[],r=[],n=0;n<e.doc.sel.ranges.length;n++){var i=e.doc.sel.ranges[n].head.line,o={anchor:E(i,0),head:E(i+1,0)};r.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:r}}function Jo(e,t){e.setAttribute("autocorrect","off"),e.setAttribute("autocapitalize","off"),e.setAttribute("spellcheck",!!t)}function el(){var e=n("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),t=n("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return ml?e.style.width="1000px":e.setAttribute("wrap","off"),Ll&&(e.style.border="1px solid black"),Jo(e),t}function tl(e,t,r,n,i){function o(){var n=t.line+r;return!(n<e.first||n>=e.first+e.size)&&(t=new E(n,t.ch,t.sticky),u=M(e,n))}function l(n){var l;if(null==(l=i?go(e.cm,u,t,r):ho(u,t,r))){if(n||!o())return!1;t=po(i,e.cm,u,t.line,r)}else t=l;return!0}var s=t,a=r,u=M(e,t.line);if("char"==n)l();else if("column"==n)l(!0);else if("word"==n||"group"==n)for(var c=null,f="group"==n,h=e.cm&&e.cm.getHelper(t,"wordChars"),d=!0;!(r<0)||l(!d);d=!1){var p=u.text.charAt(t.ch)||"\n",g=x(p,h)?"w":f&&"\n"==p?"n":!f||/\s/.test(p)?null:"p";if(!f||d||g||(g="s"),c&&c!=g){r<0&&(r=1,l(),t.sticky="after");break}if(g&&(c=g),r>0&&!l(!d))break}var v=ki(e,t,s,a,!0);return I(s,v)&&(v.hitSide=!0),v}function rl(e,t,r,n){var i,o=e.doc,l=t.left;if("page"==n){var s=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),a=Math.max(s-.5*mr(e.display),3);i=(r>0?t.bottom:t.top)+r*a}else"line"==n&&(i=r>0?t.bottom+3:t.top-3);for(var u;(u=cr(e,l,i)).outside;){if(r<0?i<=0:i>=o.height){u.hitSide=!0;break}i+=5*r}return u}function nl(e,t){var r=jt(e,t.line);if(!r||r.hidden)return null;var n=M(e.doc,t.line),i=Ut(r,n,t.line),o=Se(n,e.doc.direction),l="left";o&&(l=Ce(o,t.ch)%2?"right":"left");var s=_t(i.map,t.ch,l);return s.offset="right"==s.collapse?s.end:s.start,s}function il(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}function ol(e,t){return t&&(e.bad=!0),e}function ll(e,t,r,n,i){function o(e){return function(t){return t.id==e}}function l(){c&&(u+=f,c=!1)}function s(e){e&&(l(),u+=e)}function a(t){if(1==t.nodeType){var r=t.getAttribute("cm-text");if(null!=r)return void s(r||t.textContent.replace(/\u200b/g,""));var u,h=t.getAttribute("cm-marker");if(h){var d=e.findMarks(E(n,0),E(i+1,0),o(+h));return void(d.length&&(u=d[0].find(0))&&s(N(e.doc,u.from,u.to).join(f)))}if("false"==t.getAttribute("contenteditable"))return;var p=/^(pre|div|p)$/i.test(t.nodeName);p&&l();for(var g=0;g<t.childNodes.length;g++)a(t.childNodes[g]);p&&(c=!0)}else 3==t.nodeType&&s(t.nodeValue)}for(var u="",c=!1,f=e.doc.lineSeparator();a(t),t!=r;)t=t.nextSibling;return u}function sl(e,t,r){var n;if(t==e.display.lineDiv){if(!(n=e.display.lineDiv.childNodes[r]))return ol(e.clipPos(E(e.display.viewTo-1)),!0);t=null,r=0}else for(n=t;;n=n.parentNode){if(!n||n==e.display.lineDiv)return null;if(n.parentNode&&n.parentNode==e.display.lineDiv)break}for(var i=0;i<e.display.view.length;i++){var o=e.display.view[i];if(o.node==n)return al(o,t,r)}}function al(e,t,r){function n(t,r,n){for(var i=-1;i<(f?f.length:0);i++)for(var o=i<0?c.map:f[i],l=0;l<o.length;l+=3){var s=o[l+2];if(s==t||s==r){var a=W(i<0?e.line:e.rest[i]),u=o[l]+n;return(n<0||s!=t)&&(u=o[l+(n?1:0)]),E(a,u)}}}var i=e.text.firstChild,l=!1;if(!t||!o(i,t))return ol(E(W(e.line),0),!0);if(t==i&&(l=!0,t=i.childNodes[r],r=0,!t)){var s=e.rest?g(e.rest):e.line;return ol(E(W(s),s.text.length),l)}var a=3==t.nodeType?t:null,u=t;for(a||1!=t.childNodes.length||3!=t.firstChild.nodeType||(a=t.firstChild,r&&(r=a.nodeValue.length));u.parentNode!=i;)u=u.parentNode;var c=e.measure,f=c.maps,h=n(a,u,r);if(h)return ol(h,l);for(var d=u.nextSibling,p=a?a.nodeValue.length-r:0;d;d=d.nextSibling){if(h=n(d,d.firstChild,0))return ol(E(h.line,h.ch-p),l);p+=d.textContent.length}for(var v=u.previousSibling,m=r;v;v=v.previousSibling){if(h=n(v,v.firstChild,-1))return ol(E(h.line,h.ch+m),l);m+=v.textContent.length}}var ul=navigator.userAgent,cl=navigator.platform,fl=/gecko\/\d/i.test(ul),hl=/MSIE \d/.test(ul),dl=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ul),pl=/Edge\/(\d+)/.exec(ul),gl=hl||dl||pl,vl=gl&&(hl?document.documentMode||6:+(pl||dl)[1]),ml=!pl&&/WebKit\//.test(ul),yl=ml&&/Qt\/\d+\.\d+/.test(ul),bl=!pl&&/Chrome\//.test(ul),wl=/Opera\//.test(ul),xl=/Apple Computer/.test(navigator.vendor),Cl=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(ul),Sl=/PhantomJS/.test(ul),Ll=!pl&&/AppleWebKit/.test(ul)&&/Mobile\/\w+/.test(ul),kl=/Android/.test(ul),Tl=Ll||kl||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(ul),Ml=Ll||/Mac/.test(cl),Nl=/\bCrOS\b/.test(ul),Ol=/win/i.test(cl),Al=wl&&ul.match(/Version\/(\d*\.\d*)/);Al&&(Al=Number(Al[1])),Al&&Al>=15&&(wl=!1,ml=!0);var Wl,Dl=Ml&&(yl||wl&&(null==Al||Al<12.11)),Hl=fl||gl&&vl>=9,Fl=function(t,r){var n=t.className,i=e(r).exec(n);if(i){var o=n.slice(i.index+i[0].length);t.className=n.slice(0,i.index)+(o?i[1]+o:"")}};Wl=document.createRange?function(e,t,r,n){var i=document.createRange();return i.setEnd(n||e,r),i.setStart(e,t),i}:function(e,t,r){var n=document.body.createTextRange();try{n.moveToElementText(e.parentNode)}catch(e){return n}return n.collapse(!0),n.moveEnd("character",r),n.moveStart("character",t),n};var El=function(e){e.select()};Ll?El=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:gl&&(El=function(e){try{e.select()}catch(e){}});var Pl=function(){this.id=null};Pl.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var Il,zl,Rl=30,Bl={toString:function(){return"CodeMirror.Pass"}},Gl={scroll:!1},Ul={origin:"*mouse"},Vl={origin:"+move"},Kl=[""],jl=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Xl=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,Yl=!1,_l=!1,$l=null,ql=function(){function e(e){return e<=247?r.charAt(e):1424<=e&&e<=1524?"R":1536<=e&&e<=1785?n.charAt(e-1536):1774<=e&&e<=2220?"r":8192<=e&&e<=8203?"w":8204==e?"b":"L"}function t(e,t,r){this.level=e,this.from=t,this.to=r}var r="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",n="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111",i=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,l=/[LRr]/,s=/[Lb1n]/,a=/[1n]/;return function(r,n){var u="ltr"==n?"L":"R";if(0==r.length||"ltr"==n&&!i.test(r))return!1;for(var c=r.length,f=[],h=0;h<c;++h)f.push(e(r.charCodeAt(h)));for(var d=0,p=u;d<c;++d){var v=f[d];"m"==v?f[d]=p:p=v}for(var m=0,y=u;m<c;++m){var b=f[m];"1"==b&&"r"==y?f[m]="n":l.test(b)&&(y=b,"r"==b&&(f[m]="R"))}for(var w=1,x=f[0];w<c-1;++w){var C=f[w];"+"==C&&"1"==x&&"1"==f[w+1]?f[w]="1":","!=C||x!=f[w+1]||"1"!=x&&"n"!=x||(f[w]=x),x=C}for(var S=0;S<c;++S){var L=f[S];if(","==L)f[S]="N";else if("%"==L){var k=void 0;for(k=S+1;k<c&&"%"==f[k];++k);for(var T=S&&"!"==f[S-1]||k<c&&"1"==f[k]?"1":"N",M=S;M<k;++M)f[M]=T;S=k-1}}for(var N=0,O=u;N<c;++N){var A=f[N];"L"==O&&"1"==A?f[N]="L":l.test(A)&&(O=A)}for(var W=0;W<c;++W)if(o.test(f[W])){var D=void 0;for(D=W+1;D<c&&o.test(f[D]);++D);for(var H="L"==(W?f[W-1]:u),F=H==("L"==(D<c?f[D]:u))?H?"L":"R":u,E=W;E<D;++E)f[E]=F;W=D-1}for(var P,I=[],z=0;z<c;)if(s.test(f[z])){var R=z;for(++z;z<c&&s.test(f[z]);++z);I.push(new t(0,R,z))}else{var B=z,G=I.length;for(++z;z<c&&"L"!=f[z];++z);for(var U=B;U<z;)if(a.test(f[U])){B<U&&I.splice(G,0,new t(1,B,U));var V=U;for(++U;U<z&&a.test(f[U]);++U);I.splice(G,0,new t(2,V,U)),B=U}else++U;B<z&&I.splice(G,0,new t(1,B,z))}return 1==I[0].level&&(P=r.match(/^\s+/))&&(I[0].from=P[0].length,I.unshift(new t(0,0,P[0].length))),1==g(I).level&&(P=r.match(/\s+$/))&&(g(I).to-=P[0].length,I.push(new t(0,c-P[0].length,c))),"rtl"==n?I.reverse():I}}(),Zl=[],Ql=function(e,t,r){if(e.addEventListener)e.addEventListener(t,r,!1);else if(e.attachEvent)e.attachEvent("on"+t,r);else{var n=e._handlers||(e._handlers={});n[t]=(n[t]||Zl).concat(r)}},Jl=function(){if(gl&&vl<9)return!1;var e=n("div");return"draggable"in e||"dragDrop"in e}(),es=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,r=[],n=e.length;t<=n;){var i=e.indexOf("\n",t);-1==i&&(i=e.length);var o=e.slice(t,"\r"==e.charAt(i-1)?i-1:i),l=o.indexOf("\r");-1!=l?(r.push(o.slice(0,l)),t+=l+1):(r.push(o),t=i+1)}return r}:function(e){return e.split(/\r\n?|\n/)},ts=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},rs=function(){var e=n("div");return"oncopy"in e||(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),ns=null,is={},os={},ls={},ss=function(e,t,r){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=r};ss.prototype.eol=function(){return this.pos>=this.string.length},ss.prototype.sol=function(){return this.pos==this.lineStart},ss.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},ss.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},ss.prototype.eat=function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},ss.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},ss.prototype.eatSpace=function(){for(var e=this,t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++e.pos;return this.pos>t},ss.prototype.skipToEnd=function(){this.pos=this.string.length},ss.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},ss.prototype.backUp=function(e){this.pos-=e},ss.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=f(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?f(this.string,this.lineStart,this.tabSize):0)},ss.prototype.indentation=function(){return f(this.string,null,this.tabSize)-(this.lineStart?f(this.string,this.lineStart,this.tabSize):0)},ss.prototype.match=function(e,t,r){if("string"!=typeof e){var n=this.string.slice(this.pos).match(e);return n&&n.index>0?null:(n&&!1!==t&&(this.pos+=n[0].length),n)}var i=function(e){return r?e.toLowerCase():e};if(i(this.string.substr(this.pos,e.length))==i(e))return!1!==t&&(this.pos+=e.length),!0},ss.prototype.current=function(){return this.string.slice(this.start,this.pos)},ss.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},ss.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)};var as=function(e,t){this.state=e,this.lookAhead=t},us=function(e,t,r,n){this.state=t,this.doc=e,this.line=r,this.maxLookAhead=n||0};us.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},us.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},us.fromSaved=function(e,t,r){return t instanceof as?new us(e,Ke(e.mode,t.state),r,t.lookAhead):new us(e,Ke(e.mode,t),r)},us.prototype.save=function(e){var t=!1!==e?Ke(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new as(t,this.maxLookAhead):t};var cs=function(e,t,r){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=r},fs=function(e,t,r){this.text=e,ne(this,t),this.height=r?r(this):1};fs.prototype.lineNo=function(){return W(this)},Ae(fs);var hs,ds={},ps={},gs=null,vs=null,ms={left:0,right:0,top:0,bottom:0},ys=function(e,t,r){this.cm=r;var i=this.vert=n("div",[n("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),o=this.horiz=n("div",[n("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");e(i),e(o),Ql(i,"scroll",function(){i.clientHeight&&t(i.scrollTop,"vertical")}),Ql(o,"scroll",function(){o.clientWidth&&t(o.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,gl&&vl<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};ys.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,r=e.scrollHeight>e.clientHeight+1,n=e.nativeBarWidth;if(r){this.vert.style.display="block",this.vert.style.bottom=t?n+"px":"0";var i=e.viewHeight-(t?n:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+i)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=r?n+"px":"0",this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(r?n:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==n&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:r?n:0,bottom:t?n:0}},ys.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},ys.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},ys.prototype.zeroWidthHack=function(){var e=Ml&&!Cl?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Pl,this.disableVert=new Pl},ys.prototype.enableZeroWidthBar=function(e,t,r){function n(){var i=e.getBoundingClientRect();("vert"==r?document.elementFromPoint(i.right-1,(i.top+i.bottom)/2):document.elementFromPoint((i.right+i.left)/2,i.bottom-1))!=e?e.style.pointerEvents="none":t.set(1e3,n)}e.style.pointerEvents="auto",t.set(1e3,n)},ys.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var bs=function(){};bs.prototype.update=function(){return{bottom:0,right:0}},bs.prototype.setScrollLeft=function(){},bs.prototype.setScrollTop=function(){},bs.prototype.clear=function(){};var ws={native:ys,null:bs},xs=0,Cs=function(e,t,r){var n=e.display;this.viewport=t,this.visible=Ir(n,e.doc,t),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=Rt(e),this.force=r,this.dims=br(e),this.events=[]};Cs.prototype.signal=function(e,t){Oe(e,t)&&this.events.push(arguments)},Cs.prototype.finish=function(){for(var e=this,t=0;t<this.events.length;t++)Te.apply(null,e.events[t])};var Ss=0,Ls=null;gl?Ls=-.53:fl?Ls=15:bl?Ls=-.7:xl&&(Ls=-1/3);var ks=function(e,t){this.ranges=e,this.primIndex=t};ks.prototype.primary=function(){return this.ranges[this.primIndex]},ks.prototype.equals=function(e){var t=this;if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var r=0;r<this.ranges.length;r++){var n=t.ranges[r],i=e.ranges[r];if(!I(n.anchor,i.anchor)||!I(n.head,i.head))return!1}return!0},ks.prototype.deepCopy=function(){for(var e=this,t=[],r=0;r<this.ranges.length;r++)t[r]=new Ts(z(e.ranges[r].anchor),z(e.ranges[r].head));return new ks(t,this.primIndex)},ks.prototype.somethingSelected=function(){for(var e=this,t=0;t<this.ranges.length;t++)if(!e.ranges[t].empty())return!0;return!1},ks.prototype.contains=function(e,t){var r=this;t||(t=e);for(var n=0;n<this.ranges.length;n++){var i=r.ranges[n];if(P(t,i.from())>=0&&P(e,i.to())<=0)return n}return-1};var Ts=function(e,t){this.anchor=e,this.head=t};Ts.prototype.from=function(){return B(this.anchor,this.head)},Ts.prototype.to=function(){return R(this.anchor,this.head)},Ts.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},Bi.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var r=this,n=e,i=e+t;n<i;++n){var o=r.lines[n];r.height-=o.height,ot(o),bt(o,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,r){var n=this;this.height+=r,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var i=0;i<t.length;++i)t[i].parent=n},iterN:function(e,t,r){for(var n=this,i=e+t;e<i;++e)if(r(n.lines[e]))return!0}},Gi.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){var r=this;this.size-=t;for(var n=0;n<this.children.length;++n){var i=r.children[n],o=i.chunkSize();if(e<o){var l=Math.min(t,o-e),s=i.height;if(i.removeInner(e,l),r.height-=s-i.height,o==l&&(r.children.splice(n--,1),i.parent=null),0==(t-=l))break;e=0}else e-=o}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof Bi))){var a=[];this.collapse(a),this.children=[new Bi(a)],this.children[0].parent=this}},collapse:function(e){for(var t=this,r=0;r<this.children.length;++r)t.children[r].collapse(e)},insertInner:function(e,t,r){var n=this;this.size+=t.length,this.height+=r;for(var i=0;i<this.children.length;++i){var o=n.children[i],l=o.chunkSize();if(e<=l){if(o.insertInner(e,t,r),o.lines&&o.lines.length>50){for(var s=o.lines.length%25+25,a=s;a<o.lines.length;){var u=new Bi(o.lines.slice(a,a+=25));o.height-=u.height,n.children.splice(++i,0,u),u.parent=n}o.lines=o.lines.slice(0,s),n.maybeSpill()}break}e-=l}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=new Gi(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var r=h(e.parent.children,e);e.parent.children.splice(r+1,0,t)}else{var n=new Gi(e.children);n.parent=e,e.children=[n,t],e=n}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,r){for(var n=this,i=0;i<this.children.length;++i){var o=n.children[i],l=o.chunkSize();if(e<l){var s=Math.min(t,l-e);if(o.iterN(e,s,r))return!0;if(0==(t-=s))break;e=0}else e-=l}}};var Ms=function(e,t,r){var n=this;if(r)for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i]);this.doc=e,this.node=t};Ms.prototype.clear=function(){var e=this,t=this.doc.cm,r=this.line.widgets,n=this.line,i=W(n);if(null!=i&&r){for(var o=0;o<r.length;++o)r[o]==e&&r.splice(o--,1);r.length||(n.widgets=null);var l=Ht(this);A(n,Math.max(0,n.height-l)),t&&(hn(t,function(){Ui(t,n,-l),mn(t,i,"widget")}),bt(t,"lineWidgetCleared",t,this,i))}},Ms.prototype.changed=function(){var e=this,t=this.height,r=this.doc.cm,n=this.line;this.height=null;var i=Ht(this)-t;i&&(A(n,n.height+i),r&&hn(r,function(){r.curOp.forceUpdate=!0,Ui(r,n,i),bt(r,"lineWidgetChanged",r,e,W(n))}))},Ae(Ms);var Ns=0,Os=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++Ns};Os.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){var t=this.doc.cm,r=t&&!t.curOp;if(r&&nn(t),Oe(this,"clear")){var n=this.find();n&&bt(this,"clear",n.from,n.to)}for(var i=null,o=null,l=0;l<this.lines.length;++l){var s=e.lines[l],a=_(s.markedSpans,e);t&&!e.collapsed?mn(t,W(s),"text"):t&&(null!=a.to&&(o=W(s)),null!=a.from&&(i=W(s))),s.markedSpans=$(s.markedSpans,a),null==a.from&&e.collapsed&&!ve(e.doc,s)&&t&&A(s,mr(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(var u=0;u<this.lines.length;++u){var c=fe(e.lines[u]),f=be(c);f>t.display.maxLineLength&&(t.display.maxLine=c,t.display.maxLineLength=f,t.display.maxLineChanged=!0)}null!=i&&t&&this.collapsed&&vn(t,i,o+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&Ci(t.doc)),t&&bt(t,"markerCleared",t,this,i,o),r&&on(t),this.parent&&this.parent.clear()}},Os.prototype.find=function(e,t){var r=this;null==e&&"bookmark"==this.type&&(e=1);for(var n,i,o=0;o<this.lines.length;++o){var l=r.lines[o],s=_(l.markedSpans,r);if(null!=s.from&&(n=E(t?l:W(l),s.from),-1==e))return n;if(null!=s.to&&(i=E(t?l:W(l),s.to),1==e))return i}return n&&{from:n,to:i}},Os.prototype.changed=function(){var e=this,t=this.find(-1,!0),r=this,n=this.doc.cm;t&&n&&hn(n,function(){var i=t.line,o=W(t.line),l=jt(n,o);if(l&&(Qt(l),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!ve(r.doc,i)&&null!=r.height){var s=r.height;r.height=null;var a=Ht(r)-s;a&&A(i,i.height+a)}bt(n,"markerChanged",n,e)})},Os.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=h(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},Os.prototype.detachLine=function(e){if(this.lines.splice(h(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},Ae(Os);var As=function(e,t){var r=this;this.markers=e,this.primary=t;for(var n=0;n<e.length;++n)e[n].parent=r};As.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)e.markers[t].clear();bt(this,"clear")}},As.prototype.find=function(e,t){return this.primary.find(e,t)},Ae(As);var Ws=0,Ds=function(e,t,r,n,i){if(!(this instanceof Ds))return new Ds(e,t,r,n,i);null==r&&(r=0),Gi.call(this,[new Bi([new fs("",null)])]),this.first=r,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=r;var o=E(r,0);this.sel=Rn(o),this.history=new Jn(null),this.id=++Ws,this.modeOption=t,this.lineSep=n,this.direction="rtl"==i?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),_n(this,{from:o,to:o,text:e}),bi(this,Rn(o),Gl)};Ds.prototype=b(Gi.prototype,{constructor:Ds,iter:function(e,t,r){r?this.iterN(e-this.first,t-e,r):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var r=0,n=0;n<t.length;++n)r+=t[n].height;this.insertInner(e-this.first,t,r)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=O(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:gn(function(e){var t=E(this.first,0),r=this.first+this.size-1;Oi(this,{from:t,to:E(r,M(this,r).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&Xr(this.cm,0,0),bi(this,Rn(t),Gl)}),replaceRange:function(e,t,r,n){Ei(this,e,t=U(this,t),r=r?U(this,r):t,n)},getRange:function(e,t,r){var n=N(this,U(this,e),U(this,t));return!1===r?n:n.join(r||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(H(this,e))return M(this,e)},getLineNumber:function(e){return W(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=M(this,e)),fe(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return U(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:gn(function(e,t,r){vi(this,U(this,"number"==typeof e?E(e,t||0):e),null,r)}),setSelection:gn(function(e,t,r){vi(this,U(this,e),U(this,t||e),r)}),extendSelection:gn(function(e,t,r){di(this,U(this,e),t&&U(this,t),r)}),extendSelections:gn(function(e,t){pi(this,K(this,e),t)}),extendSelectionsBy:gn(function(e,t){pi(this,K(this,v(this.sel.ranges,e)),t)}),setSelections:gn(function(e,t,r){var n=this;if(e.length){for(var i=[],o=0;o<e.length;o++)i[o]=new Ts(U(n,e[o].anchor),U(n,e[o].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),bi(this,zn(i,t),r)}}),addSelection:gn(function(e,t,r){var n=this.sel.ranges.slice(0);n.push(new Ts(U(this,e),U(this,t||e))),bi(this,zn(n,n.length-1),r)}),getSelection:function(e){for(var t,r=this,n=this.sel.ranges,i=0;i<n.length;i++){var o=N(r,n[i].from(),n[i].to());t=t?t.concat(o):o}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){for(var t=this,r=[],n=this.sel.ranges,i=0;i<n.length;i++){var o=N(t,n[i].from(),n[i].to());!1!==e&&(o=o.join(e||t.lineSeparator())),r[i]=o}return r},replaceSelection:function(e,t,r){for(var n=[],i=0;i<this.sel.ranges.length;i++)n[i]=e;this.replaceSelections(n,t,r||"+input")},replaceSelections:gn(function(e,t,r){for(var n=this,i=[],o=this.sel,l=0;l<o.ranges.length;l++){var s=o.ranges[l];i[l]={from:s.from(),to:s.to(),text:n.splitLines(e[l]),origin:r}}for(var a=t&&"end"!=t&&Kn(this,i,t),u=i.length-1;u>=0;u--)Oi(n,i[u]);a?yi(this,a):this.cm&&jr(this.cm)}),undo:gn(function(){Wi(this,"undo")}),redo:gn(function(){Wi(this,"redo")}),undoSelection:gn(function(){Wi(this,"undo",!0)}),redoSelection:gn(function(){Wi(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,r=0,n=0;n<e.done.length;n++)e.done[n].ranges||++t;for(var i=0;i<e.undone.length;i++)e.undone[i].ranges||++r;return{undo:t,redo:r}},clearHistory:function(){this.history=new Jn(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:fi(this.history.done),undone:fi(this.history.undone)}},setHistory:function(e){var t=this.history=new Jn(this.history.maxGeneration);t.done=fi(e.done.slice(0),null,!0),t.undone=fi(e.undone.slice(0),null,!0)},setGutterMarker:gn(function(e,t,r){return Ri(this,e,"gutter",function(e){var n=e.gutterMarkers||(e.gutterMarkers={});return n[t]=r,!r&&C(n)&&(e.gutterMarkers=null),!0})}),clearGutter:gn(function(e){var t=this;this.iter(function(r){r.gutterMarkers&&r.gutterMarkers[e]&&Ri(t,r,"gutter",function(){return r.gutterMarkers[e]=null,C(r.gutterMarkers)&&(r.gutterMarkers=null),!0})})}),lineInfo:function(e){var t;if("number"==typeof e){if(!H(this,e))return null;if(t=e,!(e=M(this,e)))return null}else if(null==(t=W(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:gn(function(t,r,n){return Ri(this,t,"gutter"==r?"gutter":"class",function(t){var i="text"==r?"textClass":"background"==r?"bgClass":"gutter"==r?"gutterClass":"wrapClass";if(t[i]){if(e(n).test(t[i]))return!1;t[i]+=" "+n}else t[i]=n;return!0})}),removeLineClass:gn(function(t,r,n){return Ri(this,t,"gutter"==r?"gutter":"class",function(t){var i="text"==r?"textClass":"background"==r?"bgClass":"gutter"==r?"gutterClass":"wrapClass",o=t[i];if(!o)return!1;if(null==n)t[i]=null;else{var l=o.match(e(n));if(!l)return!1;var s=l.index+l[0].length;t[i]=o.slice(0,l.index)+(l.index&&s!=o.length?" ":"")+o.slice(s)||null}return!0})}),addLineWidget:gn(function(e,t,r){return Vi(this,e,t,r)}),removeLineWidget:function(e){e.clear()},markText:function(e,t,r){return Ki(this,U(this,e),U(this,t),r,r&&r.type||"range")},setBookmark:function(e,t){var r={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return e=U(this,e),Ki(this,e,e,r,"bookmark")},findMarksAt:function(e){var t=[],r=M(this,(e=U(this,e)).line).markedSpans;if(r)for(var n=0;n<r.length;++n){var i=r[n];(null==i.from||i.from<=e.ch)&&(null==i.to||i.to>=e.ch)&&t.push(i.marker.parent||i.marker)}return t},findMarks:function(e,t,r){e=U(this,e),t=U(this,t);var n=[],i=e.line;return this.iter(e.line,t.line+1,function(o){var l=o.markedSpans;if(l)for(var s=0;s<l.length;s++){var a=l[s];null!=a.to&&i==e.line&&e.ch>=a.to||null==a.from&&i!=e.line||null!=a.from&&i==t.line&&a.from>=t.ch||r&&!r(a.marker)||n.push(a.marker.parent||a.marker)}++i}),n},getAllMarks:function(){var e=[];return this.iter(function(t){var r=t.markedSpans;if(r)for(var n=0;n<r.length;++n)null!=r[n].from&&e.push(r[n].marker)}),e},posFromIndex:function(e){var t,r=this.first,n=this.lineSeparator().length;return this.iter(function(i){var o=i.text.length+n;if(o>e)return t=e,!0;e-=o,++r}),U(this,E(r,t))},indexFromPos:function(e){var t=(e=U(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;var r=this.lineSeparator().length;return this.iter(this.first,e.line,function(e){t+=e.text.length+r}),t},copy:function(e){var t=new Ds(O(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,r=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<r&&(r=e.to);var n=new Ds(O(this,t,r),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],Yi(n,Xi(this)),n},unlinkDoc:function(e){var t=this;if(e instanceof jo&&(e=e.doc),this.linked)for(var r=0;r<this.linked.length;++r)if(t.linked[r].doc==e){t.linked.splice(r,1),e.unlinkDoc(t),_i(Xi(t));break}if(e.history==this.history){var n=[e.id];$n(e,function(e){return n.push(e.id)},!0),e.history=new Jn(null),e.history.done=fi(this.history.done,n),e.history.undone=fi(this.history.undone,n)}},iterLinkedDocs:function(e){$n(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):es(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:gn(function(e){"rtl"!=e&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter(function(e){return e.order=null}),this.cm&&Qn(this.cm))})}),Ds.prototype.eachLine=Ds.prototype.iter;for(var Hs=0,Fs=!1,Es={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Ps=0;Ps<10;Ps++)Es[Ps+48]=Es[Ps+96]=String(Ps);for(var Is=65;Is<=90;Is++)Es[Is]=String.fromCharCode(Is);for(var zs=1;zs<=12;zs++)Es[zs+111]=Es[zs+63235]="F"+zs;var Rs={};Rs.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Rs.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Rs.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Rs.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Rs.default=Ml?Rs.macDefault:Rs.pcDefault;var Bs={selectAll:Mi,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),Gl)},killLine:function(e){return co(e,function(t){if(t.empty()){var r=M(e.doc,t.head.line).text.length;return t.head.ch==r&&t.head.line<e.lastLine()?{from:t.head,to:E(t.head.line+1,0)}:{from:t.head,to:E(t.head.line,r)}}return{from:t.from(),to:t.to()}})},deleteLine:function(e){return co(e,function(t){return{from:E(t.from().line,0),to:U(e.doc,E(t.to().line+1,0))}})},delLineLeft:function(e){return co(e,function(e){return{from:E(e.from().line,0),to:e.from()}})},delWrappedLineLeft:function(e){return co(e,function(t){var r=e.charCoords(t.head,"div").top+5;return{from:e.coordsChar({left:0,top:r},"div"),to:t.from()}})},delWrappedLineRight:function(e){return co(e,function(t){var r=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div");return{from:t.from(),to:n}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(E(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(E(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy(function(t){return vo(e,t.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy(function(t){return yo(e,t.head)},{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy(function(t){return mo(e,t.head.line)},{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div")},Vl)},goLineLeft:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:r},"div")},Vl)},goLineLeftSmart:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:r},"div");return n.ch<e.getLine(n.line).search(/\S/)?yo(e,t.head):n},Vl)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"char")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],r=e.listSelections(),n=e.options.tabSize,i=0;i<r.length;i++){var o=r[i].from(),l=f(e.getLine(o.line),o.ch,n);t.push(p(n-l%n))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return hn(e,function(){for(var t=e.listSelections(),r=[],n=0;n<t.length;n++)if(t[n].empty()){var i=t[n].head,o=M(e.doc,i.line).text;if(o)if(i.ch==o.length&&(i=new E(i.line,i.ch-1)),i.ch>0)i=new E(i.line,i.ch+1),e.replaceRange(o.charAt(i.ch-1)+o.charAt(i.ch-2),E(i.line,i.ch-2),i,"+transpose");else if(i.line>e.doc.first){var l=M(e.doc,i.line-1).text;l&&(i=new E(i.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+l.charAt(l.length-1),E(i.line-1,l.length-1),i,"+transpose"))}r.push(new Ts(i,i))}e.setSelections(r)})},newlineAndIndent:function(e){return hn(e,function(){for(var t=e.listSelections(),r=t.length-1;r>=0;r--)e.replaceRange(e.doc.lineSeparator(),t[r].anchor,t[r].head,"+input");t=e.listSelections();for(var n=0;n<t.length;n++)e.indentLine(t[n].from().line,null,!0);jr(e)})},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}},Gs=new Pl,Us=null,Vs=function(e,t,r){this.time=e,this.pos=t,this.button=r};Vs.prototype.compare=function(e,t,r){return this.time+400>e&&0==P(t,this.pos)&&r==this.button};var Ks,js,Xs={toString:function(){return"CodeMirror.Init"}},Ys={},_s={};jo.defaults=Ys,jo.optionHandlers=_s;var $s=[];jo.defineInitHook=function(e){return $s.push(e)};var qs=null,Zs=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Pl,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};Zs.prototype.init=function(e){function t(e){if(!Me(i,e)){if(i.somethingSelected())_o({lineWise:!1,text:i.getSelections()}),"cut"==e.type&&i.replaceSelection("",null,"cut");else{if(!i.options.lineWiseCopyCut)return;var t=Qo(i);_o({lineWise:!0,text:t.text}),"cut"==e.type&&i.operation(function(){i.setSelections(t.ranges,0,Gl),i.replaceSelection("",null,"cut")})}if(e.clipboardData){e.clipboardData.clearData();var r=qs.text.join("\n");if(e.clipboardData.setData("Text",r),e.clipboardData.getData("Text")==r)return void e.preventDefault()}var l=el(),s=l.firstChild;i.display.lineSpace.insertBefore(l,i.display.lineSpace.firstChild),s.value=qs.text.join("\n");var a=document.activeElement;El(s),setTimeout(function(){i.display.lineSpace.removeChild(l),a.focus(),a==o&&n.showPrimarySelection()},50)}}var r=this,n=this,i=n.cm,o=n.div=e.lineDiv;Jo(o,i.options.spellcheck),Ql(o,"paste",function(e){Me(i,e)||qo(e,i)||vl<=11&&setTimeout(dn(i,function(){return r.updateFromDOM()}),20)}),Ql(o,"compositionstart",function(e){r.composing={data:e.data,done:!1}}),Ql(o,"compositionupdate",function(e){r.composing||(r.composing={data:e.data,done:!1})}),Ql(o,"compositionend",function(e){r.composing&&(e.data!=r.composing.data&&r.readFromDOMSoon(),r.composing.done=!0)}),Ql(o,"touchstart",function(){return n.forceCompositionEnd()}),Ql(o,"input",function(){r.composing||r.readFromDOMSoon()}),Ql(o,"copy",t),Ql(o,"cut",t)},Zs.prototype.prepareSelection=function(){var e=Tr(this.cm,!1);return e.focus=this.cm.state.focused,e},Zs.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},Zs.prototype.showPrimarySelection=function(){var e=window.getSelection(),t=this.cm,r=t.doc.sel.primary(),n=r.from(),i=r.to();if(t.display.viewTo==t.display.viewFrom||n.line>=t.display.viewTo||i.line<t.display.viewFrom)e.removeAllRanges();else{var o=sl(t,e.anchorNode,e.anchorOffset),l=sl(t,e.focusNode,e.focusOffset);if(!o||o.bad||!l||l.bad||0!=P(B(o,l),n)||0!=P(R(o,l),i)){var s=t.display.view,a=n.line>=t.display.viewFrom&&nl(t,n)||{node:s[0].measure.map[2],offset:0},u=i.line<t.display.viewTo&&nl(t,i);if(!u){var c=s[s.length-1].measure,f=c.maps?c.maps[c.maps.length-1]:c.map;u={node:f[f.length-1],offset:f[f.length-2]-f[f.length-3]}}if(a&&u){var h,d=e.rangeCount&&e.getRangeAt(0);try{h=Wl(a.node,a.offset,u.offset,u.node)}catch(e){}h&&(!fl&&t.state.focused?(e.collapse(a.node,a.offset),h.collapsed||(e.removeAllRanges(),e.addRange(h))):(e.removeAllRanges(),e.addRange(h)),d&&null==e.anchorNode?e.addRange(d):fl&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},Zs.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation(function(){return e.cm.curOp.selectionChanged=!0})},20)},Zs.prototype.showMultipleSelections=function(e){r(this.cm.display.cursorDiv,e.cursors),r(this.cm.display.selectionDiv,e.selection)},Zs.prototype.rememberSelection=function(){var e=window.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},Zs.prototype.selectionInEditor=function(){var e=window.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return o(this.div,t)},Zs.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())},Zs.prototype.blur=function(){this.div.blur()},Zs.prototype.getField=function(){return this.div},Zs.prototype.supportsTouch=function(){return!0},Zs.prototype.receivedFocus=function(){function e(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,e))}var t=this;this.selectionInEditor()?this.pollSelection():hn(this.cm,function(){return t.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,e)},Zs.prototype.selectionChanged=function(){var e=window.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},Zs.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var e=window.getSelection(),t=this.cm;if(kl&&bl&&this.cm.options.gutters.length&&il(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var r=sl(t,e.anchorNode,e.anchorOffset),n=sl(t,e.focusNode,e.focusOffset);r&&n&&hn(t,function(){bi(t.doc,Rn(r,n),Gl),(r.bad||n.bad)&&(t.curOp.selectionChanged=!0)})}}},Zs.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e=this.cm,t=e.display,r=e.doc.sel.primary(),n=r.from(),i=r.to();if(0==n.ch&&n.line>e.firstLine()&&(n=E(n.line-1,M(e.doc,n.line-1).length)),i.ch==M(e.doc,i.line).text.length&&i.line<e.lastLine()&&(i=E(i.line+1,0)),n.line<t.viewFrom||i.line>t.viewTo-1)return!1;var o,l,s;n.line==t.viewFrom||0==(o=Lr(e,n.line))?(l=W(t.view[0].line),s=t.view[0].node):(l=W(t.view[o].line),s=t.view[o-1].node.nextSibling);var a,u,c=Lr(e,i.line);if(c==t.view.length-1?(a=t.viewTo-1,u=t.lineDiv.lastChild):(a=W(t.view[c+1].line)-1,u=t.view[c+1].node.previousSibling),!s)return!1;for(var f=e.doc.splitLines(ll(e,s,u,l,a)),h=N(e.doc,E(l,0),E(a,M(e.doc,a).text.length));f.length>1&&h.length>1;)if(g(f)==g(h))f.pop(),h.pop(),a--;else{if(f[0]!=h[0])break;f.shift(),h.shift(),l++}for(var d=0,p=0,v=f[0],m=h[0],y=Math.min(v.length,m.length);d<y&&v.charCodeAt(d)==m.charCodeAt(d);)++d;for(var b=g(f),w=g(h),x=Math.min(b.length-(1==f.length?d:0),w.length-(1==h.length?d:0));p<x&&b.charCodeAt(b.length-p-1)==w.charCodeAt(w.length-p-1);)++p;if(1==f.length&&1==h.length&&l==n.line)for(;d&&d>n.ch&&b.charCodeAt(b.length-p-1)==w.charCodeAt(w.length-p-1);)d--,p++;f[f.length-1]=b.slice(0,b.length-p).replace(/^\u200b+/,""),f[0]=f[0].slice(d).replace(/\u200b+$/,"");var C=E(l,d),S=E(a,h.length?g(h).length-p:0);return f.length>1||f[0]||P(C,S)?(Ei(e.doc,f,C,S,"+input"),!0):void 0},Zs.prototype.ensurePolled=function(){this.forceCompositionEnd()},Zs.prototype.reset=function(){this.forceCompositionEnd()},Zs.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Zs.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()},80))},Zs.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||hn(this.cm,function(){return vn(e.cm)})},Zs.prototype.setUneditable=function(e){e.contentEditable="false"},Zs.prototype.onKeyPress=function(e){0!=e.charCode&&(e.preventDefault(),this.cm.isReadOnly()||dn(this.cm,$o)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},Zs.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},Zs.prototype.onContextMenu=function(){},Zs.prototype.resetPosition=function(){},Zs.prototype.needsContentAttribute=!0;var Qs=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new Pl,this.hasSelection=!1,this.composing=null};Qs.prototype.init=function(e){function t(e){if(!Me(i,e)){if(i.somethingSelected())_o({lineWise:!1,text:i.getSelections()});else{if(!i.options.lineWiseCopyCut)return;var t=Qo(i);_o({lineWise:!0,text:t.text}),"cut"==e.type?i.setSelections(t.ranges,null,Gl):(n.prevInput="",l.value=t.text.join("\n"),El(l))}"cut"==e.type&&(i.state.cutIncoming=!0)}}var r=this,n=this,i=this.cm,o=this.wrapper=el(),l=this.textarea=o.firstChild;e.wrapper.insertBefore(o,e.wrapper.firstChild),Ll&&(l.style.width="0px"),Ql(l,"input",function(){gl&&vl>=9&&r.hasSelection&&(r.hasSelection=null),n.poll()}),Ql(l,"paste",function(e){Me(i,e)||qo(e,i)||(i.state.pasteIncoming=!0,n.fastPoll())}),Ql(l,"cut",t),Ql(l,"copy",t),Ql(e.scroller,"paste",function(t){Ft(e,t)||Me(i,t)||(i.state.pasteIncoming=!0,n.focus())}),Ql(e.lineSpace,"selectstart",function(t){Ft(e,t)||We(t)}),Ql(l,"compositionstart",function(){var e=i.getCursor("from");n.composing&&n.composing.range.clear(),n.composing={start:e,range:i.markText(e,i.getCursor("to"),{className:"CodeMirror-composing"})}}),Ql(l,"compositionend",function(){n.composing&&(n.poll(),n.composing.range.clear(),n.composing=null)})},Qs.prototype.prepareSelection=function(){var e=this.cm,t=e.display,r=e.doc,n=Tr(e);if(e.options.moveInputWithCursor){var i=sr(e,r.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),l=t.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,i.top+l.top-o.top)),n.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,i.left+l.left-o.left))}return n},Qs.prototype.showSelection=function(e){var t=this.cm.display;r(t.cursorDiv,e.cursors),r(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},Qs.prototype.reset=function(e){if(!this.contextMenuPending&&!this.composing){var t=this.cm;if(t.somethingSelected()){this.prevInput="";var r=t.getSelection();this.textarea.value=r,t.state.focused&&El(this.textarea),gl&&vl>=9&&(this.hasSelection=r)}else e||(this.prevInput=this.textarea.value="",gl&&vl>=9&&(this.hasSelection=null))}},Qs.prototype.getField=function(){return this.textarea},Qs.prototype.supportsTouch=function(){return!1},Qs.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!Tl||l()!=this.textarea))try{this.textarea.focus()}catch(e){}},Qs.prototype.blur=function(){this.textarea.blur()},Qs.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Qs.prototype.receivedFocus=function(){this.slowPoll()},Qs.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){e.poll(),e.cm.state.focused&&e.slowPoll()})},Qs.prototype.fastPoll=function(){function e(){r.poll()||t?(r.pollingFast=!1,r.slowPoll()):(t=!0,r.polling.set(60,e))}var t=!1,r=this;r.pollingFast=!0,r.polling.set(20,e)},Qs.prototype.poll=function(){var e=this,t=this.cm,r=this.textarea,n=this.prevInput;if(this.contextMenuPending||!t.state.focused||ts(r)&&!n&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var i=r.value;if(i==n&&!t.somethingSelected())return!1;if(gl&&vl>=9&&this.hasSelection===i||Ml&&/[\uf700-\uf7ff]/.test(i))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=i.charCodeAt(0);if(8203!=o||n||(n="​"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var l=0,s=Math.min(n.length,i.length);l<s&&n.charCodeAt(l)==i.charCodeAt(l);)++l;return hn(t,function(){$o(t,i.slice(l),n.length-l,null,e.composing?"*compose":null),i.length>1e3||i.indexOf("\n")>-1?r.value=e.prevInput="":e.prevInput=i,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Qs.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Qs.prototype.onKeyPress=function(){gl&&vl>=9&&(this.hasSelection=null),this.fastPoll()},Qs.prototype.onContextMenu=function(e){function t(){if(null!=l.selectionStart){var e=i.somethingSelected(),t="​"+(e?l.value:"");l.value="⇚",l.value=t,n.prevInput=e?"":"​",l.selectionStart=1,l.selectionEnd=t.length,o.selForContextMenu=i.doc.sel}}function r(){if(n.contextMenuPending=!1,n.wrapper.style.cssText=c,l.style.cssText=u,gl&&vl<9&&o.scrollbars.setScrollTop(o.scroller.scrollTop=a),null!=l.selectionStart){(!gl||gl&&vl<9)&&t();var e=0,r=function(){o.selForContextMenu==i.doc.sel&&0==l.selectionStart&&l.selectionEnd>0&&"​"==n.prevInput?dn(i,Mi)(i):e++<10?o.detectingSelectAll=setTimeout(r,500):(o.selForContextMenu=null,o.input.reset())};o.detectingSelectAll=setTimeout(r,200)}}var n=this,i=n.cm,o=i.display,l=n.textarea,s=Sr(i,e),a=o.scroller.scrollTop;if(s&&!wl){i.options.resetSelectionOnContextMenu&&-1==i.doc.sel.contains(s)&&dn(i,bi)(i.doc,Rn(s),Gl);var u=l.style.cssText,c=n.wrapper.style.cssText;n.wrapper.style.cssText="position: absolute";var f=n.wrapper.getBoundingClientRect();l.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-f.top-5)+"px; left: "+(e.clientX-f.left-5)+"px;\n      z-index: 1000; background: "+(gl?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var h;if(ml&&(h=window.scrollY),o.input.focus(),ml&&window.scrollTo(null,h),o.input.reset(),i.somethingSelected()||(l.value=n.prevInput=" "),n.contextMenuPending=!0,o.selForContextMenu=i.doc.sel,clearTimeout(o.detectingSelectAll),gl&&vl>=9&&t(),Hl){Fe(e);var d=function(){ke(window,"mouseup",d),setTimeout(r,20)};Ql(window,"mouseup",d)}else setTimeout(r,50)}},Qs.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled="nocursor"==e},Qs.prototype.setUneditable=function(){},Qs.prototype.needsContentAttribute=!1,function(e){function t(t,n,i,o){e.defaults[t]=n,i&&(r[t]=o?function(e,t,r){r!=Xs&&i(e,t,r)}:i)}var r=e.optionHandlers;e.defineOption=t,e.Init=Xs,t("value","",function(e,t){return e.setValue(t)},!0),t("mode",null,function(e,t){e.doc.modeOption=t,jn(e)},!0),t("indentUnit",2,jn,!0),t("indentWithTabs",!1),t("smartIndent",!0),t("tabSize",4,function(e){Xn(e),er(e),vn(e)},!0),t("lineSeparator",null,function(e,t){if(e.doc.lineSep=t,t){var r=[],n=e.doc.first;e.doc.iter(function(e){for(var i=0;;){var o=e.text.indexOf(t,i);if(-1==o)break;i=o+t.length,r.push(E(n,o))}n++});for(var i=r.length-1;i>=0;i--)Ei(e.doc,t,r[i],E(r[i].line,r[i].ch+t.length))}}),t("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(e,t,r){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),r!=Xs&&e.refresh()}),t("specialCharPlaceholder",at,function(e){return e.refresh()},!0),t("electricChars",!0),t("inputStyle",Tl?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),t("spellcheck",!1,function(e,t){return e.getInputField().spellcheck=t},!0),t("rtlMoveVisually",!Ol),t("wholeLineUpdateBefore",!0),t("theme","default",function(e){Go(e),Uo(e)},!0),t("keyMap","default",function(e,t,r){var n=uo(t),i=r!=Xs&&uo(r);i&&i.detach&&i.detach(e,n),n.attach&&n.attach(e,i||null)}),t("extraKeys",null),t("configureMouse",null),t("lineWrapping",!1,Ko,!0),t("gutters",[],function(e){Fn(e.options),Uo(e)},!0),t("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?wr(e.display)+"px":"0",e.refresh()},!0),t("coverGutterNextToScrollbar",!1,function(e){return en(e)},!0),t("scrollbarStyle","native",function(e){rn(e),en(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)},!0),t("lineNumbers",!1,function(e){Fn(e.options),Uo(e)},!0),t("firstLineNumber",1,Uo,!0),t("lineNumberFormatter",function(e){return e},Uo,!0),t("showCursorWhenSelecting",!1,kr,!0),t("resetSelectionOnContextMenu",!0),t("lineWiseCopyCut",!0),t("pasteLinesPerSelection",!0),t("readOnly",!1,function(e,t){"nocursor"==t&&(Fr(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)}),t("disableInput",!1,function(e,t){t||e.display.input.reset()},!0),t("dragDrop",!0,Vo),t("allowDropFileTypes",null),t("cursorBlinkRate",530),t("cursorScrollMargin",0),t("cursorHeight",1,kr,!0),t("singleCursorHeightPerLine",!0,kr,!0),t("workTime",100),t("workDelay",100),t("flattenSpans",!0,Xn,!0),t("addModeClass",!1,Xn,!0),t("pollInterval",100),t("undoDepth",200,function(e,t){return e.doc.history.undoDepth=t}),t("historyEventDelay",1250),t("viewportMargin",10,function(e){return e.refresh()},!0),t("maxHighlightLength",1e4,Xn,!0),t("moveInputWithCursor",!0,function(e,t){t||e.display.input.resetPosition()}),t("tabindex",null,function(e,t){return e.display.input.getField().tabIndex=t||""}),t("autofocus",null),t("direction","ltr",function(e,t){return e.doc.setDirection(t)},!0)}(jo),function(e){var t=e.optionHandlers,r=e.helpers={};e.prototype={constructor:e,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,r){var n=this.options,i=n[e];n[e]==r&&"mode"!=e||(n[e]=r,t.hasOwnProperty(e)&&dn(this,t[e])(this,r,i),Te(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](uo(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,r=0;r<t.length;++r)if(t[r]==e||t[r].name==e)return t.splice(r,1),!0},addOverlay:pn(function(t,r){var n=t.token?t:e.getMode(this.options,t);if(n.startState)throw new Error("Overlays may not be stateful.");m(this.state.overlays,{mode:n,modeSpec:t,opaque:r&&r.opaque,priority:r&&r.priority||0},function(e){return e.priority}),this.state.modeGen++,vn(this)}),removeOverlay:pn(function(e){for(var t=this,r=this.state.overlays,n=0;n<r.length;++n){var i=r[n].modeSpec;if(i==e||"string"==typeof e&&i.name==e)return r.splice(n,1),t.state.modeGen++,void vn(t)}}),indentLine:pn(function(e,t,r){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),H(this.doc,e)&&Yo(this,e,t,r)}),indentSelection:pn(function(e){for(var t=this,r=this.doc.sel.ranges,n=-1,i=0;i<r.length;i++){var o=r[i];if(o.empty())o.head.line>n&&(Yo(t,o.head.line,e,!0),n=o.head.line,i==t.doc.sel.primIndex&&jr(t));else{var l=o.from(),s=o.to(),a=Math.max(n,l.line);n=Math.min(t.lastLine(),s.line-(s.ch?0:1))+1;for(var u=a;u<n;++u)Yo(t,u,e);var c=t.doc.sel.ranges;0==l.ch&&r.length==c.length&&c[i].from().ch>0&&gi(t.doc,i,new Ts(l,c[i].to()),Gl)}}}),getTokenAt:function(e,t){return Je(this,e,t)},getLineTokens:function(e,t){return Je(this,E(e),t,!0)},getTokenTypeAt:function(e){e=U(this.doc,e);var t,r=_e(this,M(this.doc,e.line)),n=0,i=(r.length-1)/2,o=e.ch;if(0==o)t=r[2];else for(;;){var l=n+i>>1;if((l?r[2*l-1]:0)>=o)i=l;else{if(!(r[2*l+1]<o)){t=r[2*l+2];break}n=l+1}}var s=t?t.indexOf("overlay "):-1;return s<0?t:0==s?null:t.slice(0,s-1)},getModeAt:function(t){var r=this.doc.mode;return r.innerMode?e.innerMode(r,this.getTokenAt(t).state).mode:r},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var n=this,i=[];if(!r.hasOwnProperty(t))return i;var o=r[t],l=this.getModeAt(e);if("string"==typeof l[t])o[l[t]]&&i.push(o[l[t]]);else if(l[t])for(var s=0;s<l[t].length;s++){var a=o[l[t][s]];a&&i.push(a)}else l.helperType&&o[l.helperType]?i.push(o[l.helperType]):o[l.name]&&i.push(o[l.name]);for(var u=0;u<o._global.length;u++){var c=o._global[u];c.pred(l,n)&&-1==h(i,c.val)&&i.push(c.val)}return i},getStateAfter:function(e,t){var r=this.doc;return e=G(r,null==e?r.first+r.size-1:e),$e(this,e+1,t).state},cursorCoords:function(e,t){var r,n=this.doc.sel.primary();return r=null==e?n.head:"object"==typeof e?U(this.doc,e):e?n.from():n.to(),sr(this,r,t||"page")},charCoords:function(e,t){return lr(this,U(this.doc,e),t||"page")},coordsChar:function(e,t){return e=or(this,e,t||"page"),cr(this,e.left,e.top)},lineAtHeight:function(e,t){return e=or(this,{top:e,left:0},t||"page").top,D(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,r){var n,i=!1;if("number"==typeof e){var o=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>o&&(e=o,i=!0),n=M(this.doc,e)}else n=e;return ir(this,n,{top:0,left:0},t||"page",r||i).top+(i?this.doc.height-ye(n):0)},defaultTextHeight:function(){return mr(this.display)},defaultCharWidth:function(){return yr(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,r,n,i){var o=this.display,l=(e=sr(this,U(this.doc,e))).bottom,s=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),o.sizer.appendChild(t),"over"==n)l=e.top;else if("above"==n||"near"==n){var a=Math.max(o.wrapper.clientHeight,this.doc.height),u=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||e.bottom+t.offsetHeight>a)&&e.top>t.offsetHeight?l=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=a&&(l=e.bottom),s+t.offsetWidth>u&&(s=u-t.offsetWidth)}t.style.top=l+"px",t.style.left=t.style.right="","right"==i?(s=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==i?s=0:"middle"==i&&(s=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=s+"px"),r&&Ur(this,{left:s,top:l,right:s+t.offsetWidth,bottom:l+t.offsetHeight})},triggerOnKeyDown:pn(Lo),triggerOnKeyPress:pn(Mo),triggerOnKeyUp:To,triggerOnMouseDown:pn(Oo),execCommand:function(e){if(Bs.hasOwnProperty(e))return Bs[e].call(null,this)},triggerElectric:pn(function(e){Zo(this,e)}),findPosH:function(e,t,r,n){var i=this,o=1;t<0&&(o=-1,t=-t);for(var l=U(this.doc,e),s=0;s<t&&!(l=tl(i.doc,l,o,r,n)).hitSide;++s);return l},moveH:pn(function(e,t){var r=this;this.extendSelectionsBy(function(n){return r.display.shift||r.doc.extend||n.empty()?tl(r.doc,n.head,e,t,r.options.rtlMoveVisually):e<0?n.from():n.to()},Vl)}),deleteH:pn(function(e,t){var r=this.doc.sel,n=this.doc;r.somethingSelected()?n.replaceSelection("",null,"+delete"):co(this,function(r){var i=tl(n,r.head,e,t,!1);return e<0?{from:i,to:r.head}:{from:r.head,to:i}})}),findPosV:function(e,t,r,n){var i=this,o=1,l=n;t<0&&(o=-1,t=-t);for(var s=U(this.doc,e),a=0;a<t;++a){var u=sr(i,s,"div");if(null==l?l=u.left:u.left=l,(s=rl(i,u,o,r)).hitSide)break}return s},moveV:pn(function(e,t){var r=this,n=this.doc,i=[],o=!this.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy(function(l){if(o)return e<0?l.from():l.to();var s=sr(r,l.head,"div");null!=l.goalColumn&&(s.left=l.goalColumn),i.push(s.left);var a=rl(r,s,e,t);return"page"==t&&l==n.sel.primary()&&Kr(r,lr(r,a,"div").top-s.top),a},Vl),i.length)for(var l=0;l<n.sel.ranges.length;l++)n.sel.ranges[l].goalColumn=i[l]}),findWordAt:function(e){var t=M(this.doc,e.line).text,r=e.ch,n=e.ch;if(t){var i=this.getHelper(e,"wordChars");"before"!=e.sticky&&n!=t.length||!r?++n:--r;for(var o=t.charAt(r),l=x(o,i)?function(e){return x(e,i)}:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!x(e)};r>0&&l(t.charAt(r-1));)--r;for(;n<t.length&&l(t.charAt(n));)++n}return new Ts(E(e.line,r),E(e.line,n))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?s(this.display.cursorDiv,"CodeMirror-overwrite"):Fl(this.display.cursorDiv,"CodeMirror-overwrite"),Te(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==l()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:pn(function(e,t){Xr(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-zt(this)-this.display.barHeight,width:e.scrollWidth-zt(this)-this.display.barWidth,clientHeight:Bt(this),clientWidth:Rt(this)}},scrollIntoView:pn(function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:E(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?Yr(this,e):$r(this,e.from,e.to,e.margin)}),setSize:pn(function(e,t){var r=this,n=function(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e};null!=e&&(this.display.wrapper.style.width=n(e)),null!=t&&(this.display.wrapper.style.height=n(t)),this.options.lineWrapping&&Jt(this);var i=this.display.viewFrom;this.doc.iter(i,this.display.viewTo,function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){mn(r,i,"widget");break}++i}),this.curOp.forceUpdate=!0,Te(this,"refresh",this)}),operation:function(e){return hn(this,e)},startOperation:function(){return nn(this)},endOperation:function(){return on(this)},refresh:pn(function(){var e=this.display.cachedTextHeight;vn(this),this.curOp.forceUpdate=!0,er(this),Xr(this,this.doc.scrollLeft,this.doc.scrollTop),Wn(this),(null==e||Math.abs(e-mr(this.display))>.5)&&Cr(this),Te(this,"refresh",this)}),swapDoc:pn(function(e){var t=this.doc;return t.cm=null,qn(this,e),er(this),this.display.input.reset(),Xr(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,bt(this,"swapDoc",this,t),t}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Ae(e),e.registerHelper=function(t,n,i){r.hasOwnProperty(t)||(r[t]=e[t]={_global:[]}),r[t][n]=i},e.registerGlobalHelper=function(t,n,i,o){e.registerHelper(t,n,o),r[t]._global.push({pred:i,val:o})}}(jo);var Js="iter insert remove copy getEditor constructor".split(" ");for(var ea in Ds.prototype)Ds.prototype.hasOwnProperty(ea)&&h(Js,ea)<0&&(jo.prototype[ea]=function(e){return function(){return e.apply(this.doc,arguments)}}(Ds.prototype[ea]));return Ae(Ds),jo.inputStyles={textarea:Qs,contenteditable:Zs},jo.defineMode=function(e){jo.defaults.mode||"null"==e||(jo.defaults.mode=e),Be.apply(this,arguments)},jo.defineMIME=function(e,t){os[e]=t},jo.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}}),jo.defineMIME("text/plain","null"),jo.defineExtension=function(e,t){jo.prototype[e]=t},jo.defineDocExtension=function(e,t){Ds.prototype[e]=t},jo.fromTextArea=function(e,t){function r(){e.value=a.getValue()}if(t=t?c(t):{},t.value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var n=l();t.autofocus=n==e||null!=e.getAttribute("autofocus")&&n==document.body}var i;if(e.form&&(Ql(e.form,"submit",r),!t.leaveSubmitMethodAlone)){var o=e.form;i=o.submit;try{var s=o.submit=function(){r(),o.submit=i,o.submit(),o.submit=s}}catch(e){}}t.finishInit=function(t){t.save=r,t.getTextArea=function(){return e},t.toTextArea=function(){t.toTextArea=isNaN,r(),e.parentNode.removeChild(t.getWrapperElement()),e.style.display="",e.form&&(ke(e.form,"submit",r),"function"==typeof e.form.submit&&(e.form.submit=i))}},e.style.display="none";var a=jo(function(t){return e.parentNode.insertBefore(t,e.nextSibling)},t);return a},function(e){e.off=ke,e.on=Ql,e.wheelEventPixels=Pn,e.Doc=Ds,e.splitLines=es,e.countColumn=f,e.findColumn=d,e.isWordChar=w,e.Pass=Bl,e.signal=Te,e.Line=fs,e.changeEnd=Bn,e.scrollbarModel=ws,e.Pos=E,e.cmpPos=P,e.modes=is,e.mimeModes=os,e.resolveMode=Ge,e.getMode=Ue,e.modeExtensions=ls,e.extendMode=Ve,e.copyState=Ke,e.startState=Xe,e.innerMode=je,e.commands=Bs,e.keyMap=Rs,e.keyName=ao,e.isModifierKey=lo,e.lookupKey=oo,e.normalizeKeyMap=io,e.StringStream=ss,e.SharedTextMarker=As,e.TextMarker=Os,e.LineWidget=Ms,e.e_preventDefault=We,e.e_stopPropagation=De,e.e_stop=Fe,e.addClass=s,e.contains=o,e.rmClass=Fl,e.keyNames=Es}(jo),jo.version="5.30.0",jo});
      !function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function t(e,t,n,r,o,a){this.indented=e,this.column=t,this.type=n,this.info=r,this.align=o,this.prev=a}function n(e,n,r,o){var a=e.indented;return e.context&&"statement"==e.context.type&&"statement"!=r&&(a=e.context.indented),e.context=new t(a,n,r,o,null,e.context)}function r(e){var t=e.context.type;return")"!=t&&"]"!=t&&"}"!=t||(e.indented=e.context.indented),e.context=e.context.prev}function o(e,t,n){return"variable"==t.prevToken||"type"==t.prevToken||(!!/\S(?:[^- ]>|[*\]])\s*$|\*$/.test(e.string.slice(0,n))||(!(!t.typeAtEndOfLine||e.column()!=e.indentation())||void 0))}function a(e){for(;;){if(!e||"top"==e.type)return!0;if("}"==e.type&&"namespace"!=e.prev.info)return!1;e=e.prev}}function i(e){for(var t={},n=e.split(" "),r=0;r<n.length;++r)t[n[r]]=!0;return t}function l(e,t){return"function"==typeof e?e(t):e.propertyIsEnumerable(t)}function s(e,t){if(!t.startOfLine)return!1;for(var n,r=null;n=e.peek();){if("\\"==n&&e.match(/^.$/)){r=s;break}if("/"==n&&e.match(/^\/[\/\*]/,!1))break;e.next()}return t.tokenize=r,"meta"}function c(e,t){return"type"==t.prevToken&&"type"}function u(e){return e.eatWhile(/[\w\.']/),"number"}function d(e,t){if(e.backUp(1),e.match(/(R|u8R|uR|UR|LR)/)){var n=e.match(/"([^\s\\()]{0,16})\(/);return!!n&&(t.cpp11RawStringDelim=n[1],t.tokenize=m,m(e,t))}return e.match(/(u8|u|U|L)/)?!!e.match(/["']/,!1)&&"string":(e.next(),!1)}function f(e){var t=/(\w+)::~?(\w+)$/.exec(e);return t&&t[1]==t[2]}function p(e,t){for(var n;null!=(n=e.next());)if('"'==n&&!e.eat('"')){t.tokenize=null;break}return"string"}function m(e,t){var n=t.cpp11RawStringDelim.replace(/[^\w\s]/g,"\\$&");return e.match(new RegExp(".*?\\)"+n+'"'))?t.tokenize=null:e.skipToEnd(),"string"}function h(t,n){function r(e){if(e)for(var t in e)e.hasOwnProperty(t)&&o.push(t)}"string"==typeof t&&(t=[t]);var o=[];r(n.keywords),r(n.types),r(n.builtin),r(n.atoms),o.length&&(n.helperType=t[0],e.registerHelper("hintWords",t[0],o));for(var a=0;a<t.length;++a)e.defineMIME(t[a],n)}function g(e,t){for(var n=!1;!e.eol();){if(!n&&e.match('"""')){t.tokenize=null;break}n="\\"==e.next()&&!n}return"string"}function y(e){return function(t,n){for(var r,o=!1,a=!1;!t.eol();){if(!e&&!o&&t.match('"')){a=!0;break}if(e&&t.match('"""')){a=!0;break}r=t.next(),!o&&"$"==r&&t.match("{")&&t.skipTo("}"),o=!o&&"\\"==r&&!e}return!a&&e||(n.tokenize=null),"string"}}function x(e){return function(t,n){for(var r,o=!1,a=!1;!t.eol();){if(!o&&t.match('"')&&("single"==e||t.match('""'))){a=!0;break}if(!o&&t.match("``")){w=x(e),a=!0;break}r=t.next(),o="single"==e&&!o&&"\\"==r}return a&&(n.tokenize=null),"string"}}e.defineMode("clike",function(i,s){function c(e,t){var n=e.next();if(S[n]){var r=S[n](e,t);if(!1!==r)return r}if('"'==n||"'"==n)return t.tokenize=u(n),t.tokenize(e,t);if(D.test(n))return p=n,null;if(L.test(n)){if(e.backUp(1),e.match(I))return"number";e.next()}if("/"==n){if(e.eat("*"))return t.tokenize=d,d(e,t);if(e.eat("/"))return e.skipToEnd(),"comment"}if(F.test(n)){for(;!e.match(/^\/[\/*]/,!1)&&e.eat(F););return"operator"}if(e.eatWhile(z),P)for(;e.match(P);)e.eatWhile(z);var o=e.current();return l(x,o)?(l(w,o)&&(p="newstatement"),l(v,o)&&(m=!0),"keyword"):l(b,o)?"type":l(k,o)?(l(w,o)&&(p="newstatement"),"builtin"):l(_,o)?"atom":"variable"}function u(e){return function(t,n){for(var r,o=!1,a=!1;null!=(r=t.next());){if(r==e&&!o){a=!0;break}o=!o&&"\\"==r}return(a||!o&&!C)&&(n.tokenize=null),"string"}}function d(e,t){for(var n,r=!1;n=e.next();){if("/"==n&&r){t.tokenize=null;break}r="*"==n}return"comment"}function f(e,t){s.typeFirstDefinitions&&e.eol()&&a(t.context)&&(t.typeAtEndOfLine=o(e,t,e.pos))}var p,m,h=i.indentUnit,g=s.statementIndentUnit||h,y=s.dontAlignCalls,x=s.keywords||{},b=s.types||{},k=s.builtin||{},w=s.blockKeywords||{},v=s.defKeywords||{},_=s.atoms||{},S=s.hooks||{},C=s.multiLineStrings,T=!1!==s.indentStatements,M=!1!==s.indentSwitch,P=s.namespaceSeparator,D=s.isPunctuationChar||/[\[\]{}\(\),;\:\.]/,L=s.numberStart||/[\d\.]/,I=s.number||/^(?:0x[a-f\d]+|0b[01]+|(?:\d+\.?\d*|\.\d+)(?:e[-+]?\d+)?)(u|ll?|l|f)?/i,F=s.isOperatorChar||/[+\-*&%=<>!?|\/]/,z=s.isIdentifierChar||/[\w\$_\xa1-\uffff]/;return{startState:function(e){return{tokenize:null,context:new t((e||0)-h,0,"top",null,!1),indented:0,startOfLine:!0,prevToken:null}},token:function(e,t){var i=t.context;if(e.sol()&&(null==i.align&&(i.align=!1),t.indented=e.indentation(),t.startOfLine=!0),e.eatSpace())return f(e,t),null;p=m=null;var l=(t.tokenize||c)(e,t);if("comment"==l||"meta"==l)return l;if(null==i.align&&(i.align=!0),";"==p||":"==p||","==p&&e.match(/^\s*(?:\/\/.*)?$/,!1))for(;"statement"==t.context.type;)r(t);else if("{"==p)n(t,e.column(),"}");else if("["==p)n(t,e.column(),"]");else if("("==p)n(t,e.column(),")");else if("}"==p){for(;"statement"==i.type;)i=r(t);for("}"==i.type&&(i=r(t));"statement"==i.type;)i=r(t)}else p==i.type?r(t):T&&(("}"==i.type||"top"==i.type)&&";"!=p||"statement"==i.type&&"newstatement"==p)&&n(t,e.column(),"statement",e.current());if("variable"==l&&("def"==t.prevToken||s.typeFirstDefinitions&&o(e,t,e.start)&&a(t.context)&&e.match(/^\s*\(/,!1))&&(l="def"),S.token){var u=S.token(e,t,l);void 0!==u&&(l=u)}return"def"==l&&!1===s.styleDefs&&(l="variable"),t.startOfLine=!1,t.prevToken=m?"def":l||p,f(e,t),l},indent:function(t,n){if(t.tokenize!=c&&null!=t.tokenize||t.typeAtEndOfLine)return e.Pass;var r=t.context,o=n&&n.charAt(0);if("statement"==r.type&&"}"==o&&(r=r.prev),s.dontIndentStatements)for(;"statement"==r.type&&s.dontIndentStatements.test(r.info);)r=r.prev;if(S.indent){var a=S.indent(t,r,n);if("number"==typeof a)return a}var i=o==r.type,l=r.prev&&"switch"==r.prev.info;if(s.allmanIndentation&&/[{(]/.test(o)){for(;"top"!=r.type&&"}"!=r.type;)r=r.prev;return r.indented}return"statement"==r.type?r.indented+("{"==o?0:g):!r.align||y&&")"==r.type?")"!=r.type||i?r.indented+(i?0:h)+(i||!l||/^(?:case|default)\b/.test(n)?0:h):r.indented+g:r.column+(i?0:1)},electricInput:M?/^\s*(?:case .*?:|default:|\{\}?|\})$/:/^\s*[{}]$/,blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:"//",fold:"brace"}});var b="auto if break case register continue return default do sizeof static else struct switch extern typedef union for goto while enum const volatile",k="int long char short double float unsigned signed void size_t ptrdiff_t";h(["text/x-csrc","text/x-c","text/x-chdr"],{name:"clike",keywords:i(b),types:i(k+" bool _Complex _Bool float_t double_t intptr_t intmax_t int8_t int16_t int32_t int64_t uintptr_t uintmax_t uint8_t uint16_t uint32_t uint64_t"),blockKeywords:i("case do else for if switch while struct"),defKeywords:i("struct"),typeFirstDefinitions:!0,atoms:i("null true false"),hooks:{"#":s,"*":c},modeProps:{fold:["brace","include"]}}),h(["text/x-c++src","text/x-c++hdr"],{name:"clike",keywords:i(b+" asm dynamic_cast namespace reinterpret_cast try explicit new static_cast typeid catch operator template typename class friend private this using const_cast inline public throw virtual delete mutable protected alignas alignof constexpr decltype nullptr noexcept thread_local final static_assert override"),types:i(k+" bool wchar_t"),blockKeywords:i("catch class do else finally for if struct switch try while"),defKeywords:i("class namespace struct enum union"),typeFirstDefinitions:!0,atoms:i("true false null"),dontIndentStatements:/^template$/,isIdentifierChar:/[\w\$_~\xa1-\uffff]/,hooks:{"#":s,"*":c,u:d,U:d,L:d,R:d,0:u,1:u,2:u,3:u,4:u,5:u,6:u,7:u,8:u,9:u,token:function(e,t,n){if("variable"==n&&"("==e.peek()&&(";"==t.prevToken||null==t.prevToken||"}"==t.prevToken)&&f(e.current()))return"def"}},namespaceSeparator:"::",modeProps:{fold:["brace","include"]}}),h("text/x-java",{name:"clike",keywords:i("abstract assert break case catch class const continue default do else enum extends final finally float for goto if implements import instanceof interface native new package private protected public return static strictfp super switch synchronized this throw throws transient try volatile while @interface"),types:i("byte short int long float double boolean char void Boolean Byte Character Double Float Integer Long Number Object Short String StringBuffer StringBuilder Void"),blockKeywords:i("catch class do else finally for if switch try while"),defKeywords:i("class interface package enum @interface"),typeFirstDefinitions:!0,atoms:i("true false null"),number:/^(?:0x[a-f\d_]+|0b[01_]+|(?:[\d_]+\.?\d*|\.\d+)(?:e[-+]?[\d_]+)?)(u|ll?|l|f)?/i,hooks:{"@":function(e){return!e.match("interface",!1)&&(e.eatWhile(/[\w\$_]/),"meta")}},modeProps:{fold:["brace","import"]}}),h("text/x-csharp",{name:"clike",keywords:i("abstract as async await base break case catch checked class const continue default delegate do else enum event explicit extern finally fixed for foreach goto if implicit in interface internal is lock namespace new operator out override params private protected public readonly ref return sealed sizeof stackalloc static struct switch this throw try typeof unchecked unsafe using virtual void volatile while add alias ascending descending dynamic from get global group into join let orderby partial remove select set value var yield"),types:i("Action Boolean Byte Char DateTime DateTimeOffset Decimal Double Func Guid Int16 Int32 Int64 Object SByte Single String Task TimeSpan UInt16 UInt32 UInt64 bool byte char decimal double short int long object sbyte float string ushort uint ulong"),blockKeywords:i("catch class do else finally for foreach if struct switch try while"),defKeywords:i("class interface namespace struct var"),typeFirstDefinitions:!0,atoms:i("true false null"),hooks:{"@":function(e,t){return e.eat('"')?(t.tokenize=p,p(e,t)):(e.eatWhile(/[\w\$_]/),"meta")}}}),h("text/x-scala",{name:"clike",keywords:i("abstract case catch class def do else extends final finally for forSome if implicit import lazy match new null object override package private protected return sealed super this throw trait try type val var while with yield _ assert assume require print println printf readLine readBoolean readByte readShort readChar readInt readLong readFloat readDouble"),types:i("AnyVal App Application Array BufferedIterator BigDecimal BigInt Char Console Either Enumeration Equiv Error Exception Fractional Function IndexedSeq Int Integral Iterable Iterator List Map Numeric Nil NotNull Option Ordered Ordering PartialFunction PartialOrdering Product Proxy Range Responder Seq Serializable Set Specializable Stream StringBuilder StringContext Symbol Throwable Traversable TraversableOnce Tuple Unit Vector Boolean Byte Character CharSequence Class ClassLoader Cloneable Comparable Compiler Double Exception Float Integer Long Math Number Object Package Pair Process Runtime Runnable SecurityManager Short StackTraceElement StrictMath String StringBuffer System Thread ThreadGroup ThreadLocal Throwable Triple Void"),multiLineStrings:!0,blockKeywords:i("catch class enum do else finally for forSome if match switch try while"),defKeywords:i("class enum def object package trait type val var"),atoms:i("true false null"),indentStatements:!1,indentSwitch:!1,isOperatorChar:/[+\-*&%=<>!?|\/#:@]/,hooks:{"@":function(e){return e.eatWhile(/[\w\$_]/),"meta"},'"':function(e,t){return!!e.match('""')&&(t.tokenize=g,t.tokenize(e,t))},"'":function(e){return e.eatWhile(/[\w\$_\xa1-\uffff]/),"atom"},"=":function(e,n){var r=n.context;return!("}"!=r.type||!r.align||!e.eat(">"))&&(n.context=new t(r.indented,r.column,r.type,r.info,null,r.prev),"operator")}},modeProps:{closeBrackets:{triples:'"'}}}),h("text/x-kotlin",{name:"clike",keywords:i("package as typealias class interface this super val var fun for is in This throw return break continue object if else while do try when !in !is as? file import where by get set abstract enum open inner override private public internal protected catch finally out final vararg reified dynamic companion constructor init sealed field property receiver param sparam lateinit data inline noinline tailrec external annotation crossinline const operator infix suspend"),types:i("Boolean Byte Character CharSequence Class ClassLoader Cloneable Comparable Compiler Double Exception Float Integer Long Math Number Object Package Pair Process Runtime Runnable SecurityManager Short StackTraceElement StrictMath String StringBuffer System Thread ThreadGroup ThreadLocal Throwable Triple Void"),intendSwitch:!1,indentStatements:!1,multiLineStrings:!0,number:/^(?:0x[a-f\d_]+|0b[01_]+|(?:[\d_]+\.?\d*|\.\d+)(?:e[-+]?[\d_]+)?)(u|ll?|l|f)?/i,blockKeywords:i("catch class do else finally for if where try while enum"),defKeywords:i("class val var object package interface fun"),atoms:i("true false null this"),hooks:{'"':function(e,t){return t.tokenize=y(e.match('""')),t.tokenize(e,t)}},modeProps:{closeBrackets:{triples:'"'}}}),h(["x-shader/x-vertex","x-shader/x-fragment"],{name:"clike",keywords:i("sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow const attribute uniform varying break continue discard return for while do if else struct in out inout"),types:i("float int bool void vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 mat2 mat3 mat4"),blockKeywords:i("for while do if else struct"),builtin:i("radians degrees sin cos tan asin acos atan pow exp log exp2 sqrt inversesqrt abs sign floor ceil fract mod min max clamp mix step smoothstep length distance dot cross normalize ftransform faceforward reflect refract matrixCompMult lessThan lessThanEqual greaterThan greaterThanEqual equal notEqual any all not texture1D texture1DProj texture1DLod texture1DProjLod texture2D texture2DProj texture2DLod texture2DProjLod texture3D texture3DProj texture3DLod texture3DProjLod textureCube textureCubeLod shadow1D shadow2D shadow1DProj shadow2DProj shadow1DLod shadow2DLod shadow1DProjLod shadow2DProjLod dFdx dFdy fwidth noise1 noise2 noise3 noise4"),atoms:i("true false gl_FragColor gl_SecondaryColor gl_Normal gl_Vertex gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_FogCoord gl_PointCoord gl_Position gl_PointSize gl_ClipVertex gl_FrontColor gl_BackColor gl_FrontSecondaryColor gl_BackSecondaryColor gl_TexCoord gl_FogFragCoord gl_FragCoord gl_FrontFacing gl_FragData gl_FragDepth gl_ModelViewMatrix gl_ProjectionMatrix gl_ModelViewProjectionMatrix gl_TextureMatrix gl_NormalMatrix gl_ModelViewMatrixInverse gl_ProjectionMatrixInverse gl_ModelViewProjectionMatrixInverse gl_TexureMatrixTranspose gl_ModelViewMatrixInverseTranspose gl_ProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixInverseTranspose gl_TextureMatrixInverseTranspose gl_NormalScale gl_DepthRange gl_ClipPlane gl_Point gl_FrontMaterial gl_BackMaterial gl_LightSource gl_LightModel gl_FrontLightModelProduct gl_BackLightModelProduct gl_TextureColor gl_EyePlaneS gl_EyePlaneT gl_EyePlaneR gl_EyePlaneQ gl_FogParameters gl_MaxLights gl_MaxClipPlanes gl_MaxTextureUnits gl_MaxTextureCoords gl_MaxVertexAttribs gl_MaxVertexUniformComponents gl_MaxVaryingFloats gl_MaxVertexTextureImageUnits gl_MaxTextureImageUnits gl_MaxFragmentUniformComponents gl_MaxCombineTextureImageUnits gl_MaxDrawBuffers"),indentSwitch:!1,hooks:{"#":s},modeProps:{fold:["brace","include"]}}),h("text/x-nesc",{name:"clike",keywords:i(b+"as atomic async call command component components configuration event generic implementation includes interface module new norace nx_struct nx_union post provides signal task uses abstract extends"),types:i(k),blockKeywords:i("case do else for if switch while struct"),atoms:i("null true false"),hooks:{"#":s},modeProps:{fold:["brace","include"]}}),h("text/x-objectivec",{name:"clike",keywords:i(b+"inline restrict _Bool _Complex _Imaginary BOOL Class bycopy byref id IMP in inout nil oneway out Protocol SEL self super atomic nonatomic retain copy readwrite readonly"),types:i(k),atoms:i("YES NO NULL NILL ON OFF true false"),hooks:{"@":function(e){return e.eatWhile(/[\w\$]/),"keyword"},"#":s,indent:function(e,t,n){if("statement"==t.type&&/^@\w/.test(n))return t.indented}},modeProps:{fold:"brace"}}),h("text/x-squirrel",{name:"clike",keywords:i("base break clone continue const default delete enum extends function in class foreach local resume return this throw typeof yield constructor instanceof static"),types:i(k),blockKeywords:i("case catch class else for foreach if switch try while"),defKeywords:i("function local class"),typeFirstDefinitions:!0,atoms:i("true false null"),hooks:{"#":s},modeProps:{fold:["brace","include"]}});var w=null;h("text/x-ceylon",{name:"clike",keywords:i("abstracts alias assembly assert assign break case catch class continue dynamic else exists extends finally for function given if import in interface is let module new nonempty object of out outer package return satisfies super switch then this throw try value void while"),types:function(e){var t=e.charAt(0);return t===t.toUpperCase()&&t!==t.toLowerCase()},blockKeywords:i("case catch class dynamic else finally for function if interface module new object switch try while"),defKeywords:i("class dynamic function interface module object package value"),builtin:i("abstract actual aliased annotation by default deprecated doc final formal late license native optional sealed see serializable shared suppressWarnings tagged throws variable"),isPunctuationChar:/[\[\]{}\(\),;\:\.`]/,isOperatorChar:/[+\-*&%=<>!?|^~:\/]/,numberStart:/[\d#$]/,number:/^(?:#[\da-fA-F_]+|\$[01_]+|[\d_]+[kMGTPmunpf]?|[\d_]+\.[\d_]+(?:[eE][-+]?\d+|[kMGTPmunpf]|)|)/i,multiLineStrings:!0,typeFirstDefinitions:!0,atoms:i("true false null larger smaller equal empty finished"),indentSwitch:!1,styleDefs:!1,hooks:{"@":function(e){return e.eatWhile(/[\w\$_]/),"meta"},'"':function(e,t){return t.tokenize=x(e.match('""')?"triple":"single"),t.tokenize(e,t)},"`":function(e,t){return!(!w||!e.match("`"))&&(t.tokenize=w,w=null,t.tokenize(e,t))},"'":function(e){return e.eatWhile(/[\w\$_\xa1-\uffff]/),"atom"},token:function(e,t,n){if(("variable"==n||"type"==n)&&"."==t.prevToken)return"variable-2"}},modeProps:{fold:["brace","import"],closeBrackets:{triples:'"'}}})});
      // -------------------------------------------------------------------------
//  Part of the CodeChecker project, under the Apache License v2.0 with
//  LLVM Exceptions. See LICENSE for license information.
//  SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
// -------------------------------------------------------------------------

var BugViewer = {
  _files : [],
  _reports : [],
  _lineWidgets : [],
  _navigationMenuItems : [],
  _sourceFileData : null,
  _currentReport : null,
  _lastBugEvent  : null,

  init : function (files, reports) {
    this._files = files;
    this._reports = reports;

    this.initEscapeChars();
  },

  initEscapeChars : function () {
    this.escapeChars = {
      ' ' : 'nbsp',
      '<' : 'lt',
      '>' : 'gt',
      '"' : 'quot',
      '&' : 'amp'
    };

    var regexString = '[';
    for (var key in this.escapeChars) {
      regexString += key;
    }
    regexString += ']';

    this.escapeRegExp = new RegExp( regexString, 'g');
  },

  escapeHTML : function (str) {
    var that = this;

    return str.replace(this.escapeRegExp, function (m) {
      return '&' + that.escapeChars[m] + ';';
    });
  },

  initByUrl : function () {
    if (!this._reports) return;

    var state = {};
    window.location.hash.substr(1).split('&').forEach(function (s) {
      var parts = s.split('=');
      state[parts[0]] = parts[1];
    });

    for (var key in this._reports) {
      var report = this._reports[key];
      if (report.reportHash === state['reportHash']) {
        this.navigate(report);
        return;
      }
    }

    this.navigate(this._reports[0]);
  },

  create : function () {
    this._content = document.getElementById('editor-wrapper');
    this._filepath = document.getElementById('file-path');
    this._checkerName = document.getElementById('checker-name');
    this._reviewStatusWrapper =
      document.getElementById('review-status-wrapper');
    this._reviewStatus = document.getElementById('review-status');
    this._editor = document.getElementById('editor');

    this._codeMirror = CodeMirror(this._editor, {
      mode: 'text/x-c++src',
      matchBrackets : true,
      lineNumbers : true,
      readOnly : true,
      foldGutter : true,
      extraKeys : {},
      viewportMargin : 100
    });

    this._createNavigationMenu();
  },

  navigate : function (report, item) {
    if (!item) {
      var items = this._navigationMenuItems.filter(function (navItem) {
        return navItem.report.reportHash === report.reportHash;
      });

      if (!items.length) return;

      item = items[0].widget;
    }

    this._selectedReport.classList.remove('active');
    this._selectedReport = item;
    this._selectedReport.classList.add('active');
    this.setReport(report);
  },

  _createNavigationMenu : function () {
    var that = this;

    var nav = document.getElementById('report-nav');
    var list = document.createElement('ul');
    this._reports.forEach(function (report) {
      var events = report['events'];
      var lastBugEvent = events[events.length - 1];
      var item = document.createElement('li');

      var severity = document.createElement('i');
      severity.className = 'severity-' + report.severity.toLowerCase();

      item.appendChild(severity);
      item.appendChild(document.createTextNode(lastBugEvent.message));

      item.addEventListener('click', function () {
        that.navigate(report, item);
      })
      list.appendChild(item);
      that._navigationMenuItems.push({ report : report, widget : item });
    });

    if (!this._selectedReport && list.childNodes.length) {
      this._selectedReport = list.childNodes[0];
      this._selectedReport.classList.add('active');
    }

    nav.appendChild(list);
  },

  setReport : function (report) {
    this._currentReport = report;
    var events = report['events'];
    var lastBugEvent = events[events.length - 1];
    this.setCurrentBugEvent(lastBugEvent, events.length - 1);
    this.setCheckerName(report.checkerName);
    this.setReviewStatus(report.reviewStatus);

    window.location.hash = '#reportHash=' + report.reportHash;
  },

  setCurrentBugEvent : function (event, idx) {
    this._currentBugEvent = event;
    this.setSourceFileData(this._files[event.location.file]);
    this.drawBugPath();

    this.jumpTo(event.location.line, 0);
    this.highlightBugEvent(event, idx);
  },

  highlightBugEvent : function (event, idx) {
    this._lineWidgets.forEach(function (widget) {
      var lineIdx = widget.node.getAttribute('idx');
      if (parseInt(lineIdx) === idx) {
        widget.node.classList.add('current');
      }
    });
  },

  setCheckerName : function (checkerName) {
    this._checkerName.innerHTML = checkerName;
  },

  setReviewStatus : function (status) {
    if (status) {
      var className =
        'review-status-' + status.toLowerCase().split(' ').join('-');
      this._reviewStatus.className = "review-status " + className;

      this._reviewStatus.innerHTML = status;
      this._reviewStatusWrapper.style.display = 'block';
    } else {
      this._reviewStatusWrapper.style.display = 'none';
    }
  },

  setSourceFileData : function (file) {
    if (this._sourceFileData && file.id === this._sourceFileData.id) {
      return;
    }

    this._sourceFileData = file;
    this._filepath.innerHTML = file.path;
    this._codeMirror.doc.setValue(file.content);
    this._refresh();
  },

  _refresh : function () {
    var that = this;
    setTimeout(function () {
      var fullHeight = parseInt(that._content.clientHeight);
      var headerHeight = that._filepath.clientHeight;

      that._codeMirror.setSize('auto', fullHeight - headerHeight);
      that._codeMirror.refresh();
    }, 200);
  },

  clearBubbles : function () {
    this._lineWidgets.forEach(function (widget) { widget.clear(); });
    this._lineWidgets = [];
  },

  getMessage : function (event, kind) {
    if (kind === 'macro') {
      var name = 'macro expansion' + (event.name ? ': ' + event.name : '');

      return '<span class="tag macro">' + name + '</span>'
        + this.escapeHTML(event.expansion).replace(/(?:\r\n|\r|\n)/g, '<br>');
    } else if (kind === 'note') {
      return '<span class="tag note">note</span>'
        +  this.escapeHTML(event.message).replace(/(?:\r\n|\r|\n)/g, '<br>');
    }
  },

  addExtraPathEvents : function (events, kind) {
    var that = this;

    if (!events) {
      return;
    }

    events.forEach(function (event) {
      if (event.location.file !== that._currentBugEvent.location.file) {
        return;
      }

      var left =
        that._codeMirror.defaultCharWidth() * event.location.col + 'px';

      var element = document.createElement('div');
      element.setAttribute('style', 'margin-left: ' + left);
      element.setAttribute('class', 'check-msg ' + kind);

      var msg = document.createElement('span');
      msg.innerHTML = that.getMessage(event, kind);
      element.appendChild(msg);

      that._lineWidgets.push(that._codeMirror.addLineWidget(
        event.location.line - 1, element));
    });
  },

  drawBugPath : function () {
    var that = this;

    this.clearBubbles();

    this.addExtraPathEvents(this._currentReport.macros, 'macro');
    this.addExtraPathEvents(this._currentReport.notes, 'note');

    // Processing bug path events.
    var currentEvents = this._currentReport.events;
    currentEvents.forEach(function (event, step) {
      if (event.location.file !== that._currentBugEvent.location.file)
        return;

      var left =
        that._codeMirror.defaultCharWidth() * event.location.col + 'px';
      var type = step === currentEvents.length - 1 ? 'error' : 'info';

      var element = document.createElement('div');
      element.setAttribute('style', 'margin-left: ' + left);
      element.setAttribute('class', 'check-msg ' + type);
      element.setAttribute('idx', step);

      var enumeration = document.createElement('span');
      enumeration.setAttribute('class', 'checker-enum ' + type);
      enumeration.innerHTML = step + 1;

      if (currentEvents.length > 1)
        element.appendChild(enumeration);

      var prevBugEvent = step - 1;
      if (step > 0) {
        var prevBug = document.createElement('span');
        prevBug.setAttribute('class', 'arrow left-arrow');
        prevBug.addEventListener('click', function () {
          var event = currentEvents[prevBugEvent];
          that.setCurrentBugEvent(event, prevBugEvent);
        });
        element.appendChild(prevBug);
      }

      var msg = document.createElement('span');
      msg.innerHTML = that.escapeHTML(event.message)
        .replace(/(?:\r\n|\r|\n)/g, '<br>');

      element.appendChild(msg);

      var nextBugEvent = step + 1;
      if (nextBugEvent < currentEvents.length) {
        var nextBug = document.createElement('span');
        nextBug.setAttribute('class', 'arrow right-arrow');
        nextBug.addEventListener('click', function () {
          var event = currentEvents[nextBugEvent];
          that.setCurrentBugEvent(event, nextBugEvent);
        });
        element.appendChild(nextBug);
      }


      that._lineWidgets.push(that._codeMirror.addLineWidget(
        event.location.line - 1, element));
    });
  },

  jumpTo : function (line, column) {
    var that = this;

    setTimeout(function () {
      var selPosPixel
        = that._codeMirror.charCoords({ line : line, ch : column }, 'local');
      var editorSize = {
        width  : that._editor.clientWidth,
        height : that._editor.clientHeight
      };

      that._codeMirror.scrollIntoView({
        top    : selPosPixel.top - 100,
        bottom : selPosPixel.top + editorSize.height - 150,
        left   : selPosPixel.left < editorSize.width - 100
               ? 0
               : selPosPixel.left - 50,
        right  : selPosPixel.left < editorSize.width - 100
               ? 10
               : selPosPixel.left + editorSize.width - 100
      });
    }, 0);
  }
}


      var data = {"files": {"1": {"id": 1, "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "content": "/* SPDX-License-Identifier: LGPL-2.1+ */\n\n#if HAVE_BLKID\n#include <blkid.h>\n#endif\n#include <errno.h>\n#include <getopt.h>\n#include <grp.h>\n#include <linux/loop.h>\n#include <pwd.h>\n#include <sched.h>\n#if HAVE_SELINUX\n#include <selinux/selinux.h>\n#endif\n#include <signal.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/file.h>\n#include <sys/mount.h>\n#include <sys/personality.h>\n#include <sys/prctl.h>\n#include <sys/types.h>\n#include <sys/wait.h>\n#include <unistd.h>\n\n#include \"sd-bus.h\"\n#include \"sd-daemon.h\"\n#include \"sd-id128.h\"\n\n#include \"alloc-util.h\"\n#include \"barrier.h\"\n#include \"base-filesystem.h\"\n#include \"blkid-util.h\"\n#include \"btrfs-util.h\"\n#include \"bus-error.h\"\n#include \"bus-util.h\"\n#include \"cap-list.h\"\n#include \"capability-util.h\"\n#include \"cgroup-util.h\"\n#include \"copy.h\"\n#include \"cpu-set-util.h\"\n#include \"dev-setup.h\"\n#include \"dissect-image.h\"\n#include \"env-util.h\"\n#include \"fd-util.h\"\n#include \"fdset.h\"\n#include \"fileio.h\"\n#include \"format-util.h\"\n#include \"fs-util.h\"\n#include \"gpt.h\"\n#include \"hexdecoct.h\"\n#include \"hostname-util.h\"\n#include \"id128-util.h\"\n#include \"log.h\"\n#include \"loop-util.h\"\n#include \"loopback-setup.h\"\n#include \"machine-image.h\"\n#include \"macro.h\"\n#include \"missing.h\"\n#include \"mkdir.h\"\n#include \"mount-util.h\"\n#include \"netlink-util.h\"\n#include \"nspawn-cgroup.h\"\n#include \"nspawn-def.h\"\n#include \"nspawn-expose-ports.h\"\n#include \"nspawn-mount.h\"\n#include \"nspawn-network.h\"\n#include \"nspawn-patch-uid.h\"\n#include \"nspawn-register.h\"\n#include \"nspawn-seccomp.h\"\n#include \"nspawn-settings.h\"\n#include \"nspawn-setuid.h\"\n#include \"nspawn-stub-pid1.h\"\n#include \"os-util.h\"\n#include \"pager.h\"\n#include \"parse-util.h\"\n#include \"path-util.h\"\n#include \"process-util.h\"\n#include \"ptyfwd.h\"\n#include \"random-util.h\"\n#include \"raw-clone.h\"\n#include \"rlimit-util.h\"\n#include \"rm-rf.h\"\n#include \"selinux-util.h\"\n#include \"signal-util.h\"\n#include \"socket-util.h\"\n#include \"stat-util.h\"\n#include \"stdio-util.h\"\n#include \"string-table.h\"\n#include \"string-util.h\"\n#include \"strv.h\"\n#include \"terminal-util.h\"\n#include \"udev-util.h\"\n#include \"umask-util.h\"\n#include \"user-util.h\"\n#include \"util.h\"\n\n#if HAVE_SPLIT_USR\n#define STATIC_RESOLV_CONF \"/lib/systemd/resolv.conf\"\n#else\n#define STATIC_RESOLV_CONF \"/usr/lib/systemd/resolv.conf\"\n#endif\n\n/* nspawn is listening on the socket at the path in the constant nspawn_notify_socket_path\n * nspawn_notify_socket_path is relative to the container\n * the init process in the container pid can send messages to nspawn following the sd_notify(3) protocol */\n#define NSPAWN_NOTIFY_SOCKET_PATH \"/run/systemd/nspawn/notify\"\n\n#define EXIT_FORCE_RESTART 133\n\ntypedef enum ContainerStatus {\n        CONTAINER_TERMINATED,\n        CONTAINER_REBOOTED\n} ContainerStatus;\n\nstatic char *arg_directory = NULL;\nstatic char *arg_template = NULL;\nstatic char *arg_chdir = NULL;\nstatic char *arg_pivot_root_new = NULL;\nstatic char *arg_pivot_root_old = NULL;\nstatic char *arg_user = NULL;\nstatic sd_id128_t arg_uuid = {};\nstatic char *arg_machine = NULL;     /* The name used by the host to refer to this */\nstatic char *arg_hostname = NULL;    /* The name the payload sees by default */\nstatic const char *arg_selinux_context = NULL;\nstatic const char *arg_selinux_apifs_context = NULL;\nstatic const char *arg_slice = NULL;\nstatic bool arg_private_network = false;\nstatic bool arg_read_only = false;\nstatic StartMode arg_start_mode = START_PID1;\nstatic bool arg_ephemeral = false;\nstatic LinkJournal arg_link_journal = LINK_AUTO;\nstatic bool arg_link_journal_try = false;\nstatic uint64_t arg_caps_retain =\n        (1ULL << CAP_AUDIT_CONTROL) |\n        (1ULL << CAP_AUDIT_WRITE) |\n        (1ULL << CAP_CHOWN) |\n        (1ULL << CAP_DAC_OVERRIDE) |\n        (1ULL << CAP_DAC_READ_SEARCH) |\n        (1ULL << CAP_FOWNER) |\n        (1ULL << CAP_FSETID) |\n        (1ULL << CAP_IPC_OWNER) |\n        (1ULL << CAP_KILL) |\n        (1ULL << CAP_LEASE) |\n        (1ULL << CAP_LINUX_IMMUTABLE) |\n        (1ULL << CAP_MKNOD) |\n        (1ULL << CAP_NET_BIND_SERVICE) |\n        (1ULL << CAP_NET_BROADCAST) |\n        (1ULL << CAP_NET_RAW) |\n        (1ULL << CAP_SETFCAP) |\n        (1ULL << CAP_SETGID) |\n        (1ULL << CAP_SETPCAP) |\n        (1ULL << CAP_SETUID) |\n        (1ULL << CAP_SYS_ADMIN) |\n        (1ULL << CAP_SYS_BOOT) |\n        (1ULL << CAP_SYS_CHROOT) |\n        (1ULL << CAP_SYS_NICE) |\n        (1ULL << CAP_SYS_PTRACE) |\n        (1ULL << CAP_SYS_RESOURCE) |\n        (1ULL << CAP_SYS_TTY_CONFIG);\nstatic CustomMount *arg_custom_mounts = NULL;\nstatic size_t arg_n_custom_mounts = 0;\nstatic char **arg_setenv = NULL;\nstatic bool arg_quiet = false;\nstatic bool arg_register = true;\nstatic bool arg_keep_unit = false;\nstatic char **arg_network_interfaces = NULL;\nstatic char **arg_network_macvlan = NULL;\nstatic char **arg_network_ipvlan = NULL;\nstatic bool arg_network_veth = false;\nstatic char **arg_network_veth_extra = NULL;\nstatic char *arg_network_bridge = NULL;\nstatic char *arg_network_zone = NULL;\nstatic char *arg_network_namespace_path = NULL;\nstatic unsigned long arg_personality = PERSONALITY_INVALID;\nstatic char *arg_image = NULL;\nstatic VolatileMode arg_volatile_mode = VOLATILE_NO;\nstatic ExposePort *arg_expose_ports = NULL;\nstatic char **arg_property = NULL;\nstatic UserNamespaceMode arg_userns_mode = USER_NAMESPACE_NO;\nstatic uid_t arg_uid_shift = UID_INVALID, arg_uid_range = 0x10000U;\nstatic bool arg_userns_chown = false;\nstatic int arg_kill_signal = 0;\nstatic CGroupUnified arg_unified_cgroup_hierarchy = CGROUP_UNIFIED_UNKNOWN;\nstatic SettingsMask arg_settings_mask = 0;\nstatic int arg_settings_trusted = -1;\nstatic char **arg_parameters = NULL;\nstatic const char *arg_container_service_name = \"systemd-nspawn\";\nstatic bool arg_notify_ready = false;\nstatic bool arg_use_cgns = true;\nstatic unsigned long arg_clone_ns_flags = CLONE_NEWIPC|CLONE_NEWPID|CLONE_NEWUTS;\nstatic MountSettingsMask arg_mount_settings = MOUNT_APPLY_APIVFS_RO;\nstatic void *arg_root_hash = NULL;\nstatic size_t arg_root_hash_size = 0;\nstatic char **arg_syscall_whitelist = NULL;\nstatic char **arg_syscall_blacklist = NULL;\nstatic struct rlimit *arg_rlimit[_RLIMIT_MAX] = {};\nstatic bool arg_no_new_privileges = false;\nstatic int arg_oom_score_adjust = 0;\nstatic bool arg_oom_score_adjust_set = false;\nstatic cpu_set_t *arg_cpuset = NULL;\nstatic unsigned arg_cpuset_ncpus = 0;\nstatic ResolvConfMode arg_resolv_conf = RESOLV_CONF_AUTO;\nstatic TimezoneMode arg_timezone = TIMEZONE_AUTO;\n\nstatic void help(void) {\n        (void) pager_open(false, false);\n\n        printf(\"%s [OPTIONS...] [PATH] [ARGUMENTS...]\\n\\n\"\n               \"Spawn a minimal namespace container for debugging, testing and building.\\n\\n\"\n               \"  -h --help                 Show this help\\n\"\n               \"     --version              Print version string\\n\"\n               \"  -q --quiet                Do not show status information\\n\"\n               \"  -D --directory=PATH       Root directory for the container\\n\"\n               \"     --template=PATH        Initialize root directory from template directory,\\n\"\n               \"                            if missing\\n\"\n               \"  -x --ephemeral            Run container with snapshot of root directory, and\\n\"\n               \"                            remove it after exit\\n\"\n               \"  -i --image=PATH           File system device or disk image for the container\\n\"\n               \"     --root-hash=HASH       Specify verity root hash\\n\"\n               \"  -a --as-pid2              Maintain a stub init as PID1, invoke binary as PID2\\n\"\n               \"  -b --boot                 Boot up full system (i.e. invoke init)\\n\"\n               \"     --chdir=PATH           Set working directory in the container\\n\"\n               \"     --pivot-root=PATH[:PATH]\\n\"\n               \"                            Pivot root to given directory in the container\\n\"\n               \"  -u --user=USER            Run the command under specified user or uid\\n\"\n               \"  -M --machine=NAME         Set the machine name for the container\\n\"\n               \"     --hostname=NAME        Override the hostname for the container\\n\"\n               \"     --uuid=UUID            Set a specific machine UUID for the container\\n\"\n               \"  -S --slice=SLICE          Place the container in the specified slice\\n\"\n               \"     --property=NAME=VALUE  Set scope unit property\\n\"\n               \"  -U --private-users=pick   Run within user namespace, autoselect UID/GID range\\n\"\n               \"     --private-users[=UIDBASE[:NUIDS]]\\n\"\n               \"                            Similar, but with user configured UID/GID range\\n\"\n               \"     --private-users-chown  Adjust OS tree ownership to private UID/GID range\\n\"\n               \"     --private-network      Disable network in container\\n\"\n               \"     --network-interface=INTERFACE\\n\"\n               \"                            Assign an existing network interface to the\\n\"\n               \"                            container\\n\"\n               \"     --network-macvlan=INTERFACE\\n\"\n               \"                            Create a macvlan network interface based on an\\n\"\n               \"                            existing network interface to the container\\n\"\n               \"     --network-ipvlan=INTERFACE\\n\"\n               \"                            Create a ipvlan network interface based on an\\n\"\n               \"                            existing network interface to the container\\n\"\n               \"  -n --network-veth         Add a virtual Ethernet connection between host\\n\"\n               \"                            and container\\n\"\n               \"     --network-veth-extra=HOSTIF[:CONTAINERIF]\\n\"\n               \"                            Add an additional virtual Ethernet link between\\n\"\n               \"                            host and container\\n\"\n               \"     --network-bridge=INTERFACE\\n\"\n               \"                            Add a virtual Ethernet connection to the container\\n\"\n               \"                            and attach it to an existing bridge on the host\\n\"\n               \"     --network-zone=NAME    Similar, but attach the new interface to an\\n\"\n               \"                            an automatically managed bridge interface\\n\"\n               \"     --network-namespace-path=PATH\\n\"\n               \"                            Set network namespace to the one represented by\\n\"\n               \"                            the specified kernel namespace file node\\n\"\n               \"  -p --port=[PROTOCOL:]HOSTPORT[:CONTAINERPORT]\\n\"\n               \"                            Expose a container IP port on the host\\n\"\n               \"  -Z --selinux-context=SECLABEL\\n\"\n               \"                            Set the SELinux security context to be used by\\n\"\n               \"                            processes in the container\\n\"\n               \"  -L --selinux-apifs-context=SECLABEL\\n\"\n               \"                            Set the SELinux security context to be used by\\n\"\n               \"                            API/tmpfs file systems in the container\\n\"\n               \"     --capability=CAP       In addition to the default, retain specified\\n\"\n               \"                            capability\\n\"\n               \"     --drop-capability=CAP  Drop the specified capability from the default set\\n\"\n               \"     --system-call-filter=LIST|~LIST\\n\"\n               \"                            Permit/prohibit specific system calls\\n\"\n               \"     --rlimit=NAME=LIMIT    Set a resource limit for the payload\\n\"\n               \"     --oom-score-adjust=VALUE\\n\"\n               \"                            Adjust the OOM score value for the payload\\n\"\n               \"     --cpu-affinity=CPUS    Adjust the CPU affinity of the container\\n\"\n               \"     --kill-signal=SIGNAL   Select signal to use for shutting down PID 1\\n\"\n               \"     --link-journal=MODE    Link up guest journal, one of no, auto, guest, \\n\"\n               \"                            host, try-guest, try-host\\n\"\n               \"  -j                        Equivalent to --link-journal=try-guest\\n\"\n               \"     --resolv-conf=MODE     Select mode of /etc/resolv.conf initialization\\n\"\n               \"     --timezone=MODE        Select mode of /etc/localtime initialization\\n\"\n               \"     --read-only            Mount the root directory read-only\\n\"\n               \"     --bind=PATH[:PATH[:OPTIONS]]\\n\"\n               \"                            Bind mount a file or directory from the host into\\n\"\n               \"                            the container\\n\"\n               \"     --bind-ro=PATH[:PATH[:OPTIONS]\\n\"\n               \"                            Similar, but creates a read-only bind mount\\n\"\n               \"     --tmpfs=PATH:[OPTIONS] Mount an empty tmpfs to the specified directory\\n\"\n               \"     --overlay=PATH[:PATH...]:PATH\\n\"\n               \"                            Create an overlay mount from the host to \\n\"\n               \"                            the container\\n\"\n               \"     --overlay-ro=PATH[:PATH...]:PATH\\n\"\n               \"                            Similar, but creates a read-only overlay mount\\n\"\n               \"  -E --setenv=NAME=VALUE    Pass an environment variable to PID 1\\n\"\n               \"     --register=BOOLEAN     Register container as machine\\n\"\n               \"     --keep-unit            Do not register a scope for the machine, reuse\\n\"\n               \"                            the service unit nspawn is running in\\n\"\n               \"     --volatile[=MODE]      Run the system in volatile mode\\n\"\n               \"     --settings=BOOLEAN     Load additional settings from .nspawn file\\n\"\n               \"     --notify-ready=BOOLEAN Receive notifications from the child init process\\n\"\n               , program_invocation_short_name);\n}\n\nstatic int custom_mount_check_all(void) {\n        size_t i;\n\n        for (i = 0; i < arg_n_custom_mounts; i++) {\n                CustomMount *m = &arg_custom_mounts[i];\n\n                if (path_equal(m->destination, \"/\") && arg_userns_mode != USER_NAMESPACE_NO) {\n\n                        if (arg_userns_chown) {\n                                log_error(\"--private-users-chown may not be combined with custom root mounts.\");\n                                return -EINVAL;\n                        } else if (arg_uid_shift == UID_INVALID) {\n                                log_error(\"--private-users with automatic UID shift may not be combined with custom root mounts.\");\n                                return -EINVAL;\n                        }\n                }\n        }\n\n        return 0;\n}\n\nstatic int detect_unified_cgroup_hierarchy_from_environment(void) {\n        const char *e;\n        int r;\n\n        /* Allow the user to control whether the unified hierarchy is used */\n        e = getenv(\"UNIFIED_CGROUP_HIERARCHY\");\n        if (e) {\n                r = parse_boolean(e);\n                if (r < 0)\n                        return log_error_errno(r, \"Failed to parse $UNIFIED_CGROUP_HIERARCHY.\");\n                if (r > 0)\n                        arg_unified_cgroup_hierarchy = CGROUP_UNIFIED_ALL;\n                else\n                        arg_unified_cgroup_hierarchy = CGROUP_UNIFIED_NONE;\n        }\n\n        return 0;\n}\n\nstatic int detect_unified_cgroup_hierarchy_from_image(const char *directory) {\n        int r;\n\n        /* Let's inherit the mode to use from the host system, but let's take into consideration what systemd in the\n         * image actually supports. */\n        r = cg_all_unified();\n        if (r < 0)\n                return log_error_errno(r, \"Failed to determine whether we are in all unified mode.\");\n        if (r > 0) {\n                /* Unified cgroup hierarchy support was added in 230. Unfortunately the detection\n                 * routine only detects 231, so we'll have a false negative here for 230. */\n                r = systemd_installation_has_version(directory, 230);\n                if (r < 0)\n                        return log_error_errno(r, \"Failed to determine systemd version in container: %m\");\n                if (r > 0)\n                        arg_unified_cgroup_hierarchy = CGROUP_UNIFIED_ALL;\n                else\n                        arg_unified_cgroup_hierarchy = CGROUP_UNIFIED_NONE;\n        } else if (cg_unified_controller(SYSTEMD_CGROUP_CONTROLLER) > 0) {\n                /* Mixed cgroup hierarchy support was added in 233 */\n                r = systemd_installation_has_version(directory, 233);\n                if (r < 0)\n                        return log_error_errno(r, \"Failed to determine systemd version in container: %m\");\n                if (r > 0)\n                        arg_unified_cgroup_hierarchy = CGROUP_UNIFIED_SYSTEMD;\n                else\n                        arg_unified_cgroup_hierarchy = CGROUP_UNIFIED_NONE;\n        } else\n                arg_unified_cgroup_hierarchy = CGROUP_UNIFIED_NONE;\n\n        log_debug(\"Using %s hierarchy for container.\",\n                  arg_unified_cgroup_hierarchy == CGROUP_UNIFIED_NONE ? \"legacy\" :\n                  arg_unified_cgroup_hierarchy == CGROUP_UNIFIED_SYSTEMD ? \"hybrid\" : \"unified\");\n\n        return 0;\n}\n\nstatic void parse_share_ns_env(const char *name, unsigned long ns_flag) {\n        int r;\n\n        r = getenv_bool(name);\n        if (r == -ENXIO)\n                return;\n        if (r < 0)\n                log_warning_errno(r, \"Failed to parse %s from environment, defaulting to false.\", name);\n        arg_clone_ns_flags = (arg_clone_ns_flags & ~ns_flag) | (r > 0 ? 0 : ns_flag);\n}\n\nstatic void parse_mount_settings_env(void) {\n        int r;\n        const char *e;\n\n        e = getenv(\"SYSTEMD_NSPAWN_API_VFS_WRITABLE\");\n        if (!e)\n                return;\n\n        if (streq(e, \"network\")) {\n                arg_mount_settings |= MOUNT_APPLY_APIVFS_RO|MOUNT_APPLY_APIVFS_NETNS;\n                return;\n        }\n\n        r = parse_boolean(e);\n        if (r < 0) {\n                log_warning_errno(r, \"Failed to parse SYSTEMD_NSPAWN_API_VFS_WRITABLE from environment, ignoring.\");\n                return;\n        }\n\n        SET_FLAG(arg_mount_settings, MOUNT_APPLY_APIVFS_RO, r == 0);\n        SET_FLAG(arg_mount_settings, MOUNT_APPLY_APIVFS_NETNS, false);\n}\n\nstatic int parse_argv(int argc, char *argv[]) {\n        enum {\n                ARG_VERSION = 0x100,\n                ARG_PRIVATE_NETWORK,\n                ARG_UUID,\n                ARG_READ_ONLY,\n                ARG_CAPABILITY,\n                ARG_DROP_CAPABILITY,\n                ARG_LINK_JOURNAL,\n                ARG_BIND,\n                ARG_BIND_RO,\n                ARG_TMPFS,\n                ARG_OVERLAY,\n                ARG_OVERLAY_RO,\n                ARG_SHARE_SYSTEM,\n                ARG_REGISTER,\n                ARG_KEEP_UNIT,\n                ARG_NETWORK_INTERFACE,\n                ARG_NETWORK_MACVLAN,\n                ARG_NETWORK_IPVLAN,\n                ARG_NETWORK_BRIDGE,\n                ARG_NETWORK_ZONE,\n                ARG_NETWORK_VETH_EXTRA,\n                ARG_NETWORK_NAMESPACE_PATH,\n                ARG_PERSONALITY,\n                ARG_VOLATILE,\n                ARG_TEMPLATE,\n                ARG_PROPERTY,\n                ARG_PRIVATE_USERS,\n                ARG_KILL_SIGNAL,\n                ARG_SETTINGS,\n                ARG_CHDIR,\n                ARG_PIVOT_ROOT,\n                ARG_PRIVATE_USERS_CHOWN,\n                ARG_NOTIFY_READY,\n                ARG_ROOT_HASH,\n                ARG_SYSTEM_CALL_FILTER,\n                ARG_RLIMIT,\n                ARG_HOSTNAME,\n                ARG_NO_NEW_PRIVILEGES,\n                ARG_OOM_SCORE_ADJUST,\n                ARG_CPU_AFFINITY,\n                ARG_RESOLV_CONF,\n                ARG_TIMEZONE,\n        };\n\n        static const struct option options[] = {\n                { \"help\",                   no_argument,       NULL, 'h'                        },\n                { \"version\",                no_argument,       NULL, ARG_VERSION                },\n                { \"directory\",              required_argument, NULL, 'D'                        },\n                { \"template\",               required_argument, NULL, ARG_TEMPLATE               },\n                { \"ephemeral\",              no_argument,       NULL, 'x'                        },\n                { \"user\",                   required_argument, NULL, 'u'                        },\n                { \"private-network\",        no_argument,       NULL, ARG_PRIVATE_NETWORK        },\n                { \"as-pid2\",                no_argument,       NULL, 'a'                        },\n                { \"boot\",                   no_argument,       NULL, 'b'                        },\n                { \"uuid\",                   required_argument, NULL, ARG_UUID                   },\n                { \"read-only\",              no_argument,       NULL, ARG_READ_ONLY              },\n                { \"capability\",             required_argument, NULL, ARG_CAPABILITY             },\n                { \"drop-capability\",        required_argument, NULL, ARG_DROP_CAPABILITY        },\n                { \"no-new-privileges\",      required_argument, NULL, ARG_NO_NEW_PRIVILEGES      },\n                { \"link-journal\",           required_argument, NULL, ARG_LINK_JOURNAL           },\n                { \"bind\",                   required_argument, NULL, ARG_BIND                   },\n                { \"bind-ro\",                required_argument, NULL, ARG_BIND_RO                },\n                { \"tmpfs\",                  required_argument, NULL, ARG_TMPFS                  },\n                { \"overlay\",                required_argument, NULL, ARG_OVERLAY                },\n                { \"overlay-ro\",             required_argument, NULL, ARG_OVERLAY_RO             },\n                { \"machine\",                required_argument, NULL, 'M'                        },\n                { \"hostname\",               required_argument, NULL, ARG_HOSTNAME               },\n                { \"slice\",                  required_argument, NULL, 'S'                        },\n                { \"setenv\",                 required_argument, NULL, 'E'                        },\n                { \"selinux-context\",        required_argument, NULL, 'Z'                        },\n                { \"selinux-apifs-context\",  required_argument, NULL, 'L'                        },\n                { \"quiet\",                  no_argument,       NULL, 'q'                        },\n                { \"share-system\",           no_argument,       NULL, ARG_SHARE_SYSTEM           }, /* not documented */\n                { \"register\",               required_argument, NULL, ARG_REGISTER               },\n                { \"keep-unit\",              no_argument,       NULL, ARG_KEEP_UNIT              },\n                { \"network-interface\",      required_argument, NULL, ARG_NETWORK_INTERFACE      },\n                { \"network-macvlan\",        required_argument, NULL, ARG_NETWORK_MACVLAN        },\n                { \"network-ipvlan\",         required_argument, NULL, ARG_NETWORK_IPVLAN         },\n                { \"network-veth\",           no_argument,       NULL, 'n'                        },\n                { \"network-veth-extra\",     required_argument, NULL, ARG_NETWORK_VETH_EXTRA     },\n                { \"network-bridge\",         required_argument, NULL, ARG_NETWORK_BRIDGE         },\n                { \"network-zone\",           required_argument, NULL, ARG_NETWORK_ZONE           },\n                { \"network-namespace-path\", required_argument, NULL, ARG_NETWORK_NAMESPACE_PATH },\n                { \"personality\",            required_argument, NULL, ARG_PERSONALITY            },\n                { \"image\",                  required_argument, NULL, 'i'                        },\n                { \"volatile\",               optional_argument, NULL, ARG_VOLATILE               },\n                { \"port\",                   required_argument, NULL, 'p'                        },\n                { \"property\",               required_argument, NULL, ARG_PROPERTY               },\n                { \"private-users\",          optional_argument, NULL, ARG_PRIVATE_USERS          },\n                { \"private-users-chown\",    optional_argument, NULL, ARG_PRIVATE_USERS_CHOWN    },\n                { \"kill-signal\",            required_argument, NULL, ARG_KILL_SIGNAL            },\n                { \"settings\",               required_argument, NULL, ARG_SETTINGS               },\n                { \"chdir\",                  required_argument, NULL, ARG_CHDIR                  },\n                { \"pivot-root\",             required_argument, NULL, ARG_PIVOT_ROOT             },\n                { \"notify-ready\",           required_argument, NULL, ARG_NOTIFY_READY           },\n                { \"root-hash\",              required_argument, NULL, ARG_ROOT_HASH              },\n                { \"system-call-filter\",     required_argument, NULL, ARG_SYSTEM_CALL_FILTER     },\n                { \"rlimit\",                 required_argument, NULL, ARG_RLIMIT                 },\n                { \"oom-score-adjust\",       required_argument, NULL, ARG_OOM_SCORE_ADJUST       },\n                { \"cpu-affinity\",           required_argument, NULL, ARG_CPU_AFFINITY           },\n                { \"resolv-conf\",            required_argument, NULL, ARG_RESOLV_CONF            },\n                { \"timezone\",               required_argument, NULL, ARG_TIMEZONE               },\n                {}\n        };\n\n        int c, r;\n        const char *p, *e;\n        uint64_t plus = 0, minus = 0;\n        bool mask_all_settings = false, mask_no_settings = false;\n\n        assert(argc >= 0);\n        assert(argv);\n\n        while ((c = getopt_long(argc, argv, \"+hD:u:abL:M:jS:Z:qi:xp:nUE:\", options, NULL)) >= 0)\n                switch (c) {\n\n                case 'h':\n                        help();\n                        return 0;\n\n                case ARG_VERSION:\n                        return version();\n\n                case 'D':\n                        r = parse_path_argument_and_warn(optarg, false, &arg_directory);\n                        if (r < 0)\n                                return r;\n                        break;\n\n                case ARG_TEMPLATE:\n                        r = parse_path_argument_and_warn(optarg, false, &arg_template);\n                        if (r < 0)\n                                return r;\n                        break;\n\n                case 'i':\n                        r = parse_path_argument_and_warn(optarg, false, &arg_image);\n                        if (r < 0)\n                                return r;\n                        break;\n\n                case 'x':\n                        arg_ephemeral = true;\n                        break;\n\n                case 'u':\n                        r = free_and_strdup(&arg_user, optarg);\n                        if (r < 0)\n                                return log_oom();\n\n                        arg_settings_mask |= SETTING_USER;\n                        break;\n\n                case ARG_NETWORK_ZONE: {\n                        char *j;\n\n                        j = strappend(\"vz-\", optarg);\n                        if (!j)\n                                return log_oom();\n\n                        if (!ifname_valid(j)) {\n                                log_error(\"Network zone name not valid: %s\", j);\n                                free(j);\n                                return -EINVAL;\n                        }\n\n                        free_and_replace(arg_network_zone, j);\n\n                        arg_network_veth = true;\n                        arg_private_network = true;\n                        arg_settings_mask |= SETTING_NETWORK;\n                        break;\n                }\n\n                case ARG_NETWORK_BRIDGE:\n\n                        if (!ifname_valid(optarg)) {\n                                log_error(\"Bridge interface name not valid: %s\", optarg);\n                                return -EINVAL;\n                        }\n\n                        r = free_and_strdup(&arg_network_bridge, optarg);\n                        if (r < 0)\n                                return log_oom();\n\n                        _fallthrough_;\n                case 'n':\n                        arg_network_veth = true;\n                        arg_private_network = true;\n                        arg_settings_mask |= SETTING_NETWORK;\n                        break;\n\n                case ARG_NETWORK_VETH_EXTRA:\n                        r = veth_extra_parse(&arg_network_veth_extra, optarg);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to parse --network-veth-extra= parameter: %s\", optarg);\n\n                        arg_private_network = true;\n                        arg_settings_mask |= SETTING_NETWORK;\n                        break;\n\n                case ARG_NETWORK_INTERFACE:\n                        if (!ifname_valid(optarg)) {\n                                log_error(\"Network interface name not valid: %s\", optarg);\n                                return -EINVAL;\n                        }\n\n                        if (strv_extend(&arg_network_interfaces, optarg) < 0)\n                                return log_oom();\n\n                        arg_private_network = true;\n                        arg_settings_mask |= SETTING_NETWORK;\n                        break;\n\n                case ARG_NETWORK_MACVLAN:\n\n                        if (!ifname_valid(optarg)) {\n                                log_error(\"MACVLAN network interface name not valid: %s\", optarg);\n                                return -EINVAL;\n                        }\n\n                        if (strv_extend(&arg_network_macvlan, optarg) < 0)\n                                return log_oom();\n\n                        arg_private_network = true;\n                        arg_settings_mask |= SETTING_NETWORK;\n                        break;\n\n                case ARG_NETWORK_IPVLAN:\n\n                        if (!ifname_valid(optarg)) {\n                                log_error(\"IPVLAN network interface name not valid: %s\", optarg);\n                                return -EINVAL;\n                        }\n\n                        if (strv_extend(&arg_network_ipvlan, optarg) < 0)\n                                return log_oom();\n\n                        _fallthrough_;\n                case ARG_PRIVATE_NETWORK:\n                        arg_private_network = true;\n                        arg_settings_mask |= SETTING_NETWORK;\n                        break;\n\n                case ARG_NETWORK_NAMESPACE_PATH:\n                        r = parse_path_argument_and_warn(optarg, false, &arg_network_namespace_path);\n                        if (r < 0)\n                                return r;\n\n                        break;\n\n                case 'b':\n                        if (arg_start_mode == START_PID2) {\n                                log_error(\"--boot and --as-pid2 may not be combined.\");\n                                return -EINVAL;\n                        }\n\n                        arg_start_mode = START_BOOT;\n                        arg_settings_mask |= SETTING_START_MODE;\n                        break;\n\n                case 'a':\n                        if (arg_start_mode == START_BOOT) {\n                                log_error(\"--boot and --as-pid2 may not be combined.\");\n                                return -EINVAL;\n                        }\n\n                        arg_start_mode = START_PID2;\n                        arg_settings_mask |= SETTING_START_MODE;\n                        break;\n\n                case ARG_UUID:\n                        r = sd_id128_from_string(optarg, &arg_uuid);\n                        if (r < 0)\n                                return log_error_errno(r, \"Invalid UUID: %s\", optarg);\n\n                        if (sd_id128_is_null(arg_uuid)) {\n                                log_error(\"Machine UUID may not be all zeroes.\");\n                                return -EINVAL;\n                        }\n\n                        arg_settings_mask |= SETTING_MACHINE_ID;\n                        break;\n\n                case 'S':\n                        arg_slice = optarg;\n                        break;\n\n                case 'M':\n                        if (isempty(optarg))\n                                arg_machine = mfree(arg_machine);\n                        else {\n                                if (!machine_name_is_valid(optarg)) {\n                                        log_error(\"Invalid machine name: %s\", optarg);\n                                        return -EINVAL;\n                                }\n\n                                r = free_and_strdup(&arg_machine, optarg);\n                                if (r < 0)\n                                        return log_oom();\n                        }\n                        break;\n\n                case ARG_HOSTNAME:\n                        if (isempty(optarg))\n                                arg_hostname = mfree(arg_hostname);\n                        else {\n                                if (!hostname_is_valid(optarg, false)) {\n                                        log_error(\"Invalid hostname: %s\", optarg);\n                                        return -EINVAL;\n                                }\n\n                                r = free_and_strdup(&arg_hostname, optarg);\n                                if (r < 0)\n                                        return log_oom();\n                        }\n\n                        arg_settings_mask |= SETTING_HOSTNAME;\n                        break;\n\n                case 'Z':\n                        arg_selinux_context = optarg;\n                        break;\n\n                case 'L':\n                        arg_selinux_apifs_context = optarg;\n                        break;\n\n                case ARG_READ_ONLY:\n                        arg_read_only = true;\n                        arg_settings_mask |= SETTING_READ_ONLY;\n                        break;\n\n                case ARG_CAPABILITY:\n                case ARG_DROP_CAPABILITY: {\n                        p = optarg;\n                        for (;;) {\n                                _cleanup_free_ char *t = NULL;\n\n                                r = extract_first_word(&p, &t, \",\", 0);\n                                if (r < 0)\n                                        return log_error_errno(r, \"Failed to parse capability %s.\", t);\n\n                                if (r == 0)\n                                        break;\n\n                                if (streq(t, \"all\")) {\n                                        if (c == ARG_CAPABILITY)\n                                                plus = (uint64_t) -1;\n                                        else\n                                                minus = (uint64_t) -1;\n                                } else {\n                                        int cap;\n\n                                        cap = capability_from_name(t);\n                                        if (cap < 0) {\n                                                log_error(\"Failed to parse capability %s.\", t);\n                                                return -EINVAL;\n                                        }\n\n                                        if (c == ARG_CAPABILITY)\n                                                plus |= 1ULL << (uint64_t) cap;\n                                        else\n                                                minus |= 1ULL << (uint64_t) cap;\n                                }\n                        }\n\n                        arg_settings_mask |= SETTING_CAPABILITY;\n                        break;\n                }\n\n                case ARG_NO_NEW_PRIVILEGES:\n                        r = parse_boolean(optarg);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to parse --no-new-privileges= argument: %s\", optarg);\n\n                        arg_no_new_privileges = r;\n                        arg_settings_mask |= SETTING_NO_NEW_PRIVILEGES;\n                        break;\n\n                case 'j':\n                        arg_link_journal = LINK_GUEST;\n                        arg_link_journal_try = true;\n                        arg_settings_mask |= SETTING_LINK_JOURNAL;\n                        break;\n\n                case ARG_LINK_JOURNAL:\n                        r = parse_link_journal(optarg, &arg_link_journal, &arg_link_journal_try);\n                        if (r < 0) {\n                                log_error_errno(r, \"Failed to parse link journal mode %s\", optarg);\n                                return -EINVAL;\n                        }\n\n                        arg_settings_mask |= SETTING_LINK_JOURNAL;\n                        break;\n\n                case ARG_BIND:\n                case ARG_BIND_RO:\n                        r = bind_mount_parse(&arg_custom_mounts, &arg_n_custom_mounts, optarg, c == ARG_BIND_RO);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to parse --bind(-ro)= argument %s: %m\", optarg);\n\n                        arg_settings_mask |= SETTING_CUSTOM_MOUNTS;\n                        break;\n\n                case ARG_TMPFS:\n                        r = tmpfs_mount_parse(&arg_custom_mounts, &arg_n_custom_mounts, optarg);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to parse --tmpfs= argument %s: %m\", optarg);\n\n                        arg_settings_mask |= SETTING_CUSTOM_MOUNTS;\n                        break;\n\n                case ARG_OVERLAY:\n                case ARG_OVERLAY_RO:\n                        r = overlay_mount_parse(&arg_custom_mounts, &arg_n_custom_mounts, optarg, c == ARG_OVERLAY_RO);\n                        if (r == -EADDRNOTAVAIL)\n                                return log_error_errno(r, \"--overlay(-ro)= needs at least two colon-separated directories specified.\");\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to parse --overlay(-ro)= argument %s: %m\", optarg);\n\n                        arg_settings_mask |= SETTING_CUSTOM_MOUNTS;\n                        break;\n\n                case 'E': {\n                        char **n;\n\n                        if (!env_assignment_is_valid(optarg)) {\n                                log_error(\"Environment variable assignment '%s' is not valid.\", optarg);\n                                return -EINVAL;\n                        }\n\n                        n = strv_env_set(arg_setenv, optarg);\n                        if (!n)\n                                return log_oom();\n\n                        strv_free_and_replace(arg_setenv, n);\n                        arg_settings_mask |= SETTING_ENVIRONMENT;\n                        break;\n                }\n\n                case 'q':\n                        arg_quiet = true;\n                        break;\n\n                case ARG_SHARE_SYSTEM:\n                        /* We don't officially support this anymore, except for compat reasons. People should use the\n                         * $SYSTEMD_NSPAWN_SHARE_* environment variables instead. */\n                        log_warning(\"Please do not use --share-system anymore, use $SYSTEMD_NSPAWN_SHARE_* instead.\");\n                        arg_clone_ns_flags = 0;\n                        break;\n\n                case ARG_REGISTER:\n                        r = parse_boolean(optarg);\n                        if (r < 0) {\n                                log_error(\"Failed to parse --register= argument: %s\", optarg);\n                                return r;\n                        }\n\n                        arg_register = r;\n                        break;\n\n                case ARG_KEEP_UNIT:\n                        arg_keep_unit = true;\n                        break;\n\n                case ARG_PERSONALITY:\n\n                        arg_personality = personality_from_string(optarg);\n                        if (arg_personality == PERSONALITY_INVALID) {\n                                log_error(\"Unknown or unsupported personality '%s'.\", optarg);\n                                return -EINVAL;\n                        }\n\n                        arg_settings_mask |= SETTING_PERSONALITY;\n                        break;\n\n                case ARG_VOLATILE:\n\n                        if (!optarg)\n                                arg_volatile_mode = VOLATILE_YES;\n                        else if (streq(optarg, \"help\")) {\n                                DUMP_STRING_TABLE(volatile_mode, VolatileMode, _VOLATILE_MODE_MAX);\n                                return 0;\n                        } else {\n                                VolatileMode m;\n\n                                m = volatile_mode_from_string(optarg);\n                                if (m < 0) {\n                                        log_error(\"Failed to parse --volatile= argument: %s\", optarg);\n                                        return -EINVAL;\n                                } else\n                                        arg_volatile_mode = m;\n                        }\n\n                        arg_settings_mask |= SETTING_VOLATILE_MODE;\n                        break;\n\n                case 'p':\n                        r = expose_port_parse(&arg_expose_ports, optarg);\n                        if (r == -EEXIST)\n                                return log_error_errno(r, \"Duplicate port specification: %s\", optarg);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to parse host port %s: %m\", optarg);\n\n                        arg_settings_mask |= SETTING_EXPOSE_PORTS;\n                        break;\n\n                case ARG_PROPERTY:\n                        if (strv_extend(&arg_property, optarg) < 0)\n                                return log_oom();\n\n                        break;\n\n                case ARG_PRIVATE_USERS: {\n                        int boolean = -1;\n\n                        if (!optarg)\n                                boolean = true;\n                        else if (!in_charset(optarg, DIGITS))\n                                /* do *not* parse numbers as booleans */\n                                boolean = parse_boolean(optarg);\n\n                        if (boolean == false) {\n                                /* no: User namespacing off */\n                                arg_userns_mode = USER_NAMESPACE_NO;\n                                arg_uid_shift = UID_INVALID;\n                                arg_uid_range = UINT32_C(0x10000);\n                        } else if (boolean == true) {\n                                /* yes: User namespacing on, UID range is read from root dir */\n                                arg_userns_mode = USER_NAMESPACE_FIXED;\n                                arg_uid_shift = UID_INVALID;\n                                arg_uid_range = UINT32_C(0x10000);\n                        } else if (streq(optarg, \"pick\")) {\n                                /* pick: User namespacing on, UID range is picked randomly */\n                                arg_userns_mode = USER_NAMESPACE_PICK;\n                                arg_uid_shift = UID_INVALID;\n                                arg_uid_range = UINT32_C(0x10000);\n                        } else {\n                                _cleanup_free_ char *buffer = NULL;\n                                const char *range, *shift;\n\n                                /* anything else: User namespacing on, UID range is explicitly configured */\n\n                                range = strchr(optarg, ':');\n                                if (range) {\n                                        buffer = strndup(optarg, range - optarg);\n                                        if (!buffer)\n                                                return log_oom();\n                                        shift = buffer;\n\n                                        range++;\n                                        r = safe_atou32(range, &arg_uid_range);\n                                        if (r < 0)\n                                                return log_error_errno(r, \"Failed to parse UID range \\\"%s\\\": %m\", range);\n                                } else\n                                        shift = optarg;\n\n                                r = parse_uid(shift, &arg_uid_shift);\n                                if (r < 0)\n                                        return log_error_errno(r, \"Failed to parse UID \\\"%s\\\": %m\", optarg);\n\n                                arg_userns_mode = USER_NAMESPACE_FIXED;\n                        }\n\n                        if (arg_uid_range <= 0) {\n                                log_error(\"UID range cannot be 0.\");\n                                return -EINVAL;\n                        }\n\n                        arg_settings_mask |= SETTING_USERNS;\n                        break;\n                }\n\n                case 'U':\n                        if (userns_supported()) {\n                                arg_userns_mode = USER_NAMESPACE_PICK;\n                                arg_uid_shift = UID_INVALID;\n                                arg_uid_range = UINT32_C(0x10000);\n\n                                arg_settings_mask |= SETTING_USERNS;\n                        }\n\n                        break;\n\n                case ARG_PRIVATE_USERS_CHOWN:\n                        arg_userns_chown = true;\n\n                        arg_settings_mask |= SETTING_USERNS;\n                        break;\n\n                case ARG_KILL_SIGNAL:\n                        if (streq(optarg, \"help\")) {\n                                DUMP_STRING_TABLE(signal, int, _NSIG);\n                                return 0;\n                        }\n\n                        arg_kill_signal = signal_from_string(optarg);\n                        if (arg_kill_signal < 0) {\n                                log_error(\"Cannot parse signal: %s\", optarg);\n                                return -EINVAL;\n                        }\n\n                        arg_settings_mask |= SETTING_KILL_SIGNAL;\n                        break;\n\n                case ARG_SETTINGS:\n\n                        /* no               \u2192 do not read files\n                         * yes              \u2192 read files, do not override cmdline, trust only subset\n                         * override         \u2192 read files, override cmdline, trust only subset\n                         * trusted          \u2192 read files, do not override cmdline, trust all\n                         */\n\n                        r = parse_boolean(optarg);\n                        if (r < 0) {\n                                if (streq(optarg, \"trusted\")) {\n                                        mask_all_settings = false;\n                                        mask_no_settings = false;\n                                        arg_settings_trusted = true;\n\n                                } else if (streq(optarg, \"override\")) {\n                                        mask_all_settings = false;\n                                        mask_no_settings = true;\n                                        arg_settings_trusted = -1;\n                                } else\n                                        return log_error_errno(r, \"Failed to parse --settings= argument: %s\", optarg);\n                        } else if (r > 0) {\n                                /* yes */\n                                mask_all_settings = false;\n                                mask_no_settings = false;\n                                arg_settings_trusted = -1;\n                        } else {\n                                /* no */\n                                mask_all_settings = true;\n                                mask_no_settings = false;\n                                arg_settings_trusted = false;\n                        }\n\n                        break;\n\n                case ARG_CHDIR:\n                        if (!path_is_absolute(optarg)) {\n                                log_error(\"Working directory %s is not an absolute path.\", optarg);\n                                return -EINVAL;\n                        }\n\n                        r = free_and_strdup(&arg_chdir, optarg);\n                        if (r < 0)\n                                return log_oom();\n\n                        arg_settings_mask |= SETTING_WORKING_DIRECTORY;\n                        break;\n\n                case ARG_PIVOT_ROOT:\n                        r = pivot_root_parse(&arg_pivot_root_new, &arg_pivot_root_old, optarg);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to parse --pivot-root= argument %s: %m\", optarg);\n\n                        arg_settings_mask |= SETTING_PIVOT_ROOT;\n                        break;\n\n                case ARG_NOTIFY_READY:\n                        r = parse_boolean(optarg);\n                        if (r < 0) {\n                                log_error(\"%s is not a valid notify mode. Valid modes are: yes, no, and ready.\", optarg);\n                                return -EINVAL;\n                        }\n                        arg_notify_ready = r;\n                        arg_settings_mask |= SETTING_NOTIFY_READY;\n                        break;\n\n                case ARG_ROOT_HASH: {\n                        void *k;\n                        size_t l;\n\n                        r = unhexmem(optarg, strlen(optarg), &k, &l);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to parse root hash: %s\", optarg);\n                        if (l < sizeof(sd_id128_t)) {\n                                log_error(\"Root hash must be at least 128bit long: %s\", optarg);\n                                free(k);\n                                return -EINVAL;\n                        }\n\n                        free(arg_root_hash);\n                        arg_root_hash = k;\n                        arg_root_hash_size = l;\n                        break;\n                }\n\n                case ARG_SYSTEM_CALL_FILTER: {\n                        bool negative;\n                        const char *items;\n\n                        negative = optarg[0] == '~';\n                        items = negative ? optarg + 1 : optarg;\n\n                        for (;;) {\n                                _cleanup_free_ char *word = NULL;\n\n                                r = extract_first_word(&items, &word, NULL, 0);\n                                if (r == 0)\n                                        break;\n                                if (r == -ENOMEM)\n                                        return log_oom();\n                                if (r < 0)\n                                        return log_error_errno(r, \"Failed to parse system call filter: %m\");\n\n                                if (negative)\n                                        r = strv_extend(&arg_syscall_blacklist, word);\n                                else\n                                        r = strv_extend(&arg_syscall_whitelist, word);\n                                if (r < 0)\n                                        return log_oom();\n                        }\n\n                        arg_settings_mask |= SETTING_SYSCALL_FILTER;\n                        break;\n                }\n\n                case ARG_RLIMIT: {\n                        const char *eq;\n                        char *name;\n                        int rl;\n\n                        if (streq(optarg, \"help\")) {\n                                DUMP_STRING_TABLE(rlimit, int, _RLIMIT_MAX);\n                                return 0;\n                        }\n\n                        eq = strchr(optarg, '=');\n                        if (!eq) {\n                                log_error(\"--rlimit= expects an '=' assignment.\");\n                                return -EINVAL;\n                        }\n\n                        name = strndup(optarg, eq - optarg);\n                        if (!name)\n                                return log_oom();\n\n                        rl = rlimit_from_string_harder(name);\n                        if (rl < 0) {\n                                log_error(\"Unknown resource limit: %s\", name);\n                                return -EINVAL;\n                        }\n\n                        if (!arg_rlimit[rl]) {\n                                arg_rlimit[rl] = new0(struct rlimit, 1);\n                                if (!arg_rlimit[rl])\n                                        return log_oom();\n                        }\n\n                        r = rlimit_parse(rl, eq + 1, arg_rlimit[rl]);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to parse resource limit: %s\", eq + 1);\n\n                        arg_settings_mask |= SETTING_RLIMIT_FIRST << rl;\n                        break;\n                }\n\n                case ARG_OOM_SCORE_ADJUST:\n                        r = parse_oom_score_adjust(optarg, &arg_oom_score_adjust);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to parse --oom-score-adjust= parameter: %s\", optarg);\n\n                        arg_oom_score_adjust_set = true;\n                        arg_settings_mask |= SETTING_OOM_SCORE_ADJUST;\n                        break;\n\n                case ARG_CPU_AFFINITY: {\n                        _cleanup_cpu_free_ cpu_set_t *cpuset = NULL;\n\n                        r = parse_cpu_set(optarg, &cpuset);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to parse CPU affinity mask: %s\", optarg);\n\n                        if (arg_cpuset)\n                                CPU_FREE(arg_cpuset);\n\n                        arg_cpuset = TAKE_PTR(cpuset);\n                        arg_cpuset_ncpus = r;\n                        arg_settings_mask |= SETTING_CPU_AFFINITY;\n                        break;\n                }\n\n                case ARG_RESOLV_CONF:\n                        if (streq(optarg, \"help\")) {\n                                DUMP_STRING_TABLE(resolv_conf_mode, ResolvConfMode, _RESOLV_CONF_MODE_MAX);\n                                return 0;\n                        }\n\n                        arg_resolv_conf = resolv_conf_mode_from_string(optarg);\n                        if (arg_resolv_conf < 0) {\n                                log_error(\"Failed to parse /etc/resolv.conf mode: %s\", optarg);\n                                return -EINVAL;\n                        }\n\n                        arg_settings_mask |= SETTING_RESOLV_CONF;\n                        break;\n\n                case ARG_TIMEZONE:\n                        if (streq(optarg, \"help\")) {\n                                DUMP_STRING_TABLE(timezone_mode, TimezoneMode, _TIMEZONE_MODE_MAX);\n                                return 0;\n                        }\n\n                        arg_timezone = timezone_mode_from_string(optarg);\n                        if (arg_timezone < 0) {\n                                log_error(\"Failed to parse /etc/localtime mode: %s\", optarg);\n                                return -EINVAL;\n                        }\n\n                        arg_settings_mask |= SETTING_TIMEZONE;\n                        break;\n\n                case '?':\n                        return -EINVAL;\n\n                default:\n                        assert_not_reached(\"Unhandled option\");\n                }\n\n        /* If --network-namespace-path is given with any other network-related option,\n         * we need to error out, to avoid conflicts between different network options. */\n        if (arg_network_namespace_path &&\n                (arg_network_interfaces || arg_network_macvlan ||\n                 arg_network_ipvlan || arg_network_veth_extra ||\n                 arg_network_bridge || arg_network_zone ||\n                 arg_network_veth || arg_private_network)) {\n                log_error(\"--network-namespace-path cannot be combined with other network options.\");\n                return -EINVAL;\n        }\n\n        parse_share_ns_env(\"SYSTEMD_NSPAWN_SHARE_NS_IPC\", CLONE_NEWIPC);\n        parse_share_ns_env(\"SYSTEMD_NSPAWN_SHARE_NS_PID\", CLONE_NEWPID);\n        parse_share_ns_env(\"SYSTEMD_NSPAWN_SHARE_NS_UTS\", CLONE_NEWUTS);\n        parse_share_ns_env(\"SYSTEMD_NSPAWN_SHARE_SYSTEM\", CLONE_NEWIPC|CLONE_NEWPID|CLONE_NEWUTS);\n\n        if (arg_userns_mode != USER_NAMESPACE_NO)\n                arg_mount_settings |= MOUNT_USE_USERNS;\n\n        if (arg_private_network)\n                arg_mount_settings |= MOUNT_APPLY_APIVFS_NETNS;\n\n        parse_mount_settings_env();\n\n        if (!(arg_clone_ns_flags & CLONE_NEWPID) ||\n            !(arg_clone_ns_flags & CLONE_NEWUTS)) {\n                arg_register = false;\n                if (arg_start_mode != START_PID1) {\n                        log_error(\"--boot cannot be used without namespacing.\");\n                        return -EINVAL;\n                }\n        }\n\n        if (arg_userns_mode == USER_NAMESPACE_PICK)\n                arg_userns_chown = true;\n\n        if (arg_keep_unit && arg_register && cg_pid_get_owner_uid(0, NULL) >= 0) {\n                /* Save the user from accidentally registering either user-$SESSION.scope or user@.service.\n                 * The latter is not technically a user session, but we don't need to labour the point. */\n                log_error(\"--keep-unit --register=yes may not be used when invoked from a user session.\");\n                return -EINVAL;\n        }\n\n        if (arg_directory && arg_image) {\n                log_error(\"--directory= and --image= may not be combined.\");\n                return -EINVAL;\n        }\n\n        if (arg_template && arg_image) {\n                log_error(\"--template= and --image= may not be combined.\");\n                return -EINVAL;\n        }\n\n        if (arg_ephemeral && arg_template && !arg_directory) {\n                /* User asked for ephemeral execution but specified --template= instead of --directory=. Semantically\n                 * such an invocation makes some sense, see https://github.com/systemd/systemd/issues/3667. Let's\n                 * accept this here, and silently make \"--ephemeral --template=\" equivalent to \"--ephemeral\n                 * --directory=\". */\n\n                arg_directory = TAKE_PTR(arg_template);\n        }\n\n        if (arg_template && !(arg_directory || arg_machine)) {\n                log_error(\"--template= needs --directory= or --machine=.\");\n                return -EINVAL;\n        }\n\n        if (arg_ephemeral && arg_template) {\n                log_error(\"--ephemeral and --template= may not be combined.\");\n                return -EINVAL;\n        }\n\n        if (arg_ephemeral && !IN_SET(arg_link_journal, LINK_NO, LINK_AUTO)) {\n                log_error(\"--ephemeral and --link-journal= may not be combined.\");\n                return -EINVAL;\n        }\n\n        if (arg_userns_mode != USER_NAMESPACE_NO && !userns_supported()) {\n                log_error(\"--private-users= is not supported, kernel compiled without user namespace support.\");\n                return -EOPNOTSUPP;\n        }\n\n        if (arg_userns_chown && arg_read_only) {\n                log_error(\"--read-only and --private-users-chown may not be combined.\");\n                return -EINVAL;\n        }\n\n        if (arg_network_bridge && arg_network_zone) {\n                log_error(\"--network-bridge= and --network-zone= may not be combined.\");\n                return -EINVAL;\n        }\n\n        if (argc > optind) {\n                arg_parameters = strv_copy(argv + optind);\n                if (!arg_parameters)\n                        return log_oom();\n\n                arg_settings_mask |= SETTING_START_MODE;\n        }\n\n        /* Load all settings from .nspawn files */\n        if (mask_no_settings)\n                arg_settings_mask = 0;\n\n        /* Don't load any settings from .nspawn files */\n        if (mask_all_settings)\n                arg_settings_mask = _SETTINGS_MASK_ALL;\n\n        arg_caps_retain = (arg_caps_retain | plus | (arg_private_network ? 1ULL << CAP_NET_ADMIN : 0)) & ~minus;\n\n        r = cg_unified_flush();\n        if (r < 0)\n                return log_error_errno(r, \"Failed to determine whether the unified cgroups hierarchy is used: %m\");\n\n        e = getenv(\"SYSTEMD_NSPAWN_CONTAINER_SERVICE\");\n        if (e)\n                arg_container_service_name = e;\n\n        r = getenv_bool(\"SYSTEMD_NSPAWN_USE_CGNS\");\n        if (r < 0)\n                arg_use_cgns = cg_ns_supported();\n        else\n                arg_use_cgns = r;\n\n        r = custom_mount_check_all();\n        if (r < 0)\n                return r;\n\n        return 1;\n}\n\nstatic int verify_arguments(void) {\n        if (arg_userns_mode != USER_NAMESPACE_NO && (arg_mount_settings & MOUNT_APPLY_APIVFS_NETNS) && !arg_private_network) {\n                log_error(\"Invalid namespacing settings. Mounting sysfs with --private-users requires --private-network.\");\n                return -EINVAL;\n        }\n\n        if (arg_userns_mode != USER_NAMESPACE_NO && !(arg_mount_settings & MOUNT_APPLY_APIVFS_RO)) {\n                log_error(\"Cannot combine --private-users with read-write mounts.\");\n                return -EINVAL;\n        }\n\n        if (arg_volatile_mode != VOLATILE_NO && arg_read_only) {\n                log_error(\"Cannot combine --read-only with --volatile. Note that --volatile already implies a read-only base hierarchy.\");\n                return -EINVAL;\n        }\n\n        if (arg_expose_ports && !arg_private_network) {\n                log_error(\"Cannot use --port= without private networking.\");\n                return -EINVAL;\n        }\n\n#if ! HAVE_LIBIPTC\n        if (arg_expose_ports) {\n                log_error(\"--port= is not supported, compiled without libiptc support.\");\n                return -EOPNOTSUPP;\n        }\n#endif\n\n        if (arg_start_mode == START_BOOT && arg_kill_signal <= 0)\n                arg_kill_signal = SIGRTMIN+3;\n\n        return 0;\n}\n\nstatic int userns_lchown(const char *p, uid_t uid, gid_t gid) {\n        assert(p);\n\n        if (arg_userns_mode == USER_NAMESPACE_NO)\n                return 0;\n\n        if (uid == UID_INVALID && gid == GID_INVALID)\n                return 0;\n\n        if (uid != UID_INVALID) {\n                uid += arg_uid_shift;\n\n                if (uid < arg_uid_shift || uid >= arg_uid_shift + arg_uid_range)\n                        return -EOVERFLOW;\n        }\n\n        if (gid != GID_INVALID) {\n                gid += (gid_t) arg_uid_shift;\n\n                if (gid < (gid_t) arg_uid_shift || gid >= (gid_t) (arg_uid_shift + arg_uid_range))\n                        return -EOVERFLOW;\n        }\n\n        if (lchown(p, uid, gid) < 0)\n                return -errno;\n\n        return 0;\n}\n\nstatic int userns_mkdir(const char *root, const char *path, mode_t mode, uid_t uid, gid_t gid) {\n        const char *q;\n        int r;\n\n        q = prefix_roota(root, path);\n        r = mkdir_errno_wrapper(q, mode);\n        if (r == -EEXIST)\n                return 0;\n        if (r < 0)\n                return r;\n\n        return userns_lchown(q, uid, gid);\n}\n\nstatic const char *timezone_from_path(const char *path) {\n        const char *z;\n\n        z = path_startswith(path, \"../usr/share/zoneinfo/\");\n        if (z)\n                return z;\n\n        z = path_startswith(path, \"/usr/share/zoneinfo/\");\n        if (z)\n                return z;\n\n        return NULL;\n}\n\nstatic int setup_timezone(const char *dest) {\n        _cleanup_free_ char *p = NULL, *etc = NULL;\n        const char *where, *check;\n        TimezoneMode m;\n        int r;\n\n        assert(dest);\n\n        if (IN_SET(arg_timezone, TIMEZONE_AUTO, TIMEZONE_SYMLINK)) {\n                r = readlink_malloc(\"/etc/localtime\", &p);\n                if (r == -ENOENT && arg_timezone == TIMEZONE_AUTO)\n                        m = arg_read_only && arg_volatile_mode != VOLATILE_YES ? TIMEZONE_OFF : TIMEZONE_DELETE;\n                else if (r == -EINVAL && arg_timezone == TIMEZONE_AUTO) /* regular file? */\n                        m = arg_read_only && arg_volatile_mode != VOLATILE_YES ? TIMEZONE_BIND : TIMEZONE_COPY;\n                else if (r < 0) {\n                        log_warning_errno(r, \"Failed to read host's /etc/localtime symlink, not updating container timezone: %m\");\n                        /* To handle warning, delete /etc/localtime and replace it with a symbolic link to a time zone data\n                         * file.\n                         *\n                         * Example:\n                         * ln -s /usr/share/zoneinfo/UTC /etc/localtime\n                         */\n                        return 0;\n                } else if (arg_timezone == TIMEZONE_AUTO)\n                        m = arg_read_only && arg_volatile_mode != VOLATILE_YES ? TIMEZONE_BIND : TIMEZONE_SYMLINK;\n                else\n                        m = arg_timezone;\n        } else\n                m = arg_timezone;\n\n        if (m == TIMEZONE_OFF)\n                return 0;\n\n        r = chase_symlinks(\"/etc\", dest, CHASE_PREFIX_ROOT, &etc);\n        if (r < 0) {\n                log_warning_errno(r, \"Failed to resolve /etc path in container, ignoring: %m\");\n                return 0;\n        }\n\n        where = strjoina(etc, \"/localtime\");\n\n        switch (m) {\n\n        case TIMEZONE_DELETE:\n                if (unlink(where) < 0)\n                        log_full_errno(errno == ENOENT ? LOG_DEBUG : LOG_WARNING, errno, \"Failed to remove '%s', ignoring: %m\", where);\n\n                return 0;\n\n        case TIMEZONE_SYMLINK: {\n                _cleanup_free_ char *q = NULL;\n                const char *z, *what;\n\n                z = timezone_from_path(p);\n                if (!z) {\n                        log_warning(\"/etc/localtime does not point into /usr/share/zoneinfo/, not updating container timezone.\");\n                        return 0;\n                }\n\n                r = readlink_malloc(where, &q);\n                if (r >= 0 && streq_ptr(timezone_from_path(q), z))\n                        return 0; /* Already pointing to the right place? Then do nothing .. */\n\n                check = strjoina(dest, \"/usr/share/zoneinfo/\", z);\n                r = chase_symlinks(check, dest, 0, NULL);\n                if (r < 0)\n                        log_debug_errno(r, \"Timezone %s does not exist (or is not accessible) in container, not creating symlink: %m\", z);\n                else {\n                        if (unlink(where) < 0 && errno != ENOENT) {\n                                log_full_errno(IN_SET(errno, EROFS, EACCES, EPERM) ? LOG_DEBUG : LOG_WARNING, /* Don't complain on read-only images */\n                                               errno, \"Failed to remove existing timezone info %s in container, ignoring: %m\", where);\n                                return 0;\n                        }\n\n                        what = strjoina(\"../usr/share/zoneinfo/\", z);\n                        if (symlink(what, where) < 0) {\n                                log_full_errno(IN_SET(errno, EROFS, EACCES, EPERM) ? LOG_DEBUG : LOG_WARNING,\n                                               errno, \"Failed to correct timezone of container, ignoring: %m\");\n                                return 0;\n                        }\n\n                        break;\n                }\n\n                _fallthrough_;\n        }\n\n        case TIMEZONE_BIND: {\n                _cleanup_free_ char *resolved = NULL;\n                int found;\n\n                found = chase_symlinks(where, dest, CHASE_NONEXISTENT, &resolved);\n                if (found < 0) {\n                        log_warning_errno(found, \"Failed to resolve /etc/localtime path in container, ignoring: %m\");\n                        return 0;\n                }\n\n                if (found == 0) /* missing? */\n                        (void) touch(resolved);\n\n                r = mount_verbose(LOG_WARNING, \"/etc/localtime\", resolved, NULL, MS_BIND, NULL);\n                if (r >= 0)\n                        return mount_verbose(LOG_ERR, NULL, resolved, NULL, MS_BIND|MS_REMOUNT|MS_RDONLY|MS_NOSUID|MS_NODEV, NULL);\n\n                _fallthrough_;\n        }\n\n        case TIMEZONE_COPY:\n                /* If mounting failed, try to copy */\n                r = copy_file_atomic(\"/etc/localtime\", where, 0644, 0, COPY_REFLINK|COPY_REPLACE);\n                if (r < 0) {\n                        log_full_errno(IN_SET(r, -EROFS, -EACCES, -EPERM) ? LOG_DEBUG : LOG_WARNING, r,\n                                       \"Failed to copy /etc/localtime to %s, ignoring: %m\", where);\n                        return 0;\n                }\n\n                break;\n\n        default:\n                assert_not_reached(\"unexpected mode\");\n        }\n\n        /* Fix permissions of the symlink or file copy we just created */\n        r = userns_lchown(where, 0, 0);\n        if (r < 0)\n                log_warning_errno(r, \"Failed to chown /etc/localtime, ignoring: %m\");\n\n        return 0;\n}\n\nstatic int have_resolv_conf(const char *path) {\n        assert(path);\n\n        if (access(path, F_OK) < 0) {\n                if (errno == ENOENT)\n                        return 0;\n\n                return log_debug_errno(errno, \"Failed to determine whether '%s' is available: %m\", path);\n        }\n\n        return 1;\n}\n\nstatic int resolved_listening(void) {\n        _cleanup_(sd_bus_error_free) sd_bus_error error = SD_BUS_ERROR_NULL;\n        _cleanup_(sd_bus_flush_close_unrefp) sd_bus *bus = NULL;\n        _cleanup_free_ char *dns_stub_listener_mode = NULL;\n        int r;\n\n        /* Check if resolved is listening */\n\n        r = sd_bus_open_system(&bus);\n        if (r < 0)\n                return log_debug_errno(r, \"Failed to open system bus: %m\");\n\n        r = bus_name_has_owner(bus, \"org.freedesktop.resolve1\", NULL);\n        if (r < 0)\n                return log_debug_errno(r, \"Failed to check whether the 'org.freedesktop.resolve1' bus name is taken: %m\");\n        if (r == 0)\n                return 0;\n\n        r = sd_bus_get_property_string(bus,\n                                       \"org.freedesktop.resolve1\",\n                                       \"/org/freedesktop/resolve1\",\n                                       \"org.freedesktop.resolve1.Manager\",\n                                       \"DNSStubListener\",\n                                       &error,\n                                       &dns_stub_listener_mode);\n        if (r < 0)\n                return log_debug_errno(r, \"Failed to query DNSStubListener property: %s\", bus_error_message(&error, r));\n\n        return STR_IN_SET(dns_stub_listener_mode, \"udp\", \"yes\");\n}\n\nstatic int setup_resolv_conf(const char *dest) {\n        _cleanup_free_ char *etc = NULL;\n        const char *where, *what;\n        ResolvConfMode m;\n        int r;\n\n        assert(dest);\n\n        if (arg_resolv_conf == RESOLV_CONF_AUTO) {\n                if (arg_private_network)\n                        m = RESOLV_CONF_OFF;\n                else if (have_resolv_conf(STATIC_RESOLV_CONF) > 0 && resolved_listening() > 0)\n                        /* resolved is enabled on the host. In this, case bind mount its static resolv.conf file into the\n                         * container, so that the container can use the host's resolver. Given that network namespacing is\n                         * disabled it's only natural of the container also uses the host's resolver. It also has the big\n                         * advantage that the container will be able to follow the host's DNS server configuration changes\n                         * transparently. */\n                        m = RESOLV_CONF_BIND_STATIC;\n                else if (have_resolv_conf(\"/etc/resolv.conf\") > 0)\n                        m = arg_read_only && arg_volatile_mode != VOLATILE_YES ? RESOLV_CONF_BIND_HOST : RESOLV_CONF_COPY_HOST;\n                else\n                        m = arg_read_only && arg_volatile_mode != VOLATILE_YES ? RESOLV_CONF_OFF : RESOLV_CONF_DELETE;\n        } else\n                m = arg_resolv_conf;\n\n        if (m == RESOLV_CONF_OFF)\n                return 0;\n\n        r = chase_symlinks(\"/etc\", dest, CHASE_PREFIX_ROOT, &etc);\n        if (r < 0) {\n                log_warning_errno(r, \"Failed to resolve /etc path in container, ignoring: %m\");\n                return 0;\n        }\n\n        where = strjoina(etc, \"/resolv.conf\");\n\n        if (m == RESOLV_CONF_DELETE) {\n                if (unlink(where) < 0)\n                        log_full_errno(errno == ENOENT ? LOG_DEBUG : LOG_WARNING, errno, \"Failed to remove '%s', ignoring: %m\", where);\n\n                return 0;\n        }\n\n        if (IN_SET(m, RESOLV_CONF_BIND_STATIC, RESOLV_CONF_COPY_STATIC))\n                what = STATIC_RESOLV_CONF;\n        else\n                what = \"/etc/resolv.conf\";\n\n        if (IN_SET(m, RESOLV_CONF_BIND_HOST, RESOLV_CONF_BIND_STATIC)) {\n                _cleanup_free_ char *resolved = NULL;\n                int found;\n\n                found = chase_symlinks(where, dest, CHASE_NONEXISTENT, &resolved);\n                if (found < 0) {\n                        log_warning_errno(found, \"Failed to resolve /etc/resolv.conf path in container, ignoring: %m\");\n                        return 0;\n                }\n\n                if (found == 0) /* missing? */\n                        (void) touch(resolved);\n\n                r = mount_verbose(LOG_WARNING, what, resolved, NULL, MS_BIND, NULL);\n                if (r >= 0)\n                        return mount_verbose(LOG_ERR, NULL, resolved, NULL, MS_BIND|MS_REMOUNT|MS_RDONLY|MS_NOSUID|MS_NODEV, NULL);\n        }\n\n        /* If that didn't work, let's copy the file */\n        r = copy_file(what, where, O_TRUNC|O_NOFOLLOW, 0644, 0, COPY_REFLINK);\n        if (r < 0) {\n                /* If the file already exists as symlink, let's suppress the warning, under the assumption that\n                 * resolved or something similar runs inside and the symlink points there.\n                 *\n                 * If the disk image is read-only, there's also no point in complaining.\n                 */\n                log_full_errno(!IN_SET(RESOLV_CONF_COPY_HOST, RESOLV_CONF_COPY_STATIC) && IN_SET(r, -ELOOP, -EROFS, -EACCES, -EPERM) ? LOG_DEBUG : LOG_WARNING, r,\n                               \"Failed to copy /etc/resolv.conf to %s, ignoring: %m\", where);\n                return 0;\n        }\n\n        r = userns_lchown(where, 0, 0);\n        if (r < 0)\n                log_warning_errno(r, \"Failed to chown /etc/resolv.conf, ignoring: %m\");\n\n        return 0;\n}\n\nstatic int setup_boot_id(void) {\n        _cleanup_(unlink_and_freep) char *from = NULL;\n        _cleanup_free_ char *path = NULL;\n        sd_id128_t rnd = SD_ID128_NULL;\n        const char *to;\n        int r;\n\n        /* Generate a new randomized boot ID, so that each boot-up of\n         * the container gets a new one */\n\n        r = tempfn_random_child(NULL, \"proc-sys-kernel-random-boot-id\", &path);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to generate random boot ID path: %m\");\n\n        r = sd_id128_randomize(&rnd);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to generate random boot id: %m\");\n\n        r = id128_write(path, ID128_UUID, rnd, false);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to write boot id: %m\");\n\n        from = TAKE_PTR(path);\n        to = \"/proc/sys/kernel/random/boot_id\";\n\n        r = mount_verbose(LOG_ERR, from, to, NULL, MS_BIND, NULL);\n        if (r < 0)\n                return r;\n\n        return mount_verbose(LOG_ERR, NULL, to, NULL, MS_BIND|MS_REMOUNT|MS_RDONLY|MS_NOSUID|MS_NOEXEC|MS_NODEV, NULL);\n}\n\nstatic int copy_devnodes(const char *dest) {\n        static const char devnodes[] =\n                \"null\\0\"\n                \"zero\\0\"\n                \"full\\0\"\n                \"random\\0\"\n                \"urandom\\0\"\n                \"tty\\0\"\n                \"net/tun\\0\";\n\n        const char *d;\n        int r = 0;\n        _cleanup_umask_ mode_t u;\n\n        assert(dest);\n\n        u = umask(0000);\n\n        /* Create /dev/net, so that we can create /dev/net/tun in it */\n        if (userns_mkdir(dest, \"/dev/net\", 0755, 0, 0) < 0)\n                return log_error_errno(r, \"Failed to create /dev/net directory: %m\");\n\n        NULSTR_FOREACH(d, devnodes) {\n                _cleanup_free_ char *from = NULL, *to = NULL;\n                struct stat st;\n\n                from = strappend(\"/dev/\", d);\n                to = prefix_root(dest, from);\n\n                if (stat(from, &st) < 0) {\n\n                        if (errno != ENOENT)\n                                return log_error_errno(errno, \"Failed to stat %s: %m\", from);\n\n                } else if (!S_ISCHR(st.st_mode) && !S_ISBLK(st.st_mode)) {\n\n                        log_error(\"%s is not a char or block device, cannot copy.\", from);\n                        return -EIO;\n\n                } else {\n                        if (mknod(to, st.st_mode, st.st_rdev) < 0) {\n                                /* Explicitly warn the user when /dev is already populated. */\n                                if (errno == EEXIST)\n                                        log_notice(\"%s/dev is pre-mounted and pre-populated. If a pre-mounted /dev is provided it needs to be an unpopulated file system.\", dest);\n                                if (errno != EPERM)\n                                        return log_error_errno(errno, \"mknod(%s) failed: %m\", to);\n\n                                /* Some systems abusively restrict mknod but\n                                 * allow bind mounts. */\n                                r = touch(to);\n                                if (r < 0)\n                                        return log_error_errno(r, \"touch (%s) failed: %m\", to);\n                                r = mount_verbose(LOG_DEBUG, from, to, NULL, MS_BIND, NULL);\n                                if (r < 0)\n                                        return log_error_errno(r, \"Both mknod and bind mount (%s) failed: %m\", to);\n                        }\n\n                        r = userns_lchown(to, 0, 0);\n                        if (r < 0)\n                                return log_error_errno(r, \"chown() of device node %s failed: %m\", to);\n                }\n        }\n\n        return r;\n}\n\nstatic int setup_pts(const char *dest) {\n        _cleanup_free_ char *options = NULL;\n        const char *p;\n        int r;\n\n#if HAVE_SELINUX\n        if (arg_selinux_apifs_context)\n                (void) asprintf(&options,\n                                \"newinstance,ptmxmode=0666,mode=620,gid=\" GID_FMT \",context=\\\"%s\\\"\",\n                                arg_uid_shift + TTY_GID,\n                                arg_selinux_apifs_context);\n        else\n#endif\n                (void) asprintf(&options,\n                                \"newinstance,ptmxmode=0666,mode=620,gid=\" GID_FMT,\n                                arg_uid_shift + TTY_GID);\n\n        if (!options)\n                return log_oom();\n\n        /* Mount /dev/pts itself */\n        p = prefix_roota(dest, \"/dev/pts\");\n        r = mkdir_errno_wrapper(p, 0755);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to create /dev/pts: %m\");\n\n        r = mount_verbose(LOG_ERR, \"devpts\", p, \"devpts\", MS_NOSUID|MS_NOEXEC, options);\n        if (r < 0)\n                return r;\n        r = userns_lchown(p, 0, 0);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to chown /dev/pts: %m\");\n\n        /* Create /dev/ptmx symlink */\n        p = prefix_roota(dest, \"/dev/ptmx\");\n        if (symlink(\"pts/ptmx\", p) < 0)\n                return log_error_errno(errno, \"Failed to create /dev/ptmx symlink: %m\");\n        r = userns_lchown(p, 0, 0);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to chown /dev/ptmx: %m\");\n\n        /* And fix /dev/pts/ptmx ownership */\n        p = prefix_roota(dest, \"/dev/pts/ptmx\");\n        r = userns_lchown(p, 0, 0);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to chown /dev/pts/ptmx: %m\");\n\n        return 0;\n}\n\nstatic int setup_dev_console(const char *dest, const char *console) {\n        _cleanup_umask_ mode_t u;\n        const char *to;\n        int r;\n\n        assert(dest);\n        assert(console);\n\n        u = umask(0000);\n\n        r = chmod_and_chown(console, 0600, arg_uid_shift, arg_uid_shift);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to correct access mode for TTY: %m\");\n\n        /* We need to bind mount the right tty to /dev/console since\n         * ptys can only exist on pts file systems. To have something\n         * to bind mount things on we create a empty regular file. */\n\n        to = prefix_roota(dest, \"/dev/console\");\n        r = touch(to);\n        if (r < 0)\n                return log_error_errno(r, \"touch() for /dev/console failed: %m\");\n\n        return mount_verbose(LOG_ERR, console, to, NULL, MS_BIND, NULL);\n}\n\nstatic int setup_keyring(void) {\n        key_serial_t keyring;\n\n        /* Allocate a new session keyring for the container. This makes sure the keyring of the session systemd-nspawn\n         * was invoked from doesn't leak into the container. Note that by default we block keyctl() and request_key()\n         * anyway via seccomp so doing this operation isn't strictly necessary, but in case people explicitly whitelist\n         * these system calls let's make sure we don't leak anything into the container. */\n\n        keyring = keyctl(KEYCTL_JOIN_SESSION_KEYRING, 0, 0, 0, 0);\n        if (keyring == -1) {\n                if (errno == ENOSYS)\n                        log_debug_errno(errno, \"Kernel keyring not supported, ignoring.\");\n                else if (IN_SET(errno, EACCES, EPERM))\n                        log_debug_errno(errno, \"Kernel keyring access prohibited, ignoring.\");\n                else\n                        return log_error_errno(errno, \"Setting up kernel keyring failed: %m\");\n        }\n\n        return 0;\n}\n\nstatic int setup_kmsg(int kmsg_socket) {\n        _cleanup_(unlink_and_freep) char *from = NULL;\n        _cleanup_free_ char *fifo = NULL;\n        _cleanup_close_ int fd = -1;\n        _cleanup_umask_ mode_t u;\n        const char *to;\n        int r;\n\n        assert(kmsg_socket >= 0);\n\n        u = umask(0000);\n\n        /* We create the kmsg FIFO as as temporary file in /tmp, but immediately delete it after bind mounting it to\n         * /proc/kmsg. While FIFOs on the reading side behave very similar to /proc/kmsg, their writing side behaves\n         * differently from /dev/kmsg in that writing blocks when nothing is reading. In order to avoid any problems\n         * with containers deadlocking due to this we simply make /dev/kmsg unavailable to the container. */\n\n        r = tempfn_random_child(NULL, \"proc-kmsg\", &fifo);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to generate kmsg path: %m\");\n\n        if (mkfifo(fifo, 0600) < 0)\n                return log_error_errno(errno, \"mkfifo() for /run/kmsg failed: %m\");\n\n        from = TAKE_PTR(fifo);\n        to = \"/proc/kmsg\";\n\n        r = mount_verbose(LOG_ERR, from, to, NULL, MS_BIND, NULL);\n        if (r < 0)\n                return r;\n\n        fd = open(from, O_RDWR|O_NONBLOCK|O_CLOEXEC);\n        if (fd < 0)\n                return log_error_errno(errno, \"Failed to open fifo: %m\");\n\n        /* Store away the fd in the socket, so that it stays open as long as we run the child */\n        r = send_one_fd(kmsg_socket, fd, 0);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to send FIFO fd: %m\");\n\n        return 0;\n}\n\nstatic int on_address_change(sd_netlink *rtnl, sd_netlink_message *m, void *userdata) {\n        union in_addr_union *exposed = userdata;\n\n        assert(rtnl);\n        assert(m);\n        assert(exposed);\n\n        expose_port_execute(rtnl, arg_expose_ports, exposed);\n        return 0;\n}\n\nstatic int setup_hostname(void) {\n        int r;\n\n        if ((arg_clone_ns_flags & CLONE_NEWUTS) == 0)\n                return 0;\n\n        r = sethostname_idempotent(arg_hostname ?: arg_machine);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to set hostname: %m\");\n\n        return 0;\n}\n\nstatic int setup_journal(const char *directory) {\n        sd_id128_t this_id;\n        _cleanup_free_ char *d = NULL;\n        const char *p, *q;\n        bool try;\n        char id[33];\n        int r;\n\n        /* Don't link journals in ephemeral mode */\n        if (arg_ephemeral)\n                return 0;\n\n        if (arg_link_journal == LINK_NO)\n                return 0;\n\n        try = arg_link_journal_try || arg_link_journal == LINK_AUTO;\n\n        r = sd_id128_get_machine(&this_id);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to retrieve machine ID: %m\");\n\n        if (sd_id128_equal(arg_uuid, this_id)) {\n                log_full(try ? LOG_WARNING : LOG_ERR,\n                         \"Host and machine ids are equal (%s): refusing to link journals\", sd_id128_to_string(arg_uuid, id));\n                if (try)\n                        return 0;\n                return -EEXIST;\n        }\n\n        r = userns_mkdir(directory, \"/var\", 0755, 0, 0);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to create /var: %m\");\n\n        r = userns_mkdir(directory, \"/var/log\", 0755, 0, 0);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to create /var/log: %m\");\n\n        r = userns_mkdir(directory, \"/var/log/journal\", 0755, 0, 0);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to create /var/log/journal: %m\");\n\n        (void) sd_id128_to_string(arg_uuid, id);\n\n        p = strjoina(\"/var/log/journal/\", id);\n        q = prefix_roota(directory, p);\n\n        if (path_is_mount_point(p, NULL, 0) > 0) {\n                if (try)\n                        return 0;\n\n                log_error(\"%s: already a mount point, refusing to use for journal\", p);\n                return -EEXIST;\n        }\n\n        if (path_is_mount_point(q, NULL, 0) > 0) {\n                if (try)\n                        return 0;\n\n                log_error(\"%s: already a mount point, refusing to use for journal\", q);\n                return -EEXIST;\n        }\n\n        r = readlink_and_make_absolute(p, &d);\n        if (r >= 0) {\n                if (IN_SET(arg_link_journal, LINK_GUEST, LINK_AUTO) &&\n                    path_equal(d, q)) {\n\n                        r = userns_mkdir(directory, p, 0755, 0, 0);\n                        if (r < 0)\n                                log_warning_errno(r, \"Failed to create directory %s: %m\", q);\n                        return 0;\n                }\n\n                if (unlink(p) < 0)\n                        return log_error_errno(errno, \"Failed to remove symlink %s: %m\", p);\n        } else if (r == -EINVAL) {\n\n                if (arg_link_journal == LINK_GUEST &&\n                    rmdir(p) < 0) {\n\n                        if (errno == ENOTDIR) {\n                                log_error(\"%s already exists and is neither a symlink nor a directory\", p);\n                                return r;\n                        } else\n                                return log_error_errno(errno, \"Failed to remove %s: %m\", p);\n                }\n        } else if (r != -ENOENT)\n                return log_error_errno(r, \"readlink(%s) failed: %m\", p);\n\n        if (arg_link_journal == LINK_GUEST) {\n\n                if (symlink(q, p) < 0) {\n                        if (try) {\n                                log_debug_errno(errno, \"Failed to symlink %s to %s, skipping journal setup: %m\", q, p);\n                                return 0;\n                        } else\n                                return log_error_errno(errno, \"Failed to symlink %s to %s: %m\", q, p);\n                }\n\n                r = userns_mkdir(directory, p, 0755, 0, 0);\n                if (r < 0)\n                        log_warning_errno(r, \"Failed to create directory %s: %m\", q);\n                return 0;\n        }\n\n        if (arg_link_journal == LINK_HOST) {\n                /* don't create parents here \u2014 if the host doesn't have\n                 * permanent journal set up, don't force it here */\n\n                r = mkdir_errno_wrapper(p, 0755);\n                if (r < 0 && r != -EEXIST) {\n                        if (try) {\n                                log_debug_errno(r, \"Failed to create %s, skipping journal setup: %m\", p);\n                                return 0;\n                        } else\n                                return log_error_errno(r, \"Failed to create %s: %m\", p);\n                }\n\n        } else if (access(p, F_OK) < 0)\n                return 0;\n\n        if (dir_is_empty(q) == 0)\n                log_warning(\"%s is not empty, proceeding anyway.\", q);\n\n        r = userns_mkdir(directory, p, 0755, 0, 0);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to create %s: %m\", q);\n\n        r = mount_verbose(LOG_DEBUG, p, q, NULL, MS_BIND, NULL);\n        if (r < 0)\n                return log_error_errno(errno, \"Failed to bind mount journal from host into guest: %m\");\n\n        return 0;\n}\n\nstatic int drop_capabilities(void) {\n        return capability_bounding_set_drop(arg_caps_retain, false);\n}\n\nstatic int reset_audit_loginuid(void) {\n        _cleanup_free_ char *p = NULL;\n        int r;\n\n        if ((arg_clone_ns_flags & CLONE_NEWPID) == 0)\n                return 0;\n\n        r = read_one_line_file(\"/proc/self/loginuid\", &p);\n        if (r == -ENOENT)\n                return 0;\n        if (r < 0)\n                return log_error_errno(r, \"Failed to read /proc/self/loginuid: %m\");\n\n        /* Already reset? */\n        if (streq(p, \"4294967295\"))\n                return 0;\n\n        r = write_string_file(\"/proc/self/loginuid\", \"4294967295\", 0);\n        if (r < 0) {\n                log_error_errno(r,\n                                \"Failed to reset audit login UID. This probably means that your kernel is too\\n\"\n                                \"old and you have audit enabled. Note that the auditing subsystem is known to\\n\"\n                                \"be incompatible with containers on old kernels. Please make sure to upgrade\\n\"\n                                \"your kernel or to off auditing with 'audit=0' on the kernel command line before\\n\"\n                                \"using systemd-nspawn. Sleeping for 5s... (%m)\");\n\n                sleep(5);\n        }\n\n        return 0;\n}\n\nstatic int setup_propagate(const char *root) {\n        const char *p, *q;\n        int r;\n\n        (void) mkdir_p(\"/run/systemd/nspawn/\", 0755);\n        (void) mkdir_p(\"/run/systemd/nspawn/propagate\", 0600);\n        p = strjoina(\"/run/systemd/nspawn/propagate/\", arg_machine);\n        (void) mkdir_p(p, 0600);\n\n        r = userns_mkdir(root, \"/run/systemd\", 0755, 0, 0);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to create /run/systemd: %m\");\n\n        r = userns_mkdir(root, \"/run/systemd/nspawn\", 0755, 0, 0);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to create /run/systemd/nspawn: %m\");\n\n        r = userns_mkdir(root, \"/run/systemd/nspawn/incoming\", 0600, 0, 0);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to create /run/systemd/nspawn/incoming: %m\");\n\n        q = prefix_roota(root, \"/run/systemd/nspawn/incoming\");\n        r = mount_verbose(LOG_ERR, p, q, NULL, MS_BIND, NULL);\n        if (r < 0)\n                return r;\n\n        r = mount_verbose(LOG_ERR, NULL, q, NULL, MS_BIND|MS_REMOUNT|MS_RDONLY, NULL);\n        if (r < 0)\n                return r;\n\n        /* machined will MS_MOVE into that directory, and that's only\n         * supported for non-shared mounts. */\n        return mount_verbose(LOG_ERR, NULL, q, NULL, MS_SLAVE, NULL);\n}\n\nstatic int setup_machine_id(const char *directory) {\n        const char *etc_machine_id;\n        sd_id128_t id;\n        int r;\n\n        /* If the UUID in the container is already set, then that's what counts, and we use. If it isn't set, and the\n         * caller passed --uuid=, then we'll pass it in the $container_uuid env var to PID 1 of the container. The\n         * assumption is that PID 1 will then write it to /etc/machine-id to make it persistent. If --uuid= is not\n         * passed we generate a random UUID, and pass it via $container_uuid. In effect this means that /etc/machine-id\n         * in the container and our idea of the container UUID will always be in sync (at least if PID 1 in the\n         * container behaves nicely). */\n\n        etc_machine_id = prefix_roota(directory, \"/etc/machine-id\");\n\n        r = id128_read(etc_machine_id, ID128_PLAIN, &id);\n        if (r < 0) {\n                if (!IN_SET(r, -ENOENT, -ENOMEDIUM)) /* If the file is missing or empty, we don't mind */\n                        return log_error_errno(r, \"Failed to read machine ID from container image: %m\");\n\n                if (sd_id128_is_null(arg_uuid)) {\n                        r = sd_id128_randomize(&arg_uuid);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to acquire randomized machine UUID: %m\");\n                }\n        } else {\n                if (sd_id128_is_null(id)) {\n                        log_error(\"Machine ID in container image is zero, refusing.\");\n                        return -EINVAL;\n                }\n\n                arg_uuid = id;\n        }\n\n        return 0;\n}\n\nstatic int recursive_chown(const char *directory, uid_t shift, uid_t range) {\n        int r;\n\n        assert(directory);\n\n        if (arg_userns_mode == USER_NAMESPACE_NO || !arg_userns_chown)\n                return 0;\n\n        r = path_patch_uid(directory, arg_uid_shift, arg_uid_range);\n        if (r == -EOPNOTSUPP)\n                return log_error_errno(r, \"Automatic UID/GID adjusting is only supported for UID/GID ranges starting at multiples of 2^16 with a range of 2^16.\");\n        if (r == -EBADE)\n                return log_error_errno(r, \"Upper 16 bits of root directory UID and GID do not match.\");\n        if (r < 0)\n                return log_error_errno(r, \"Failed to adjust UID/GID shift of OS tree: %m\");\n        if (r == 0)\n                log_debug(\"Root directory of image is already owned by the right UID/GID range, skipping recursive chown operation.\");\n        else\n                log_debug(\"Patched directory tree to match UID/GID range.\");\n\n        return r;\n}\n\n/*\n * Return values:\n * < 0 : wait_for_terminate() failed to get the state of the\n *       container, the container was terminated by a signal, or\n *       failed for an unknown reason.  No change is made to the\n *       container argument.\n * > 0 : The program executed in the container terminated with an\n *       error.  The exit code of the program executed in the\n *       container is returned.  The container argument has been set\n *       to CONTAINER_TERMINATED.\n *   0 : The container is being rebooted, has been shut down or exited\n *       successfully.  The container argument has been set to either\n *       CONTAINER_TERMINATED or CONTAINER_REBOOTED.\n *\n * That is, success is indicated by a return value of zero, and an\n * error is indicated by a non-zero value.\n */\nstatic int wait_for_container(pid_t pid, ContainerStatus *container) {\n        siginfo_t status;\n        int r;\n\n        r = wait_for_terminate(pid, &status);\n        if (r < 0)\n                return log_warning_errno(r, \"Failed to wait for container: %m\");\n\n        switch (status.si_code) {\n\n        case CLD_EXITED:\n                if (status.si_status == 0)\n                        log_full(arg_quiet ? LOG_DEBUG : LOG_INFO, \"Container %s exited successfully.\", arg_machine);\n                else\n                        log_full(arg_quiet ? LOG_DEBUG : LOG_INFO, \"Container %s failed with error code %i.\", arg_machine, status.si_status);\n\n                *container = CONTAINER_TERMINATED;\n                return status.si_status;\n\n        case CLD_KILLED:\n                if (status.si_status == SIGINT) {\n                        log_full(arg_quiet ? LOG_DEBUG : LOG_INFO, \"Container %s has been shut down.\", arg_machine);\n                        *container = CONTAINER_TERMINATED;\n                        return 0;\n\n                } else if (status.si_status == SIGHUP) {\n                        log_full(arg_quiet ? LOG_DEBUG : LOG_INFO, \"Container %s is being rebooted.\", arg_machine);\n                        *container = CONTAINER_REBOOTED;\n                        return 0;\n                }\n\n                _fallthrough_;\n        case CLD_DUMPED:\n                log_error(\"Container %s terminated by signal %s.\", arg_machine, signal_to_string(status.si_status));\n                return -EIO;\n\n        default:\n                log_error(\"Container %s failed due to unknown reason.\", arg_machine);\n                return -EIO;\n        }\n}\n\nstatic int on_orderly_shutdown(sd_event_source *s, const struct signalfd_siginfo *si, void *userdata) {\n        pid_t pid;\n\n        pid = PTR_TO_PID(userdata);\n        if (pid > 0) {\n                if (kill(pid, arg_kill_signal) >= 0) {\n                        log_info(\"Trying to halt container. Send SIGTERM again to trigger immediate termination.\");\n                        sd_event_source_set_userdata(s, NULL);\n                        return 0;\n                }\n        }\n\n        sd_event_exit(sd_event_source_get_event(s), 0);\n        return 0;\n}\n\nstatic int on_sigchld(sd_event_source *s, const struct signalfd_siginfo *ssi, void *userdata) {\n        pid_t pid;\n\n        assert(s);\n        assert(ssi);\n\n        pid = PTR_TO_PID(userdata);\n\n        for (;;) {\n                siginfo_t si = {};\n\n                if (waitid(P_ALL, 0, &si, WNOHANG|WNOWAIT|WEXITED) < 0)\n                        return log_error_errno(errno, \"Failed to waitid(): %m\");\n                if (si.si_pid == 0) /* No pending children. */\n                        break;\n                if (si.si_pid == pid) {\n                        /* The main process we care for has exited. Return from\n                         * signal handler but leave the zombie. */\n                        sd_event_exit(sd_event_source_get_event(s), 0);\n                        break;\n                }\n\n                /* Reap all other children. */\n                (void) waitid(P_PID, si.si_pid, &si, WNOHANG|WEXITED);\n        }\n\n        return 0;\n}\n\nstatic int on_request_stop(sd_bus_message *m, void *userdata, sd_bus_error *error) {\n        pid_t pid;\n\n        assert(m);\n\n        pid = PTR_TO_PID(userdata);\n\n        if (arg_kill_signal > 0) {\n                log_info(\"Container termination requested. Attempting to halt container.\");\n                (void) kill(pid, arg_kill_signal);\n        } else {\n                log_info(\"Container termination requested. Exiting.\");\n                sd_event_exit(sd_bus_get_event(sd_bus_message_get_bus(m)), 0);\n        }\n\n        return 0;\n}\n\nstatic int determine_names(void) {\n        int r;\n\n        if (arg_template && !arg_directory && arg_machine) {\n\n                /* If --template= was specified then we should not\n                 * search for a machine, but instead create a new one\n                 * in /var/lib/machine. */\n\n                arg_directory = strjoin(\"/var/lib/machines/\", arg_machine);\n                if (!arg_directory)\n                        return log_oom();\n        }\n\n        if (!arg_image && !arg_directory) {\n                if (arg_machine) {\n                        _cleanup_(image_unrefp) Image *i = NULL;\n\n                        r = image_find(IMAGE_MACHINE, arg_machine, &i);\n                        if (r == -ENOENT)\n                                return log_error_errno(r, \"No image for machine '%s'.\", arg_machine);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to find image for machine '%s': %m\", arg_machine);\n\n                        if (IN_SET(i->type, IMAGE_RAW, IMAGE_BLOCK))\n                                r = free_and_strdup(&arg_image, i->path);\n                        else\n                                r = free_and_strdup(&arg_directory, i->path);\n                        if (r < 0)\n                                return log_oom();\n\n                        if (!arg_ephemeral)\n                                arg_read_only = arg_read_only || i->read_only;\n                } else {\n                        r = safe_getcwd(&arg_directory);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to determine current directory: %m\");\n                }\n\n                if (!arg_directory && !arg_image) {\n                        log_error(\"Failed to determine path, please use -D or -i.\");\n                        return -EINVAL;\n                }\n        }\n\n        if (!arg_machine) {\n                if (arg_directory && path_equal(arg_directory, \"/\"))\n                        arg_machine = gethostname_malloc();\n                else {\n                        if (arg_image) {\n                                char *e;\n\n                                arg_machine = strdup(basename(arg_image));\n\n                                /* Truncate suffix if there is one */\n                                e = endswith(arg_machine, \".raw\");\n                                if (e)\n                                        *e = 0;\n                        } else\n                                arg_machine = strdup(basename(arg_directory));\n                }\n                if (!arg_machine)\n                        return log_oom();\n\n                hostname_cleanup(arg_machine);\n                if (!machine_name_is_valid(arg_machine)) {\n                        log_error(\"Failed to determine machine name automatically, please use -M.\");\n                        return -EINVAL;\n                }\n\n                if (arg_ephemeral) {\n                        char *b;\n\n                        /* Add a random suffix when this is an\n                         * ephemeral machine, so that we can run many\n                         * instances at once without manually having\n                         * to specify -M each time. */\n\n                        if (asprintf(&b, \"%s-%016\" PRIx64, arg_machine, random_u64()) < 0)\n                                return log_oom();\n\n                        free(arg_machine);\n                        arg_machine = b;\n                }\n        }\n\n        return 0;\n}\n\nstatic int chase_symlinks_and_update(char **p, unsigned flags) {\n        char *chased;\n        int r;\n\n        assert(p);\n\n        if (!*p)\n                return 0;\n\n        r = chase_symlinks(*p, NULL, flags, &chased);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to resolve path %s: %m\", *p);\n\n        free_and_replace(*p, chased);\n        return r; /* r might be an fd here in case we ever use CHASE_OPEN in flags */\n}\n\nstatic int determine_uid_shift(const char *directory) {\n        int r;\n\n        if (arg_userns_mode == USER_NAMESPACE_NO) {\n                arg_uid_shift = 0;\n                return 0;\n        }\n\n        if (arg_uid_shift == UID_INVALID) {\n                struct stat st;\n\n                r = stat(directory, &st);\n                if (r < 0)\n                        return log_error_errno(errno, \"Failed to determine UID base of %s: %m\", directory);\n\n                arg_uid_shift = st.st_uid & UINT32_C(0xffff0000);\n\n                if (arg_uid_shift != (st.st_gid & UINT32_C(0xffff0000))) {\n                        log_error(\"UID and GID base of %s don't match.\", directory);\n                        return -EINVAL;\n                }\n\n                arg_uid_range = UINT32_C(0x10000);\n        }\n\n        if (arg_uid_shift > (uid_t) -1 - arg_uid_range) {\n                log_error(\"UID base too high for UID range.\");\n                return -EINVAL;\n        }\n\n        return 0;\n}\n\nstatic int inner_child(\n                Barrier *barrier,\n                const char *directory,\n                bool secondary,\n                int kmsg_socket,\n                int rtnl_socket,\n                FDSet *fds) {\n\n        _cleanup_free_ char *home = NULL;\n        char as_uuid[37];\n        size_t n_env = 1;\n        const char *envp[] = {\n                \"PATH=\" DEFAULT_PATH_COMPAT,\n                NULL, /* container */\n                NULL, /* TERM */\n                NULL, /* HOME */\n                NULL, /* USER */\n                NULL, /* LOGNAME */\n                NULL, /* container_uuid */\n                NULL, /* LISTEN_FDS */\n                NULL, /* LISTEN_PID */\n                NULL, /* NOTIFY_SOCKET */\n                NULL\n        };\n        const char *exec_target;\n        _cleanup_strv_free_ char **env_use = NULL;\n        int r;\n\n        assert(barrier);\n        assert(directory);\n        assert(kmsg_socket >= 0);\n\n        if (arg_userns_mode != USER_NAMESPACE_NO) {\n                /* Tell the parent, that it now can write the UID map. */\n                (void) barrier_place(barrier); /* #1 */\n\n                /* Wait until the parent wrote the UID map */\n                if (!barrier_place_and_sync(barrier)) { /* #2 */\n                        log_error(\"Parent died too early\");\n                        return -ESRCH;\n                }\n        }\n\n        r = reset_uid_gid();\n        if (r < 0)\n                return log_error_errno(r, \"Couldn't become new root: %m\");\n\n        r = mount_all(NULL,\n                      arg_mount_settings | MOUNT_IN_USERNS,\n                      arg_uid_shift,\n                      arg_uid_range,\n                      arg_selinux_apifs_context);\n        if (r < 0)\n                return r;\n\n        if (!arg_network_namespace_path && arg_private_network) {\n                r = unshare(CLONE_NEWNET);\n                if (r < 0)\n                        return log_error_errno(errno, \"Failed to unshare network namespace: %m\");\n\n                /* Tell the parent that it can setup network interfaces. */\n                (void) barrier_place(barrier); /* #3 */\n        }\n\n        r = mount_sysfs(NULL, arg_mount_settings);\n        if (r < 0)\n                return r;\n\n        /* Wait until we are cgroup-ified, so that we\n         * can mount the right cgroup path writable */\n        if (!barrier_place_and_sync(barrier)) { /* #4 */\n                log_error(\"Parent died too early\");\n                return -ESRCH;\n        }\n\n        if (arg_use_cgns && cg_ns_supported()) {\n                r = unshare(CLONE_NEWCGROUP);\n                if (r < 0)\n                        return log_error_errno(errno, \"Failed to unshare cgroup namespace: %m\");\n                r = mount_cgroups(\n                                \"\",\n                                arg_unified_cgroup_hierarchy,\n                                arg_userns_mode != USER_NAMESPACE_NO,\n                                arg_uid_shift,\n                                arg_uid_range,\n                                arg_selinux_apifs_context,\n                                true);\n                if (r < 0)\n                        return r;\n        } else {\n                r = mount_systemd_cgroup_writable(\"\", arg_unified_cgroup_hierarchy);\n                if (r < 0)\n                        return r;\n        }\n\n        r = setup_boot_id();\n        if (r < 0)\n                return r;\n\n        r = setup_kmsg(kmsg_socket);\n        if (r < 0)\n                return r;\n        kmsg_socket = safe_close(kmsg_socket);\n\n        if (setsid() < 0)\n                return log_error_errno(errno, \"setsid() failed: %m\");\n\n        if (arg_private_network)\n                loopback_setup();\n\n        if (arg_expose_ports) {\n                r = expose_port_send_rtnl(rtnl_socket);\n                if (r < 0)\n                        return r;\n                rtnl_socket = safe_close(rtnl_socket);\n        }\n\n        if (arg_oom_score_adjust_set) {\n                r = set_oom_score_adjust(arg_oom_score_adjust);\n                if (r < 0)\n                        return log_error_errno(r, \"Failed to adjust OOM score: %m\");\n        }\n\n        if (arg_cpuset)\n                if (sched_setaffinity(0, CPU_ALLOC_SIZE(arg_cpuset_ncpus), arg_cpuset) < 0)\n                        return log_error_errno(errno, \"Failed to set CPU affinity: %m\");\n\n        r = drop_capabilities();\n        if (r < 0)\n                return log_error_errno(r, \"drop_capabilities() failed: %m\");\n\n        (void) setup_hostname();\n\n        if (arg_personality != PERSONALITY_INVALID) {\n                r = safe_personality(arg_personality);\n                if (r < 0)\n                        return log_error_errno(r, \"personality() failed: %m\");\n        } else if (secondary) {\n                r = safe_personality(PER_LINUX32);\n                if (r < 0)\n                        return log_error_errno(r, \"personality() failed: %m\");\n        }\n\n#if HAVE_SELINUX\n        if (arg_selinux_context)\n                if (setexeccon(arg_selinux_context) < 0)\n                        return log_error_errno(errno, \"setexeccon(\\\"%s\\\") failed: %m\", arg_selinux_context);\n#endif\n\n        r = change_uid_gid(arg_user, &home);\n        if (r < 0)\n                return r;\n\n        if (arg_no_new_privileges)\n                if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0) < 0)\n                        return log_error_errno(errno, \"Failed to disable new privileges: %m\");\n\n        /* LXC sets container=lxc, so follow the scheme here */\n        envp[n_env++] = strjoina(\"container=\", arg_container_service_name);\n\n        envp[n_env] = strv_find_prefix(environ, \"TERM=\");\n        if (envp[n_env])\n                n_env++;\n\n        if ((asprintf((char**)(envp + n_env++), \"HOME=%s\", home ? home: \"/root\") < 0) ||\n            (asprintf((char**)(envp + n_env++), \"USER=%s\", arg_user ? arg_user : \"root\") < 0) ||\n            (asprintf((char**)(envp + n_env++), \"LOGNAME=%s\", arg_user ? arg_user : \"root\") < 0))\n                return log_oom();\n\n        assert(!sd_id128_is_null(arg_uuid));\n\n        if (asprintf((char**)(envp + n_env++), \"container_uuid=%s\", id128_to_uuid_string(arg_uuid, as_uuid)) < 0)\n                return log_oom();\n\n        if (fdset_size(fds) > 0) {\n                r = fdset_cloexec(fds, false);\n                if (r < 0)\n                        return log_error_errno(r, \"Failed to unset O_CLOEXEC for file descriptors.\");\n\n                if ((asprintf((char **)(envp + n_env++), \"LISTEN_FDS=%u\", fdset_size(fds)) < 0) ||\n                    (asprintf((char **)(envp + n_env++), \"LISTEN_PID=1\") < 0))\n                        return log_oom();\n        }\n        if (asprintf((char **)(envp + n_env++), \"NOTIFY_SOCKET=%s\", NSPAWN_NOTIFY_SOCKET_PATH) < 0)\n                return log_oom();\n\n        env_use = strv_env_merge(2, envp, arg_setenv);\n        if (!env_use)\n                return log_oom();\n\n        /* Let the parent know that we are ready and\n         * wait until the parent is ready with the\n         * setup, too... */\n        if (!barrier_place_and_sync(barrier)) { /* #5 */\n                log_error(\"Parent died too early\");\n                return -ESRCH;\n        }\n\n        if (arg_chdir)\n                if (chdir(arg_chdir) < 0)\n                        return log_error_errno(errno, \"Failed to change to specified working directory %s: %m\", arg_chdir);\n\n        if (arg_start_mode == START_PID2) {\n                r = stub_pid1(arg_uuid);\n                if (r < 0)\n                        return r;\n        }\n\n        /* Now, explicitly close the log, so that we then can close all remaining fds. Closing the log explicitly first\n         * has the benefit that the logging subsystem knows about it, and is thus ready to be reopened should we need\n         * it again. Note that the other fds closed here are at least the locking and barrier fds. */\n        log_close();\n        log_set_open_when_needed(true);\n\n        (void) fdset_close_others(fds);\n\n        if (arg_start_mode == START_BOOT) {\n                char **a;\n                size_t m;\n\n                /* Automatically search for the init system */\n\n                m = strv_length(arg_parameters);\n                a = newa(char*, m + 2);\n                memcpy_safe(a + 1, arg_parameters, m * sizeof(char*));\n                a[1 + m] = NULL;\n\n                a[0] = (char*) \"/usr/lib/systemd/systemd\";\n                execve(a[0], a, env_use);\n\n                a[0] = (char*) \"/lib/systemd/systemd\";\n                execve(a[0], a, env_use);\n\n                a[0] = (char*) \"/sbin/init\";\n                execve(a[0], a, env_use);\n\n                exec_target = \"/usr/lib/systemd/systemd, /lib/systemd/systemd, /sbin/init\";\n        } else if (!strv_isempty(arg_parameters)) {\n                exec_target = arg_parameters[0];\n                execvpe(arg_parameters[0], arg_parameters, env_use);\n        } else {\n                if (!arg_chdir)\n                        /* If we cannot change the directory, we'll end up in /, that is expected. */\n                        (void) chdir(home ?: \"/root\");\n\n                execle(\"/bin/bash\", \"-bash\", NULL, env_use);\n                execle(\"/bin/sh\", \"-sh\", NULL, env_use);\n\n                exec_target = \"/bin/bash, /bin/sh\";\n        }\n\n        return log_error_errno(errno, \"execv(%s) failed: %m\", exec_target);\n}\n\nstatic int setup_sd_notify_child(void) {\n        static const int one = 1;\n        int fd = -1;\n        union sockaddr_union sa = {\n                .sa.sa_family = AF_UNIX,\n        };\n        int r;\n\n        fd = socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC|SOCK_NONBLOCK, 0);\n        if (fd < 0)\n                return log_error_errno(errno, \"Failed to allocate notification socket: %m\");\n\n        (void) mkdir_parents(NSPAWN_NOTIFY_SOCKET_PATH, 0755);\n        (void) unlink(NSPAWN_NOTIFY_SOCKET_PATH);\n\n        strncpy(sa.un.sun_path, NSPAWN_NOTIFY_SOCKET_PATH, sizeof(sa.un.sun_path)-1);\n        r = bind(fd, &sa.sa, SOCKADDR_UN_LEN(sa.un));\n        if (r < 0) {\n                safe_close(fd);\n                return log_error_errno(errno, \"bind(%s) failed: %m\", sa.un.sun_path);\n        }\n\n        r = userns_lchown(NSPAWN_NOTIFY_SOCKET_PATH, 0, 0);\n        if (r < 0) {\n                safe_close(fd);\n                return log_error_errno(r, \"Failed to chown \" NSPAWN_NOTIFY_SOCKET_PATH \": %m\");\n        }\n\n        r = setsockopt(fd, SOL_SOCKET, SO_PASSCRED, &one, sizeof(one));\n        if (r < 0) {\n                safe_close(fd);\n                return log_error_errno(errno, \"SO_PASSCRED failed: %m\");\n        }\n\n        return fd;\n}\n\nstatic int outer_child(\n                Barrier *barrier,\n                const char *directory,\n                const char *console,\n                DissectedImage *dissected_image,\n                bool interactive,\n                bool secondary,\n                int pid_socket,\n                int uuid_socket,\n                int notify_socket,\n                int kmsg_socket,\n                int rtnl_socket,\n                int uid_shift_socket,\n                int unified_cgroup_hierarchy_socket,\n                FDSet *fds,\n                int netns_fd) {\n\n        _cleanup_close_ int fd = -1;\n        int r, which_failed;\n        pid_t pid;\n        ssize_t l;\n\n        assert(barrier);\n        assert(directory);\n        assert(console);\n        assert(pid_socket >= 0);\n        assert(uuid_socket >= 0);\n        assert(notify_socket >= 0);\n        assert(kmsg_socket >= 0);\n\n        if (prctl(PR_SET_PDEATHSIG, SIGKILL) < 0)\n                return log_error_errno(errno, \"PR_SET_PDEATHSIG failed: %m\");\n\n        if (interactive) {\n                int terminal;\n\n                terminal = open_terminal(console, O_RDWR);\n                if (terminal < 0)\n                        return log_error_errno(terminal, \"Failed to open console: %m\");\n\n                /* Make sure we can continue logging to the original stderr, even if stderr points elsewhere now */\n                r = log_dup_console();\n                if (r < 0)\n                        return log_error_errno(r, \"Failed to duplicate stderr: %m\");\n\n                r = rearrange_stdio(terminal, terminal, terminal); /* invalidates 'terminal' on success and failure */\n                if (r < 0)\n                        return log_error_errno(r, \"Failed to move console to stdin/stdout/stderr: %m\");\n        }\n\n        r = reset_audit_loginuid();\n        if (r < 0)\n                return r;\n\n        /* Mark everything as slave, so that we still\n         * receive mounts from the real root, but don't\n         * propagate mounts to the real root. */\n        r = mount_verbose(LOG_ERR, NULL, \"/\", NULL, MS_SLAVE|MS_REC, NULL);\n        if (r < 0)\n                return r;\n\n        if (dissected_image) {\n                /* If we are operating on a disk image, then mount its root directory now, but leave out the rest. We\n                 * can read the UID shift from it if we need to. Further down we'll mount the rest, but then with the\n                 * uid shift known. That way we can mount VFAT file systems shifted to the right place right away. This\n                 * makes sure ESP partitions and userns are compatible. */\n\n                r = dissected_image_mount(dissected_image, directory, arg_uid_shift,\n                                          DISSECT_IMAGE_MOUNT_ROOT_ONLY|DISSECT_IMAGE_DISCARD_ON_LOOP|\n                                          (arg_read_only ? DISSECT_IMAGE_READ_ONLY : 0)|\n                                          (arg_start_mode == START_BOOT ? DISSECT_IMAGE_VALIDATE_OS : 0));\n                if (r < 0)\n                        return r;\n        }\n\n        r = determine_uid_shift(directory);\n        if (r < 0)\n                return r;\n\n        if (arg_userns_mode != USER_NAMESPACE_NO) {\n                /* Let the parent know which UID shift we read from the image */\n                l = send(uid_shift_socket, &arg_uid_shift, sizeof(arg_uid_shift), MSG_NOSIGNAL);\n                if (l < 0)\n                        return log_error_errno(errno, \"Failed to send UID shift: %m\");\n                if (l != sizeof(arg_uid_shift)) {\n                        log_error(\"Short write while sending UID shift.\");\n                        return -EIO;\n                }\n\n                if (arg_userns_mode == USER_NAMESPACE_PICK) {\n                        /* When we are supposed to pick the UID shift, the parent will check now whether the UID shift\n                         * we just read from the image is available. If yes, it will send the UID shift back to us, if\n                         * not it will pick a different one, and send it back to us. */\n\n                        l = recv(uid_shift_socket, &arg_uid_shift, sizeof(arg_uid_shift), 0);\n                        if (l < 0)\n                                return log_error_errno(errno, \"Failed to recv UID shift: %m\");\n                        if (l != sizeof(arg_uid_shift)) {\n                                log_error(\"Short read while receiving UID shift.\");\n                                return -EIO;\n                        }\n                }\n\n                log_info(\"Selected user namespace base \" UID_FMT \" and range \" UID_FMT \".\", arg_uid_shift, arg_uid_range);\n        }\n\n        if (dissected_image) {\n                /* Now we know the uid shift, let's now mount everything else that might be in the image. */\n                r = dissected_image_mount(dissected_image, directory, arg_uid_shift,\n                                          DISSECT_IMAGE_MOUNT_NON_ROOT_ONLY|DISSECT_IMAGE_DISCARD_ON_LOOP|(arg_read_only ? DISSECT_IMAGE_READ_ONLY : 0));\n                if (r < 0)\n                        return r;\n        }\n\n        if (arg_unified_cgroup_hierarchy == CGROUP_UNIFIED_UNKNOWN) {\n                /* OK, we don't know yet which cgroup mode to use yet. Let's figure it out, and tell the parent. */\n\n                r = detect_unified_cgroup_hierarchy_from_image(directory);\n                if (r < 0)\n                        return r;\n\n                l = send(unified_cgroup_hierarchy_socket, &arg_unified_cgroup_hierarchy, sizeof(arg_unified_cgroup_hierarchy), MSG_NOSIGNAL);\n                if (l < 0)\n                        return log_error_errno(errno, \"Failed to send cgroup mode: %m\");\n                if (l != sizeof(arg_unified_cgroup_hierarchy)) {\n                        log_error(\"Short write while sending cgroup mode.\");\n                        return -EIO;\n                }\n\n                unified_cgroup_hierarchy_socket = safe_close(unified_cgroup_hierarchy_socket);\n        }\n\n        /* Turn directory into bind mount */\n        r = mount_verbose(LOG_ERR, directory, directory, NULL, MS_BIND|MS_REC, NULL);\n        if (r < 0)\n                return r;\n\n        r = setup_pivot_root(\n                        directory,\n                        arg_pivot_root_new,\n                        arg_pivot_root_old);\n        if (r < 0)\n                return r;\n\n        r = setup_volatile(\n                        directory,\n                        arg_volatile_mode,\n                        arg_userns_mode != USER_NAMESPACE_NO,\n                        arg_uid_shift,\n                        arg_uid_range,\n                        arg_selinux_context);\n        if (r < 0)\n                return r;\n\n        r = setup_volatile_state(\n                        directory,\n                        arg_volatile_mode,\n                        arg_userns_mode != USER_NAMESPACE_NO,\n                        arg_uid_shift,\n                        arg_uid_range,\n                        arg_selinux_context);\n        if (r < 0)\n                return r;\n\n        /* Mark everything as shared so our mounts get propagated down. This is\n         * required to make new bind mounts available in systemd services\n         * inside the containter that create a new mount namespace.\n         * See https://github.com/systemd/systemd/issues/3860\n         * Further submounts (such as /dev) done after this will inherit the\n         * shared propagation mode. */\n        r = mount_verbose(LOG_ERR, NULL, directory, NULL, MS_SHARED|MS_REC, NULL);\n        if (r < 0)\n                return r;\n\n        r = recursive_chown(directory, arg_uid_shift, arg_uid_range);\n        if (r < 0)\n                return r;\n\n        r = base_filesystem_create(directory, arg_uid_shift, (gid_t) arg_uid_shift);\n        if (r < 0)\n                return r;\n\n        if (arg_read_only) {\n                r = bind_remount_recursive(directory, true, NULL);\n                if (r < 0)\n                        return log_error_errno(r, \"Failed to make tree read-only: %m\");\n        }\n\n        r = mount_all(directory,\n                      arg_mount_settings,\n                      arg_uid_shift,\n                      arg_uid_range,\n                      arg_selinux_apifs_context);\n        if (r < 0)\n                return r;\n\n        r = copy_devnodes(directory);\n        if (r < 0)\n                return r;\n\n        dev_setup(directory, arg_uid_shift, arg_uid_shift);\n\n        r = setup_pts(directory);\n        if (r < 0)\n                return r;\n\n        r = setup_propagate(directory);\n        if (r < 0)\n                return r;\n\n        r = setup_dev_console(directory, console);\n        if (r < 0)\n                return r;\n\n        r = setup_keyring();\n        if (r < 0)\n                return r;\n\n        r = setup_seccomp(arg_caps_retain, arg_syscall_whitelist, arg_syscall_blacklist);\n        if (r < 0)\n                return r;\n\n        r = setup_timezone(directory);\n        if (r < 0)\n                return r;\n\n        r = setup_resolv_conf(directory);\n        if (r < 0)\n                return r;\n\n        r = setup_machine_id(directory);\n        if (r < 0)\n                return r;\n\n        r = setup_journal(directory);\n        if (r < 0)\n                return r;\n\n        r = mount_custom(\n                        directory,\n                        arg_custom_mounts,\n                        arg_n_custom_mounts,\n                        arg_userns_mode != USER_NAMESPACE_NO,\n                        arg_uid_shift,\n                        arg_uid_range,\n                        arg_selinux_apifs_context);\n        if (r < 0)\n                return r;\n\n        if (!arg_use_cgns || !cg_ns_supported()) {\n                r = mount_cgroups(\n                                directory,\n                                arg_unified_cgroup_hierarchy,\n                                arg_userns_mode != USER_NAMESPACE_NO,\n                                arg_uid_shift,\n                                arg_uid_range,\n                                arg_selinux_apifs_context,\n                                false);\n                if (r < 0)\n                        return r;\n        }\n\n        r = mount_move_root(directory);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to move root directory: %m\");\n\n        fd = setup_sd_notify_child();\n        if (fd < 0)\n                return fd;\n\n        r = setrlimit_closest_all((const struct rlimit *const*) arg_rlimit, &which_failed);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to apply resource limit RLIMIT_%s: %m\", rlimit_to_string(which_failed));\n\n        pid = raw_clone(SIGCHLD|CLONE_NEWNS|\n                        arg_clone_ns_flags |\n                        (arg_userns_mode != USER_NAMESPACE_NO ? CLONE_NEWUSER : 0));\n        if (pid < 0)\n                return log_error_errno(errno, \"Failed to fork inner child: %m\");\n        if (pid == 0) {\n                pid_socket = safe_close(pid_socket);\n                uuid_socket = safe_close(uuid_socket);\n                notify_socket = safe_close(notify_socket);\n                uid_shift_socket = safe_close(uid_shift_socket);\n\n                /* The inner child has all namespaces that are\n                 * requested, so that we all are owned by the user if\n                 * user namespaces are turned on. */\n\n                if (arg_network_namespace_path) {\n                        r = namespace_enter(-1, -1, netns_fd, -1, -1);\n                        if (r < 0)\n                                return r;\n                }\n\n                r = inner_child(barrier, directory, secondary, kmsg_socket, rtnl_socket, fds);\n                if (r < 0)\n                        _exit(EXIT_FAILURE);\n\n                _exit(EXIT_SUCCESS);\n        }\n\n        l = send(pid_socket, &pid, sizeof(pid), MSG_NOSIGNAL);\n        if (l < 0)\n                return log_error_errno(errno, \"Failed to send PID: %m\");\n        if (l != sizeof(pid)) {\n                log_error(\"Short write while sending PID.\");\n                return -EIO;\n        }\n\n        l = send(uuid_socket, &arg_uuid, sizeof(arg_uuid), MSG_NOSIGNAL);\n        if (l < 0)\n                return log_error_errno(errno, \"Failed to send machine ID: %m\");\n        if (l != sizeof(arg_uuid)) {\n                log_error(\"Short write while sending machine ID.\");\n                return -EIO;\n        }\n\n        l = send_one_fd(notify_socket, fd, 0);\n        if (l < 0)\n                return log_error_errno(errno, \"Failed to send notify fd: %m\");\n\n        pid_socket = safe_close(pid_socket);\n        uuid_socket = safe_close(uuid_socket);\n        notify_socket = safe_close(notify_socket);\n        kmsg_socket = safe_close(kmsg_socket);\n        rtnl_socket = safe_close(rtnl_socket);\n        netns_fd = safe_close(netns_fd);\n\n        return 0;\n}\n\nstatic int uid_shift_pick(uid_t *shift, LockFile *ret_lock_file) {\n        bool tried_hashed = false;\n        unsigned n_tries = 100;\n        uid_t candidate;\n        int r;\n\n        assert(shift);\n        assert(ret_lock_file);\n        assert(arg_userns_mode == USER_NAMESPACE_PICK);\n        assert(arg_uid_range == 0x10000U);\n\n        candidate = *shift;\n\n        (void) mkdir(\"/run/systemd/nspawn-uid\", 0755);\n\n        for (;;) {\n                char lock_path[STRLEN(\"/run/systemd/nspawn-uid/\") + DECIMAL_STR_MAX(uid_t) + 1];\n                _cleanup_(release_lock_file) LockFile lf = LOCK_FILE_INIT;\n\n                if (--n_tries <= 0)\n                        return -EBUSY;\n\n                if (candidate < CONTAINER_UID_BASE_MIN || candidate > CONTAINER_UID_BASE_MAX)\n                        goto next;\n                if ((candidate & UINT32_C(0xFFFF)) != 0)\n                        goto next;\n\n                xsprintf(lock_path, \"/run/systemd/nspawn-uid/\" UID_FMT, candidate);\n                r = make_lock_file(lock_path, LOCK_EX|LOCK_NB, &lf);\n                if (r == -EBUSY) /* Range already taken by another nspawn instance */\n                        goto next;\n                if (r < 0)\n                        return r;\n\n                /* Make some superficial checks whether the range is currently known in the user database */\n                if (getpwuid(candidate))\n                        goto next;\n                if (getpwuid(candidate + UINT32_C(0xFFFE)))\n                        goto next;\n                if (getgrgid(candidate))\n                        goto next;\n                if (getgrgid(candidate + UINT32_C(0xFFFE)))\n                        goto next;\n\n                *ret_lock_file = lf;\n                lf = (struct LockFile) LOCK_FILE_INIT;\n                *shift = candidate;\n                return 0;\n\n        next:\n                if (arg_machine && !tried_hashed) {\n                        /* Try to hash the base from the container name */\n\n                        static const uint8_t hash_key[] = {\n                                0xe1, 0x56, 0xe0, 0xf0, 0x4a, 0xf0, 0x41, 0xaf,\n                                0x96, 0x41, 0xcf, 0x41, 0x33, 0x94, 0xff, 0x72\n                        };\n\n                        candidate = (uid_t) siphash24(arg_machine, strlen(arg_machine), hash_key);\n\n                        tried_hashed = true;\n                } else\n                        random_bytes(&candidate, sizeof(candidate));\n\n                candidate = (candidate % (CONTAINER_UID_BASE_MAX - CONTAINER_UID_BASE_MIN)) + CONTAINER_UID_BASE_MIN;\n                candidate &= (uid_t) UINT32_C(0xFFFF0000);\n        }\n}\n\nstatic int setup_uid_map(pid_t pid) {\n        char uid_map[STRLEN(\"/proc//uid_map\") + DECIMAL_STR_MAX(uid_t) + 1], line[DECIMAL_STR_MAX(uid_t)*3+3+1];\n        int r;\n\n        assert(pid > 1);\n\n        xsprintf(uid_map, \"/proc/\" PID_FMT \"/uid_map\", pid);\n        xsprintf(line, UID_FMT \" \" UID_FMT \" \" UID_FMT \"\\n\", 0, arg_uid_shift, arg_uid_range);\n        r = write_string_file(uid_map, line, 0);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to write UID map: %m\");\n\n        /* We always assign the same UID and GID ranges */\n        xsprintf(uid_map, \"/proc/\" PID_FMT \"/gid_map\", pid);\n        r = write_string_file(uid_map, line, 0);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to write GID map: %m\");\n\n        return 0;\n}\n\nstatic int nspawn_dispatch_notify_fd(sd_event_source *source, int fd, uint32_t revents, void *userdata) {\n        char buf[NOTIFY_BUFFER_MAX+1];\n        char *p = NULL;\n        struct iovec iovec = {\n                .iov_base = buf,\n                .iov_len = sizeof(buf)-1,\n        };\n        union {\n                struct cmsghdr cmsghdr;\n                uint8_t buf[CMSG_SPACE(sizeof(struct ucred)) +\n                            CMSG_SPACE(sizeof(int) * NOTIFY_FD_MAX)];\n        } control = {};\n        struct msghdr msghdr = {\n                .msg_iov = &iovec,\n                .msg_iovlen = 1,\n                .msg_control = &control,\n                .msg_controllen = sizeof(control),\n        };\n        struct cmsghdr *cmsg;\n        struct ucred *ucred = NULL;\n        ssize_t n;\n        pid_t inner_child_pid;\n        _cleanup_strv_free_ char **tags = NULL;\n\n        assert(userdata);\n\n        inner_child_pid = PTR_TO_PID(userdata);\n\n        if (revents != EPOLLIN) {\n                log_warning(\"Got unexpected poll event for notify fd.\");\n                return 0;\n        }\n\n        n = recvmsg(fd, &msghdr, MSG_DONTWAIT|MSG_CMSG_CLOEXEC);\n        if (n < 0) {\n                if (IN_SET(errno, EAGAIN, EINTR))\n                        return 0;\n\n                return log_warning_errno(errno, \"Couldn't read notification socket: %m\");\n        }\n        cmsg_close_all(&msghdr);\n\n        CMSG_FOREACH(cmsg, &msghdr) {\n                if (cmsg->cmsg_level == SOL_SOCKET &&\n                           cmsg->cmsg_type == SCM_CREDENTIALS &&\n                           cmsg->cmsg_len == CMSG_LEN(sizeof(struct ucred))) {\n\n                        ucred = (struct ucred*) CMSG_DATA(cmsg);\n                }\n        }\n\n        if (!ucred || ucred->pid != inner_child_pid) {\n                log_debug(\"Received notify message without valid credentials. Ignoring.\");\n                return 0;\n        }\n\n        if ((size_t) n >= sizeof(buf)) {\n                log_warning(\"Received notify message exceeded maximum size. Ignoring.\");\n                return 0;\n        }\n\n        buf[n] = 0;\n        tags = strv_split(buf, \"\\n\\r\");\n        if (!tags)\n                return log_oom();\n\n        if (strv_find(tags, \"READY=1\"))\n                sd_notifyf(false, \"READY=1\\n\");\n\n        p = strv_find_startswith(tags, \"STATUS=\");\n        if (p)\n                sd_notifyf(false, \"STATUS=Container running: %s\", p);\n\n        return 0;\n}\n\nstatic int setup_sd_notify_parent(sd_event *event, int fd, pid_t *inner_child_pid, sd_event_source **notify_event_source) {\n        int r;\n\n        r = sd_event_add_io(event, notify_event_source, fd, EPOLLIN, nspawn_dispatch_notify_fd, inner_child_pid);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to allocate notify event source: %m\");\n\n        (void) sd_event_source_set_description(*notify_event_source, \"nspawn-notify\");\n\n        return 0;\n}\n\nstatic int merge_settings(Settings *settings, const char *path) {\n        int rl;\n\n        assert(settings);\n        assert(path);\n\n        /* Copy over bits from the settings, unless they have been explicitly masked by command line switches. Note\n         * that this steals the fields of the Settings* structure, and hence modifies it. */\n\n        if ((arg_settings_mask & SETTING_START_MODE) == 0 &&\n            settings->start_mode >= 0) {\n                arg_start_mode = settings->start_mode;\n                strv_free_and_replace(arg_parameters, settings->parameters);\n        }\n\n        if ((arg_settings_mask & SETTING_PIVOT_ROOT) == 0 &&\n            settings->pivot_root_new) {\n                free_and_replace(arg_pivot_root_new, settings->pivot_root_new);\n                free_and_replace(arg_pivot_root_old, settings->pivot_root_old);\n        }\n\n        if ((arg_settings_mask & SETTING_WORKING_DIRECTORY) == 0 &&\n            settings->working_directory)\n                free_and_replace(arg_chdir, settings->working_directory);\n\n        if ((arg_settings_mask & SETTING_ENVIRONMENT) == 0 &&\n            settings->environment)\n                strv_free_and_replace(arg_setenv, settings->environment);\n\n        if ((arg_settings_mask & SETTING_USER) == 0 &&\n            settings->user)\n                free_and_replace(arg_user, settings->user);\n\n        if ((arg_settings_mask & SETTING_CAPABILITY) == 0) {\n                uint64_t plus;\n\n                plus = settings->capability;\n                if (settings_private_network(settings))\n                        plus |= (1ULL << CAP_NET_ADMIN);\n\n                if (!arg_settings_trusted && plus != 0) {\n                        if (settings->capability != 0)\n                                log_warning(\"Ignoring Capability= setting, file %s is not trusted.\", path);\n                } else\n                        arg_caps_retain |= plus;\n\n                arg_caps_retain &= ~settings->drop_capability;\n        }\n\n        if ((arg_settings_mask & SETTING_KILL_SIGNAL) == 0 &&\n            settings->kill_signal > 0)\n                arg_kill_signal = settings->kill_signal;\n\n        if ((arg_settings_mask & SETTING_PERSONALITY) == 0 &&\n            settings->personality != PERSONALITY_INVALID)\n                arg_personality = settings->personality;\n\n        if ((arg_settings_mask & SETTING_MACHINE_ID) == 0 &&\n            !sd_id128_is_null(settings->machine_id)) {\n\n                if (!arg_settings_trusted)\n                        log_warning(\"Ignoring MachineID= setting, file %s is not trusted.\", path);\n                else\n                        arg_uuid = settings->machine_id;\n        }\n\n        if ((arg_settings_mask & SETTING_READ_ONLY) == 0 &&\n            settings->read_only >= 0)\n                arg_read_only = settings->read_only;\n\n        if ((arg_settings_mask & SETTING_VOLATILE_MODE) == 0 &&\n            settings->volatile_mode != _VOLATILE_MODE_INVALID)\n                arg_volatile_mode = settings->volatile_mode;\n\n        if ((arg_settings_mask & SETTING_CUSTOM_MOUNTS) == 0 &&\n            settings->n_custom_mounts > 0) {\n\n                if (!arg_settings_trusted)\n                        log_warning(\"Ignoring TemporaryFileSystem=, Bind= and BindReadOnly= settings, file %s is not trusted.\", path);\n                else {\n                        custom_mount_free_all(arg_custom_mounts, arg_n_custom_mounts);\n                        arg_custom_mounts = TAKE_PTR(settings->custom_mounts);\n                        arg_n_custom_mounts = settings->n_custom_mounts;\n                        settings->n_custom_mounts = 0;\n                }\n        }\n\n        if ((arg_settings_mask & SETTING_NETWORK) == 0 &&\n            (settings->private_network >= 0 ||\n             settings->network_veth >= 0 ||\n             settings->network_bridge ||\n             settings->network_zone ||\n             settings->network_interfaces ||\n             settings->network_macvlan ||\n             settings->network_ipvlan ||\n             settings->network_veth_extra)) {\n\n                if (!arg_settings_trusted)\n                        log_warning(\"Ignoring network settings, file %s is not trusted.\", path);\n                else {\n                        arg_network_veth = settings_network_veth(settings);\n                        arg_private_network = settings_private_network(settings);\n\n                        strv_free_and_replace(arg_network_interfaces, settings->network_interfaces);\n                        strv_free_and_replace(arg_network_macvlan, settings->network_macvlan);\n                        strv_free_and_replace(arg_network_ipvlan, settings->network_ipvlan);\n                        strv_free_and_replace(arg_network_veth_extra, settings->network_veth_extra);\n\n                        free_and_replace(arg_network_bridge, settings->network_bridge);\n                        free_and_replace(arg_network_zone, settings->network_zone);\n                }\n        }\n\n        if ((arg_settings_mask & SETTING_EXPOSE_PORTS) == 0 &&\n            settings->expose_ports) {\n\n                if (!arg_settings_trusted)\n                        log_warning(\"Ignoring Port= setting, file %s is not trusted.\", path);\n                else {\n                        expose_port_free_all(arg_expose_ports);\n                        arg_expose_ports = TAKE_PTR(settings->expose_ports);\n                }\n        }\n\n        if ((arg_settings_mask & SETTING_USERNS) == 0 &&\n            settings->userns_mode != _USER_NAMESPACE_MODE_INVALID) {\n\n                if (!arg_settings_trusted)\n                        log_warning(\"Ignoring PrivateUsers= and PrivateUsersChown= settings, file %s is not trusted.\", path);\n                else {\n                        arg_userns_mode = settings->userns_mode;\n                        arg_uid_shift = settings->uid_shift;\n                        arg_uid_range = settings->uid_range;\n                        arg_userns_chown = settings->userns_chown;\n                }\n        }\n\n        if ((arg_settings_mask & SETTING_NOTIFY_READY) == 0)\n                arg_notify_ready = settings->notify_ready;\n\n        if ((arg_settings_mask & SETTING_SYSCALL_FILTER) == 0) {\n\n                if (!arg_settings_trusted && !strv_isempty(arg_syscall_whitelist))\n                        log_warning(\"Ignoring SystemCallFilter= settings, file %s is not trusted.\", path);\n                else {\n                        strv_free_and_replace(arg_syscall_whitelist, settings->syscall_whitelist);\n                        strv_free_and_replace(arg_syscall_blacklist, settings->syscall_blacklist);\n                }\n        }\n\n        for (rl = 0; rl < _RLIMIT_MAX; rl ++) {\n                if ((arg_settings_mask & (SETTING_RLIMIT_FIRST << rl)))\n                        continue;\n\n                if (!settings->rlimit[rl])\n                        continue;\n\n                if (!arg_settings_trusted) {\n                        log_warning(\"Ignoring Limit%s= setting, file '%s' is not trusted.\", rlimit_to_string(rl), path);\n                        continue;\n                }\n\n                free_and_replace(arg_rlimit[rl], settings->rlimit[rl]);\n        }\n\n        if ((arg_settings_mask & SETTING_HOSTNAME) == 0 &&\n            settings->hostname)\n                free_and_replace(arg_hostname, settings->hostname);\n\n        if ((arg_settings_mask & SETTING_NO_NEW_PRIVILEGES) == 0 &&\n            settings->no_new_privileges >= 0)\n                arg_no_new_privileges = settings->no_new_privileges;\n\n        if ((arg_settings_mask & SETTING_OOM_SCORE_ADJUST) == 0 &&\n            settings->oom_score_adjust_set) {\n\n                if (!arg_settings_trusted)\n                        log_warning(\"Ignoring OOMScoreAdjust= setting, file '%s' is not trusted.\", path);\n                else {\n                        arg_oom_score_adjust = settings->oom_score_adjust;\n                        arg_oom_score_adjust_set = true;\n                }\n        }\n\n        if ((arg_settings_mask & SETTING_CPU_AFFINITY) == 0 &&\n            settings->cpuset) {\n\n                if (!arg_settings_trusted)\n                        log_warning(\"Ignoring CPUAffinity= setting, file '%s' is not trusted.\", path);\n                else {\n                        if (arg_cpuset)\n                                CPU_FREE(arg_cpuset);\n                        arg_cpuset = TAKE_PTR(settings->cpuset);\n                        arg_cpuset_ncpus = settings->cpuset_ncpus;\n                }\n        }\n\n        if ((arg_settings_mask & SETTING_RESOLV_CONF) == 0 &&\n            settings->resolv_conf != _RESOLV_CONF_MODE_INVALID)\n                arg_resolv_conf = settings->resolv_conf;\n\n        if ((arg_settings_mask & SETTING_LINK_JOURNAL) == 0 &&\n            settings->link_journal != _LINK_JOURNAL_INVALID) {\n\n                if (!arg_settings_trusted)\n                        log_warning(\"Ignoring journal link setting, file '%s' is not trusted.\", path);\n                else {\n                        arg_link_journal = settings->link_journal;\n                        arg_link_journal_try = settings->link_journal_try;\n                }\n        }\n\n        if ((arg_settings_mask & SETTING_TIMEZONE) == 0 &&\n            settings->timezone != _TIMEZONE_MODE_INVALID)\n                arg_timezone = settings->timezone;\n\n        return 0;\n}\n\nstatic int load_settings(void) {\n        _cleanup_(settings_freep) Settings *settings = NULL;\n        _cleanup_fclose_ FILE *f = NULL;\n        _cleanup_free_ char *p = NULL;\n        const char *fn, *i;\n        int r;\n\n        /* If all settings are masked, there's no point in looking for\n         * the settings file */\n        if ((arg_settings_mask & _SETTINGS_MASK_ALL) == _SETTINGS_MASK_ALL)\n                return 0;\n\n        fn = strjoina(arg_machine, \".nspawn\");\n\n        /* We first look in the admin's directories in /etc and /run */\n        FOREACH_STRING(i, \"/etc/systemd/nspawn\", \"/run/systemd/nspawn\") {\n                _cleanup_free_ char *j = NULL;\n\n                j = strjoin(i, \"/\", fn);\n                if (!j)\n                        return log_oom();\n\n                f = fopen(j, \"re\");\n                if (f) {\n                        p = TAKE_PTR(j);\n\n                        /* By default, we trust configuration from /etc and /run */\n                        if (arg_settings_trusted < 0)\n                                arg_settings_trusted = true;\n\n                        break;\n                }\n\n                if (errno != ENOENT)\n                        return log_error_errno(errno, \"Failed to open %s: %m\", j);\n        }\n\n        if (!f) {\n                /* After that, let's look for a file next to the\n                 * actual image we shall boot. */\n\n                if (arg_image) {\n                        p = file_in_same_dir(arg_image, fn);\n                        if (!p)\n                                return log_oom();\n                } else if (arg_directory) {\n                        p = file_in_same_dir(arg_directory, fn);\n                        if (!p)\n                                return log_oom();\n                }\n\n                if (p) {\n                        f = fopen(p, \"re\");\n                        if (!f && errno != ENOENT)\n                                return log_error_errno(errno, \"Failed to open %s: %m\", p);\n\n                        /* By default, we do not trust configuration from /var/lib/machines */\n                        if (arg_settings_trusted < 0)\n                                arg_settings_trusted = false;\n                }\n        }\n\n        if (!f)\n                return 0;\n\n        log_debug(\"Settings are trusted: %s\", yes_no(arg_settings_trusted));\n\n        r = settings_load(f, p, &settings);\n        if (r < 0)\n                return r;\n\n        return merge_settings(settings, p);\n}\n\nstatic int run(int master,\n               const char* console,\n               DissectedImage *dissected_image,\n               bool interactive,\n               bool secondary,\n               FDSet *fds,\n               char veth_name[IFNAMSIZ], bool *veth_created,\n               union in_addr_union *exposed,\n               pid_t *pid, int *ret) {\n\n        static const struct sigaction sa = {\n                .sa_handler = nop_signal_handler,\n                .sa_flags = SA_NOCLDSTOP|SA_RESTART,\n        };\n\n        _cleanup_(release_lock_file) LockFile uid_shift_lock = LOCK_FILE_INIT;\n        _cleanup_close_ int etc_passwd_lock = -1;\n        _cleanup_close_pair_ int\n                kmsg_socket_pair[2] = { -1, -1 },\n                rtnl_socket_pair[2] = { -1, -1 },\n                pid_socket_pair[2] = { -1, -1 },\n                uuid_socket_pair[2] = { -1, -1 },\n                notify_socket_pair[2] = { -1, -1 },\n                uid_shift_socket_pair[2] = { -1, -1 },\n                unified_cgroup_hierarchy_socket_pair[2] = { -1, -1};\n\n        _cleanup_close_ int notify_socket= -1;\n        _cleanup_(barrier_destroy) Barrier barrier = BARRIER_NULL;\n        _cleanup_(sd_event_source_unrefp) sd_event_source *notify_event_source = NULL;\n        _cleanup_(sd_event_unrefp) sd_event *event = NULL;\n        _cleanup_(pty_forward_freep) PTYForward *forward = NULL;\n        _cleanup_(sd_netlink_unrefp) sd_netlink *rtnl = NULL;\n        _cleanup_(sd_bus_flush_close_unrefp) sd_bus *bus = NULL;\n        ContainerStatus container_status = 0;\n        char last_char = 0;\n        int ifi = 0, r;\n        ssize_t l;\n        sigset_t mask_chld;\n        _cleanup_close_ int netns_fd = -1;\n\n        assert_se(sigemptyset(&mask_chld) == 0);\n        assert_se(sigaddset(&mask_chld, SIGCHLD) == 0);\n\n        if (arg_userns_mode == USER_NAMESPACE_PICK) {\n                /* When we shall pick the UID/GID range, let's first lock /etc/passwd, so that we can safely\n                 * check with getpwuid() if the specific user already exists. Note that /etc might be\n                 * read-only, in which case this will fail with EROFS. But that's really OK, as in that case we\n                 * can be reasonably sure that no users are going to be added. Note that getpwuid() checks are\n                 * really just an extra safety net. We kinda assume that the UID range we allocate from is\n                 * really ours. */\n\n                etc_passwd_lock = take_etc_passwd_lock(NULL);\n                if (etc_passwd_lock < 0 && etc_passwd_lock != -EROFS)\n                        return log_error_errno(etc_passwd_lock, \"Failed to take /etc/passwd lock: %m\");\n        }\n\n        r = barrier_create(&barrier);\n        if (r < 0)\n                return log_error_errno(r, \"Cannot initialize IPC barrier: %m\");\n\n        if (socketpair(AF_UNIX, SOCK_SEQPACKET|SOCK_CLOEXEC, 0, kmsg_socket_pair) < 0)\n                return log_error_errno(errno, \"Failed to create kmsg socket pair: %m\");\n\n        if (socketpair(AF_UNIX, SOCK_SEQPACKET|SOCK_CLOEXEC, 0, rtnl_socket_pair) < 0)\n                return log_error_errno(errno, \"Failed to create rtnl socket pair: %m\");\n\n        if (socketpair(AF_UNIX, SOCK_SEQPACKET|SOCK_CLOEXEC, 0, pid_socket_pair) < 0)\n                return log_error_errno(errno, \"Failed to create pid socket pair: %m\");\n\n        if (socketpair(AF_UNIX, SOCK_SEQPACKET|SOCK_CLOEXEC, 0, uuid_socket_pair) < 0)\n                return log_error_errno(errno, \"Failed to create id socket pair: %m\");\n\n        if (socketpair(AF_UNIX, SOCK_SEQPACKET|SOCK_CLOEXEC, 0, notify_socket_pair) < 0)\n                return log_error_errno(errno, \"Failed to create notify socket pair: %m\");\n\n        if (arg_userns_mode != USER_NAMESPACE_NO)\n                if (socketpair(AF_UNIX, SOCK_SEQPACKET|SOCK_CLOEXEC, 0, uid_shift_socket_pair) < 0)\n                        return log_error_errno(errno, \"Failed to create uid shift socket pair: %m\");\n\n        if (arg_unified_cgroup_hierarchy == CGROUP_UNIFIED_UNKNOWN)\n                if (socketpair(AF_UNIX, SOCK_SEQPACKET|SOCK_CLOEXEC, 0, unified_cgroup_hierarchy_socket_pair) < 0)\n                        return log_error_errno(errno, \"Failed to create unified cgroup socket pair: %m\");\n\n        /* Child can be killed before execv(), so handle SIGCHLD in order to interrupt\n         * parent's blocking calls and give it a chance to call wait() and terminate. */\n        r = sigprocmask(SIG_UNBLOCK, &mask_chld, NULL);\n        if (r < 0)\n                return log_error_errno(errno, \"Failed to change the signal mask: %m\");\n\n        r = sigaction(SIGCHLD, &sa, NULL);\n        if (r < 0)\n                return log_error_errno(errno, \"Failed to install SIGCHLD handler: %m\");\n\n        if (arg_network_namespace_path) {\n                netns_fd = open(arg_network_namespace_path, O_RDONLY|O_NOCTTY|O_CLOEXEC);\n                if (netns_fd < 0)\n                        return log_error_errno(errno, \"Cannot open file %s: %m\", arg_network_namespace_path);\n\n                r = fd_is_network_ns(netns_fd);\n                if (r < 0 && r != -ENOTTY)\n                        return log_error_errno(r, \"Failed to check %s fs type: %m\", arg_network_namespace_path);\n                if (r == 0) {\n                        log_error(\"Path %s doesn't refer to a network namespace\", arg_network_namespace_path);\n                        return -EINVAL;\n                }\n        }\n\n        *pid = raw_clone(SIGCHLD|CLONE_NEWNS);\n        if (*pid < 0)\n                return log_error_errno(errno, \"clone() failed%s: %m\",\n                                       errno == EINVAL ?\n                                       \", do you have namespace support enabled in your kernel? (You need UTS, IPC, PID and NET namespacing built in)\" : \"\");\n\n        if (*pid == 0) {\n                /* The outer child only has a file system namespace. */\n                barrier_set_role(&barrier, BARRIER_CHILD);\n\n                master = safe_close(master);\n\n                kmsg_socket_pair[0] = safe_close(kmsg_socket_pair[0]);\n                rtnl_socket_pair[0] = safe_close(rtnl_socket_pair[0]);\n                pid_socket_pair[0] = safe_close(pid_socket_pair[0]);\n                uuid_socket_pair[0] = safe_close(uuid_socket_pair[0]);\n                notify_socket_pair[0] = safe_close(notify_socket_pair[0]);\n                uid_shift_socket_pair[0] = safe_close(uid_shift_socket_pair[0]);\n                unified_cgroup_hierarchy_socket_pair[0] = safe_close(unified_cgroup_hierarchy_socket_pair[0]);\n\n                (void) reset_all_signal_handlers();\n                (void) reset_signal_mask();\n\n                r = outer_child(&barrier,\n                                arg_directory,\n                                console,\n                                dissected_image,\n                                interactive,\n                                secondary,\n                                pid_socket_pair[1],\n                                uuid_socket_pair[1],\n                                notify_socket_pair[1],\n                                kmsg_socket_pair[1],\n                                rtnl_socket_pair[1],\n                                uid_shift_socket_pair[1],\n                                unified_cgroup_hierarchy_socket_pair[1],\n                                fds,\n                                netns_fd);\n                if (r < 0)\n                        _exit(EXIT_FAILURE);\n\n                _exit(EXIT_SUCCESS);\n        }\n\n        barrier_set_role(&barrier, BARRIER_PARENT);\n\n        fds = fdset_free(fds);\n\n        kmsg_socket_pair[1] = safe_close(kmsg_socket_pair[1]);\n        rtnl_socket_pair[1] = safe_close(rtnl_socket_pair[1]);\n        pid_socket_pair[1] = safe_close(pid_socket_pair[1]);\n        uuid_socket_pair[1] = safe_close(uuid_socket_pair[1]);\n        notify_socket_pair[1] = safe_close(notify_socket_pair[1]);\n        uid_shift_socket_pair[1] = safe_close(uid_shift_socket_pair[1]);\n        unified_cgroup_hierarchy_socket_pair[1] = safe_close(unified_cgroup_hierarchy_socket_pair[1]);\n\n        if (arg_userns_mode != USER_NAMESPACE_NO) {\n                /* The child just let us know the UID shift it might have read from the image. */\n                l = recv(uid_shift_socket_pair[0], &arg_uid_shift, sizeof arg_uid_shift, 0);\n                if (l < 0)\n                        return log_error_errno(errno, \"Failed to read UID shift: %m\");\n                if (l != sizeof arg_uid_shift) {\n                        log_error(\"Short read while reading UID shift.\");\n                        return -EIO;\n                }\n\n                if (arg_userns_mode == USER_NAMESPACE_PICK) {\n                        /* If we are supposed to pick the UID shift, let's try to use the shift read from the\n                         * image, but if that's already in use, pick a new one, and report back to the child,\n                         * which one we now picked. */\n\n                        r = uid_shift_pick(&arg_uid_shift, &uid_shift_lock);\n                        if (r < 0)\n                                return log_error_errno(r, \"Failed to pick suitable UID/GID range: %m\");\n\n                        l = send(uid_shift_socket_pair[0], &arg_uid_shift, sizeof arg_uid_shift, MSG_NOSIGNAL);\n                        if (l < 0)\n                                return log_error_errno(errno, \"Failed to send UID shift: %m\");\n                        if (l != sizeof arg_uid_shift) {\n                                log_error(\"Short write while writing UID shift.\");\n                                return -EIO;\n                        }\n                }\n        }\n\n        if (arg_unified_cgroup_hierarchy == CGROUP_UNIFIED_UNKNOWN) {\n                /* The child let us know the support cgroup mode it might have read from the image. */\n                l = recv(unified_cgroup_hierarchy_socket_pair[0], &arg_unified_cgroup_hierarchy, sizeof(arg_unified_cgroup_hierarchy), 0);\n                if (l < 0)\n                        return log_error_errno(errno, \"Failed to read cgroup mode: %m\");\n                if (l != sizeof(arg_unified_cgroup_hierarchy)) {\n                        log_error(\"Short read while reading cgroup mode.\");\n                        return -EIO;\n                }\n        }\n\n        /* Wait for the outer child. */\n        r = wait_for_terminate_and_check(\"(sd-namespace)\", *pid, WAIT_LOG_ABNORMAL);\n        if (r < 0)\n                return r;\n        if (r != EXIT_SUCCESS)\n                return -EIO;\n\n        /* And now retrieve the PID of the inner child. */\n        l = recv(pid_socket_pair[0], pid, sizeof *pid, 0);\n        if (l < 0)\n                return log_error_errno(errno, \"Failed to read inner child PID: %m\");\n        if (l != sizeof *pid) {\n                log_error(\"Short read while reading inner child PID.\");\n                return -EIO;\n        }\n\n        /* We also retrieve container UUID in case it was generated by outer child */\n        l = recv(uuid_socket_pair[0], &arg_uuid, sizeof arg_uuid, 0);\n        if (l < 0)\n                return log_error_errno(errno, \"Failed to read container machine ID: %m\");\n        if (l != sizeof(arg_uuid)) {\n                log_error(\"Short read while reading container machined ID.\");\n                return -EIO;\n        }\n\n        /* We also retrieve the socket used for notifications generated by outer child */\n        notify_socket = receive_one_fd(notify_socket_pair[0], 0);\n        if (notify_socket < 0)\n                return log_error_errno(notify_socket,\n                                       \"Failed to receive notification socket from the outer child: %m\");\n\n        log_debug(\"Init process invoked as PID \"PID_FMT, *pid);\n\n        if (arg_userns_mode != USER_NAMESPACE_NO) {\n                if (!barrier_place_and_sync(&barrier)) { /* #1 */\n                        log_error(\"Child died too early.\");\n                        return -ESRCH;\n                }\n\n                r = setup_uid_map(*pid);\n                if (r < 0)\n                        return r;\n\n                (void) barrier_place(&barrier); /* #2 */\n        }\n\n        if (arg_private_network) {\n                if (!arg_network_namespace_path) {\n                        /* Wait until the child has unshared its network namespace. */\n                        if (!barrier_place_and_sync(&barrier)) { /* #3 */\n                                log_error(\"Child died too early\");\n                                return -ESRCH;\n                        }\n                }\n\n                r = move_network_interfaces(*pid, arg_network_interfaces);\n                if (r < 0)\n                        return r;\n\n                if (arg_network_veth) {\n                        r = setup_veth(arg_machine, *pid, veth_name,\n                                       arg_network_bridge || arg_network_zone);\n                        if (r < 0)\n                                return r;\n                        else if (r > 0)\n                                ifi = r;\n\n                        if (arg_network_bridge) {\n                                /* Add the interface to a bridge */\n                                r = setup_bridge(veth_name, arg_network_bridge, false);\n                                if (r < 0)\n                                        return r;\n                                if (r > 0)\n                                        ifi = r;\n                        } else if (arg_network_zone) {\n                                /* Add the interface to a bridge, possibly creating it */\n                                r = setup_bridge(veth_name, arg_network_zone, true);\n                                if (r < 0)\n                                        return r;\n                                if (r > 0)\n                                        ifi = r;\n                        }\n                }\n\n                r = setup_veth_extra(arg_machine, *pid, arg_network_veth_extra);\n                if (r < 0)\n                        return r;\n\n                /* We created the primary and extra veth links now; let's remember this, so that we know to\n                   remove them later on. Note that we don't bother with removing veth links that were created\n                   here when their setup failed half-way, because in that case the kernel should be able to\n                   remove them on its own, since they cannot be referenced by anything yet. */\n                *veth_created = true;\n\n                r = setup_macvlan(arg_machine, *pid, arg_network_macvlan);\n                if (r < 0)\n                        return r;\n\n                r = setup_ipvlan(arg_machine, *pid, arg_network_ipvlan);\n                if (r < 0)\n                        return r;\n        }\n\n        if (arg_register || !arg_keep_unit) {\n                r = sd_bus_default_system(&bus);\n                if (r < 0)\n                        return log_error_errno(r, \"Failed to open system bus: %m\");\n        }\n\n        if (!arg_keep_unit) {\n                /* When a new scope is created for this container, then we'll be registered as its controller, in which\n                 * case PID 1 will send us a friendly RequestStop signal, when it is asked to terminate the\n                 * scope. Let's hook into that, and cleanly shut down the container, and print a friendly message. */\n\n                r = sd_bus_match_signal_async(\n                                bus,\n                                NULL,\n                                \"org.freedesktop.systemd1\",\n                                NULL,\n                                \"org.freedesktop.systemd1.Scope\",\n                                \"RequestStop\",\n                                on_request_stop, NULL, PID_TO_PTR(*pid));\n                if (r < 0)\n                        return log_error_errno(r, \"Failed to request RequestStop match: %m\");\n        }\n\n        if (arg_register) {\n                r = register_machine(\n                                bus,\n                                arg_machine,\n                                *pid,\n                                arg_directory,\n                                arg_uuid,\n                                ifi,\n                                arg_slice,\n                                arg_custom_mounts, arg_n_custom_mounts,\n                                arg_kill_signal,\n                                arg_property,\n                                arg_keep_unit,\n                                arg_container_service_name);\n                if (r < 0)\n                        return r;\n\n        } else if (!arg_keep_unit) {\n                r = allocate_scope(\n                                bus,\n                                arg_machine,\n                                *pid,\n                                arg_slice,\n                                arg_custom_mounts, arg_n_custom_mounts,\n                                arg_kill_signal,\n                                arg_property);\n                if (r < 0)\n                        return r;\n\n        } else if (arg_slice || arg_property)\n                log_notice(\"Machine and scope registration turned off, --slice= and --property= settings will have no effect.\");\n\n        r = sync_cgroup(*pid, arg_unified_cgroup_hierarchy, arg_uid_shift);\n        if (r < 0)\n                return r;\n\n        r = create_subcgroup(*pid, arg_keep_unit, arg_unified_cgroup_hierarchy);\n        if (r < 0)\n                return r;\n\n        r = chown_cgroup(*pid, arg_unified_cgroup_hierarchy, arg_uid_shift);\n        if (r < 0)\n                return r;\n\n        /* Notify the child that the parent is ready with all\n         * its setup (including cgroup-ification), and that\n         * the child can now hand over control to the code to\n         * run inside the container. */\n        (void) barrier_place(&barrier); /* #4 */\n\n        /* Block SIGCHLD here, before notifying child.\n         * process_pty() will handle it with the other signals. */\n        assert_se(sigprocmask(SIG_BLOCK, &mask_chld, NULL) >= 0);\n\n        /* Reset signal to default */\n        r = default_signals(SIGCHLD, -1);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to reset SIGCHLD: %m\");\n\n        r = sd_event_new(&event);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to get default event source: %m\");\n\n        (void) sd_event_set_watchdog(event, true);\n\n        if (bus) {\n                r = sd_bus_attach_event(bus, event, 0);\n                if (r < 0)\n                        return log_error_errno(r, \"Failed to attach bus to event loop: %m\");\n        }\n\n        r = setup_sd_notify_parent(event, notify_socket, PID_TO_PTR(*pid), &notify_event_source);\n        if (r < 0)\n                return r;\n\n        /* Let the child know that we are ready and wait that the child is completely ready now. */\n        if (!barrier_place_and_sync(&barrier)) { /* #5 */\n                log_error(\"Child died too early.\");\n                return -ESRCH;\n        }\n\n        /* At this point we have made use of the UID we picked, and thus nss-mymachines\n         * will make them appear in getpwuid(), thus we can release the /etc/passwd lock. */\n        etc_passwd_lock = safe_close(etc_passwd_lock);\n\n        sd_notifyf(false,\n                   \"STATUS=Container running.\\n\"\n                   \"X_NSPAWN_LEADER_PID=\" PID_FMT, *pid);\n        if (!arg_notify_ready)\n                (void) sd_notify(false, \"READY=1\\n\");\n\n        if (arg_kill_signal > 0) {\n                /* Try to kill the init system on SIGINT or SIGTERM */\n                (void) sd_event_add_signal(event, NULL, SIGINT, on_orderly_shutdown, PID_TO_PTR(*pid));\n                (void) sd_event_add_signal(event, NULL, SIGTERM, on_orderly_shutdown, PID_TO_PTR(*pid));\n        } else {\n                /* Immediately exit */\n                (void) sd_event_add_signal(event, NULL, SIGINT, NULL, NULL);\n                (void) sd_event_add_signal(event, NULL, SIGTERM, NULL, NULL);\n        }\n\n        /* Exit when the child exits */\n        (void) sd_event_add_signal(event, NULL, SIGCHLD, on_sigchld, PID_TO_PTR(*pid));\n\n        if (arg_expose_ports) {\n                r = expose_port_watch_rtnl(event, rtnl_socket_pair[0], on_address_change, exposed, &rtnl);\n                if (r < 0)\n                        return r;\n\n                (void) expose_port_execute(rtnl, arg_expose_ports, exposed);\n        }\n\n        rtnl_socket_pair[0] = safe_close(rtnl_socket_pair[0]);\n\n        r = pty_forward_new(event, master,\n                            PTY_FORWARD_IGNORE_VHANGUP | (interactive ? 0 : PTY_FORWARD_READ_ONLY),\n                            &forward);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to create PTY forwarder: %m\");\n\n        r = sd_event_loop(event);\n        if (r < 0)\n                return log_error_errno(r, \"Failed to run event loop: %m\");\n\n        pty_forward_get_last_char(forward, &last_char);\n\n        forward = pty_forward_free(forward);\n\n        if (!arg_quiet && last_char != '\\n')\n                putc('\\n', stdout);\n\n        /* Kill if it is not dead yet anyway */\n        if (arg_register && !arg_keep_unit && bus)\n                terminate_machine(bus, *pid);\n\n        /* Normally redundant, but better safe than sorry */\n        (void) kill(*pid, SIGKILL);\n\n        r = wait_for_container(*pid, &container_status);\n        *pid = 0;\n\n        if (r < 0)\n                /* We failed to wait for the container, or the container exited abnormally. */\n                return r;\n        if (r > 0 || container_status == CONTAINER_TERMINATED) {\n                /* r > 0 \u2192 The container exited with a non-zero status.\n                 *         As a special case, we need to replace 133 with a different value,\n                 *         because 133 is special-cased in the service file to reboot the container.\n                 * otherwise \u2192 The container exited with zero status and a reboot was not requested.\n                 */\n                if (r == EXIT_FORCE_RESTART)\n                        r = EXIT_FAILURE; /* replace 133 with the general failure code */\n                *ret = r;\n                return 0; /* finito */\n        }\n\n        /* CONTAINER_REBOOTED, loop again */\n\n        if (arg_keep_unit) {\n                /* Special handling if we are running as a service: instead of simply\n                 * restarting the machine we want to restart the entire service, so let's\n                 * inform systemd about this with the special exit code 133. The service\n                 * file uses RestartForceExitStatus=133 so that this results in a full\n                 * nspawn restart. This is necessary since we might have cgroup parameters\n                 * set we want to have flushed out. */\n                *ret = EXIT_FORCE_RESTART;\n                return 0; /* finito */\n        }\n\n        expose_port_flush(arg_expose_ports, exposed);\n\n        (void) remove_veth_links(veth_name, arg_network_veth_extra);\n        *veth_created = false;\n        return 1; /* loop again */\n}\n\nstatic int initialize_rlimits(void) {\n        /* The default resource limits the kernel passes to PID 1, as per kernel 4.16. Let's pass our container payload\n         * the same values as the kernel originally passed to PID 1, in order to minimize differences between host and\n         * container execution environments. */\n\n        static const struct rlimit kernel_defaults[_RLIMIT_MAX] = {\n                [RLIMIT_AS]       = { RLIM_INFINITY, RLIM_INFINITY },\n                [RLIMIT_CORE]     = { 0,             RLIM_INFINITY },\n                [RLIMIT_CPU]      = { RLIM_INFINITY, RLIM_INFINITY },\n                [RLIMIT_DATA]     = { RLIM_INFINITY, RLIM_INFINITY },\n                [RLIMIT_FSIZE]    = { RLIM_INFINITY, RLIM_INFINITY },\n                [RLIMIT_LOCKS]    = { RLIM_INFINITY, RLIM_INFINITY },\n                [RLIMIT_MEMLOCK]  = { 65536,         65536         },\n                [RLIMIT_MSGQUEUE] = { 819200,        819200        },\n                [RLIMIT_NICE]     = { 0,             0             },\n                [RLIMIT_NOFILE]   = { 1024,          4096          },\n                [RLIMIT_RSS]      = { RLIM_INFINITY, RLIM_INFINITY },\n                [RLIMIT_RTPRIO]   = { 0,             0             },\n                [RLIMIT_RTTIME]   = { RLIM_INFINITY, RLIM_INFINITY },\n                [RLIMIT_STACK]    = { 8388608,       RLIM_INFINITY },\n\n                /* The kernel scales the default for RLIMIT_NPROC and RLIMIT_SIGPENDING based on the system's amount of\n                 * RAM. To provide best compatibility we'll read these limits off PID 1 instead of hardcoding them\n                 * here. This is safe as we know that PID 1 doesn't change these two limits and thus the original\n                 * kernel's initialization should still be valid during runtime \u2014 at least if PID 1 is systemd. Note\n                 * that PID 1 changes a number of other resource limits during early initialization which is why we\n                 * don't read the other limits from PID 1 but prefer the static table above. */\n        };\n\n        int rl;\n\n        for (rl = 0; rl < _RLIMIT_MAX; rl++) {\n                /* Let's only fill in what the user hasn't explicitly configured anyway */\n                if ((arg_settings_mask & (SETTING_RLIMIT_FIRST << rl)) == 0) {\n                        const struct rlimit *v;\n                        struct rlimit buffer;\n\n                        if (IN_SET(rl, RLIMIT_NPROC, RLIMIT_SIGPENDING)) {\n                                /* For these two let's read the limits off PID 1. See above for an explanation. */\n\n                                if (prlimit(1, rl, NULL, &buffer) < 0)\n                                        return log_error_errno(errno, \"Failed to read resource limit RLIMIT_%s of PID 1: %m\", rlimit_to_string(rl));\n\n                                v = &buffer;\n                        } else\n                                v = kernel_defaults + rl;\n\n                        arg_rlimit[rl] = newdup(struct rlimit, v, 1);\n                        if (!arg_rlimit[rl])\n                                return log_oom();\n                }\n\n                if (DEBUG_LOGGING) {\n                        _cleanup_free_ char *k = NULL;\n\n                        (void) rlimit_format(arg_rlimit[rl], &k);\n                        log_debug(\"Setting RLIMIT_%s to %s.\", rlimit_to_string(rl), k);\n                }\n        }\n\n        return 0;\n}\n\nint main(int argc, char *argv[]) {\n        _cleanup_free_ char *console = NULL;\n        _cleanup_close_ int master = -1;\n        _cleanup_fdset_free_ FDSet *fds = NULL;\n        int r, n_fd_passed, ret = EXIT_SUCCESS;\n        char veth_name[IFNAMSIZ] = \"\";\n        bool secondary = false, remove_directory = false, remove_image = false;\n        pid_t pid = 0;\n        union in_addr_union exposed = {};\n        _cleanup_(release_lock_file) LockFile tree_global_lock = LOCK_FILE_INIT, tree_local_lock = LOCK_FILE_INIT;\n        bool interactive, veth_created = false, remove_tmprootdir = false;\n        char tmprootdir[] = \"/tmp/nspawn-root-XXXXXX\";\n        _cleanup_(loop_device_unrefp) LoopDevice *loop = NULL;\n        _cleanup_(decrypted_image_unrefp) DecryptedImage *decrypted_image = NULL;\n        _cleanup_(dissected_image_unrefp) DissectedImage *dissected_image = NULL;\n\n        log_parse_environment();\n        log_open();\n\n        /* Make sure rename_process() in the stub init process can work */\n        saved_argv = argv;\n        saved_argc = argc;\n\n        r = parse_argv(argc, argv);\n        if (r <= 0)\n                goto finish;\n\n        r = must_be_root();\n        if (r < 0)\n                goto finish;\n\n        r = initialize_rlimits();\n        if (r < 0)\n                goto finish;\n\n        r = determine_names();\n        if (r < 0)\n                goto finish;\n\n        r = load_settings();\n        if (r < 0)\n                goto finish;\n\n        r = verify_arguments();\n        if (r < 0)\n                goto finish;\n\n        r = detect_unified_cgroup_hierarchy_from_environment();\n        if (r < 0)\n                goto finish;\n\n        n_fd_passed = sd_listen_fds(false);\n        if (n_fd_passed > 0) {\n                r = fdset_new_listen_fds(&fds, false);\n                if (r < 0) {\n                        log_error_errno(r, \"Failed to collect file descriptors: %m\");\n                        goto finish;\n                }\n        }\n\n        /* The \"default\" umask. This is appropriate for most file and directory\n        * operations performed by nspawn, and is the umask that will be used for\n        * the child. Functions like copy_devnodes() change the umask temporarily. */\n        umask(0022);\n\n        if (arg_directory) {\n                assert(!arg_image);\n\n                if (path_equal(arg_directory, \"/\") && !arg_ephemeral) {\n                        log_error(\"Spawning container on root directory is not supported. Consider using --ephemeral.\");\n                        r = -EINVAL;\n                        goto finish;\n                }\n\n                if (arg_ephemeral) {\n                        _cleanup_free_ char *np = NULL;\n\n                        r = chase_symlinks_and_update(&arg_directory, 0);\n                        if (r < 0)\n                                goto finish;\n\n                        /* If the specified path is a mount point we\n                         * generate the new snapshot immediately\n                         * inside it under a random name. However if\n                         * the specified is not a mount point we\n                         * create the new snapshot in the parent\n                         * directory, just next to it. */\n                        r = path_is_mount_point(arg_directory, NULL, 0);\n                        if (r < 0) {\n                                log_error_errno(r, \"Failed to determine whether directory %s is mount point: %m\", arg_directory);\n                                goto finish;\n                        }\n                        if (r > 0)\n                                r = tempfn_random_child(arg_directory, \"machine.\", &np);\n                        else\n                                r = tempfn_random(arg_directory, \"machine.\", &np);\n                        if (r < 0) {\n                                log_error_errno(r, \"Failed to generate name for directory snapshot: %m\");\n                                goto finish;\n                        }\n\n                        r = image_path_lock(np, (arg_read_only ? LOCK_SH : LOCK_EX) | LOCK_NB, &tree_global_lock, &tree_local_lock);\n                        if (r < 0) {\n                                log_error_errno(r, \"Failed to lock %s: %m\", np);\n                                goto finish;\n                        }\n\n                        r = btrfs_subvol_snapshot(arg_directory, np,\n                                                  (arg_read_only ? BTRFS_SNAPSHOT_READ_ONLY : 0) |\n                                                  BTRFS_SNAPSHOT_FALLBACK_COPY |\n                                                  BTRFS_SNAPSHOT_FALLBACK_DIRECTORY |\n                                                  BTRFS_SNAPSHOT_RECURSIVE |\n                                                  BTRFS_SNAPSHOT_QUOTA);\n                        if (r < 0) {\n                                log_error_errno(r, \"Failed to create snapshot %s from %s: %m\", np, arg_directory);\n                                goto finish;\n                        }\n\n                        free_and_replace(arg_directory, np);\n\n                        remove_directory = true;\n\n                } else {\n                        r = chase_symlinks_and_update(&arg_directory, arg_template ? CHASE_NONEXISTENT : 0);\n                        if (r < 0)\n                                goto finish;\n\n                        r = image_path_lock(arg_directory, (arg_read_only ? LOCK_SH : LOCK_EX) | LOCK_NB, &tree_global_lock, &tree_local_lock);\n                        if (r == -EBUSY) {\n                                log_error_errno(r, \"Directory tree %s is currently busy.\", arg_directory);\n                                goto finish;\n                        }\n                        if (r < 0) {\n                                log_error_errno(r, \"Failed to lock %s: %m\", arg_directory);\n                                goto finish;\n                        }\n\n                        if (arg_template) {\n                                r = chase_symlinks_and_update(&arg_template, 0);\n                                if (r < 0)\n                                        goto finish;\n\n                                r = btrfs_subvol_snapshot(arg_template, arg_directory,\n                                                          (arg_read_only ? BTRFS_SNAPSHOT_READ_ONLY : 0) |\n                                                          BTRFS_SNAPSHOT_FALLBACK_COPY |\n                                                          BTRFS_SNAPSHOT_FALLBACK_DIRECTORY |\n                                                          BTRFS_SNAPSHOT_FALLBACK_IMMUTABLE |\n                                                          BTRFS_SNAPSHOT_RECURSIVE |\n                                                          BTRFS_SNAPSHOT_QUOTA);\n                                if (r == -EEXIST) {\n                                        if (!arg_quiet)\n                                                log_info(\"Directory %s already exists, not populating from template %s.\", arg_directory, arg_template);\n                                } else if (r < 0) {\n                                        log_error_errno(r, \"Couldn't create snapshot %s from %s: %m\", arg_directory, arg_template);\n                                        goto finish;\n                                } else {\n                                        if (!arg_quiet)\n                                                log_info(\"Populated %s from template %s.\", arg_directory, arg_template);\n                                }\n                        }\n                }\n\n                if (arg_start_mode == START_BOOT) {\n                        const char *p;\n\n                        if (arg_pivot_root_new)\n                                p = prefix_roota(arg_directory, arg_pivot_root_new);\n                        else\n                                p = arg_directory;\n\n                        if (path_is_os_tree(p) <= 0) {\n                                log_error(\"Directory %s doesn't look like an OS root directory (os-release file is missing). Refusing.\", p);\n                                r = -EINVAL;\n                                goto finish;\n                        }\n                } else {\n                        const char *p, *q;\n\n                        if (arg_pivot_root_new)\n                                p = prefix_roota(arg_directory, arg_pivot_root_new);\n                        else\n                                p = arg_directory;\n\n                        q = strjoina(p, \"/usr/\");\n\n                        if (laccess(q, F_OK) < 0) {\n                                log_error(\"Directory %s doesn't look like it has an OS tree. Refusing.\", p);\n                                r = -EINVAL;\n                                goto finish;\n                        }\n                }\n\n        } else {\n                assert(arg_image);\n                assert(!arg_template);\n\n                r = chase_symlinks_and_update(&arg_image, 0);\n                if (r < 0)\n                        goto finish;\n\n                if (arg_ephemeral)  {\n                        _cleanup_free_ char *np = NULL;\n\n                        r = tempfn_random(arg_image, \"machine.\", &np);\n                        if (r < 0) {\n                                log_error_errno(r, \"Failed to generate name for image snapshot: %m\");\n                                goto finish;\n                        }\n\n                        r = image_path_lock(np, (arg_read_only ? LOCK_SH : LOCK_EX) | LOCK_NB, &tree_global_lock, &tree_local_lock);\n                        if (r < 0) {\n                                r = log_error_errno(r, \"Failed to create image lock: %m\");\n                                goto finish;\n                        }\n\n                        r = copy_file(arg_image, np, O_EXCL, arg_read_only ? 0400 : 0600, FS_NOCOW_FL, COPY_REFLINK);\n                        if (r < 0) {\n                                r = log_error_errno(r, \"Failed to copy image file: %m\");\n                                goto finish;\n                        }\n\n                        free_and_replace(arg_image, np);\n\n                        remove_image = true;\n                } else {\n                        r = image_path_lock(arg_image, (arg_read_only ? LOCK_SH : LOCK_EX) | LOCK_NB, &tree_global_lock, &tree_local_lock);\n                        if (r == -EBUSY) {\n                                r = log_error_errno(r, \"Disk image %s is currently busy.\", arg_image);\n                                goto finish;\n                        }\n                        if (r < 0) {\n                                r = log_error_errno(r, \"Failed to create image lock: %m\");\n                                goto finish;\n                        }\n\n                        if (!arg_root_hash) {\n                                r = root_hash_load(arg_image, &arg_root_hash, &arg_root_hash_size);\n                                if (r < 0) {\n                                        log_error_errno(r, \"Failed to load root hash file for %s: %m\", arg_image);\n                                        goto finish;\n                                }\n                        }\n                }\n\n                if (!mkdtemp(tmprootdir)) {\n                        r = log_error_errno(errno, \"Failed to create temporary directory: %m\");\n                        goto finish;\n                }\n\n                remove_tmprootdir = true;\n\n                arg_directory = strdup(tmprootdir);\n                if (!arg_directory) {\n                        r = log_oom();\n                        goto finish;\n                }\n\n                r = loop_device_make_by_path(arg_image, arg_read_only ? O_RDONLY : O_RDWR, &loop);\n                if (r < 0) {\n                        log_error_errno(r, \"Failed to set up loopback block device: %m\");\n                        goto finish;\n                }\n\n                r = dissect_image_and_warn(\n                                loop->fd,\n                                arg_image,\n                                arg_root_hash, arg_root_hash_size,\n                                DISSECT_IMAGE_REQUIRE_ROOT,\n                                &dissected_image);\n                if (r == -ENOPKG) {\n                        /* dissected_image_and_warn() already printed a brief error message. Extend on that with more details */\n                        log_notice(\"Note that the disk image needs to\\n\"\n                                   \"    a) either contain only a single MBR partition of type 0x83 that is marked bootable\\n\"\n                                   \"    b) or contain a single GPT partition of type 0FC63DAF-8483-4772-8E79-3D69D8477DE4\\n\"\n                                   \"    c) or follow http://www.freedesktop.org/wiki/Specifications/DiscoverablePartitionsSpec/\\n\"\n                                   \"    d) or contain a file system without a partition table\\n\"\n                                   \"in order to be bootable with systemd-nspawn.\");\n                        goto finish;\n                }\n                if (r < 0)\n                        goto finish;\n\n                if (!arg_root_hash && dissected_image->can_verity)\n                        log_notice(\"Note: image %s contains verity information, but no root hash specified! Proceeding without integrity checking.\", arg_image);\n\n                r = dissected_image_decrypt_interactively(dissected_image, NULL, arg_root_hash, arg_root_hash_size, 0, &decrypted_image);\n                if (r < 0)\n                        goto finish;\n\n                /* Now that we mounted the image, let's try to remove it again, if it is ephemeral */\n                if (remove_image && unlink(arg_image) >= 0)\n                        remove_image = false;\n        }\n\n        r = custom_mount_prepare_all(arg_directory, arg_custom_mounts, arg_n_custom_mounts);\n        if (r < 0)\n                goto finish;\n\n        interactive =\n                isatty(STDIN_FILENO) > 0 &&\n                isatty(STDOUT_FILENO) > 0;\n\n        master = posix_openpt(O_RDWR|O_NOCTTY|O_CLOEXEC|O_NONBLOCK);\n        if (master < 0) {\n                r = log_error_errno(errno, \"Failed to acquire pseudo tty: %m\");\n                goto finish;\n        }\n\n        r = ptsname_malloc(master, &console);\n        if (r < 0) {\n                r = log_error_errno(r, \"Failed to determine tty name: %m\");\n                goto finish;\n        }\n\n        if (arg_selinux_apifs_context) {\n                r = mac_selinux_apply(console, arg_selinux_apifs_context);\n                if (r < 0)\n                        goto finish;\n        }\n\n        if (unlockpt(master) < 0) {\n                r = log_error_errno(errno, \"Failed to unlock tty: %m\");\n                goto finish;\n        }\n\n        if (!arg_quiet)\n                log_info(\"Spawning container %s on %s.\\nPress ^] three times within 1s to kill container.\",\n                         arg_machine, arg_image ?: arg_directory);\n\n        assert_se(sigprocmask_many(SIG_BLOCK, NULL, SIGCHLD, SIGWINCH, SIGTERM, SIGINT, -1) >= 0);\n\n        if (prctl(PR_SET_CHILD_SUBREAPER, 1, 0, 0, 0) < 0) {\n                r = log_error_errno(errno, \"Failed to become subreaper: %m\");\n                goto finish;\n        }\n\n        for (;;) {\n                r = run(master,\n                        console,\n                        dissected_image,\n                        interactive, secondary,\n                        fds,\n                        veth_name, &veth_created,\n                        &exposed,\n                        &pid, &ret);\n                if (r <= 0)\n                        break;\n        }\n\nfinish:\n        sd_notify(false,\n                  r == 0 && ret == EXIT_FORCE_RESTART ? \"STOPPING=1\\nSTATUS=Restarting...\" :\n                                                        \"STOPPING=1\\nSTATUS=Terminating...\");\n\n        if (pid > 0)\n                (void) kill(pid, SIGKILL);\n\n        /* Try to flush whatever is still queued in the pty */\n        if (master >= 0) {\n                (void) copy_bytes(master, STDOUT_FILENO, (uint64_t) -1, 0);\n                master = safe_close(master);\n        }\n\n        if (pid > 0)\n                (void) wait_for_terminate(pid, NULL);\n\n        pager_close();\n\n        if (remove_directory && arg_directory) {\n                int k;\n\n                k = rm_rf(arg_directory, REMOVE_ROOT|REMOVE_PHYSICAL|REMOVE_SUBVOLUME);\n                if (k < 0)\n                        log_warning_errno(k, \"Cannot remove '%s', ignoring: %m\", arg_directory);\n        }\n\n        if (remove_image && arg_image) {\n                if (unlink(arg_image) < 0)\n                        log_warning_errno(errno, \"Can't remove image file '%s', ignoring: %m\", arg_image);\n        }\n\n        if (remove_tmprootdir) {\n                if (rmdir(tmprootdir) < 0)\n                        log_debug_errno(errno, \"Can't remove temporary root directory '%s', ignoring: %m\", tmprootdir);\n        }\n\n        if (arg_machine) {\n                const char *p;\n\n                p = strjoina(\"/run/systemd/nspawn/propagate/\", arg_machine);\n                (void) rm_rf(p, REMOVE_ROOT);\n        }\n\n        expose_port_flush(arg_expose_ports, &exposed);\n\n        if (veth_created)\n                (void) remove_veth_links(veth_name, arg_network_veth_extra);\n        (void) remove_bridge(arg_network_zone);\n\n        free(arg_directory);\n        free(arg_template);\n        free(arg_image);\n        free(arg_machine);\n        free(arg_hostname);\n        free(arg_user);\n        free(arg_pivot_root_new);\n        free(arg_pivot_root_old);\n        free(arg_chdir);\n        strv_free(arg_setenv);\n        free(arg_network_bridge);\n        strv_free(arg_network_interfaces);\n        strv_free(arg_network_macvlan);\n        strv_free(arg_network_ipvlan);\n        strv_free(arg_network_veth_extra);\n        strv_free(arg_parameters);\n        free(arg_network_zone);\n        free(arg_network_namespace_path);\n        strv_free(arg_property);\n        custom_mount_free_all(arg_custom_mounts, arg_n_custom_mounts);\n        expose_port_free_all(arg_expose_ports);\n        free(arg_root_hash);\n        rlimit_free_all(arg_rlimit);\n        strv_free(arg_syscall_whitelist);\n        strv_free(arg_syscall_blacklist);\n        arg_cpuset = cpu_set_mfree(arg_cpuset);\n\n        return r < 0 ? EXIT_FAILURE : ret;\n}\n"}}, "reports": [{"events": [{"location": {"line": 1771, "col": 9, "file": 1}, "message": "Value stored to 'u' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "9b8d624e2c5e8c41dd2b7c8f4d0f72d5", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 1879, "col": 9, "file": 1}, "message": "Value stored to 'u' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "152373749f5c3e06a18d40d6e5d56e26", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 1928, "col": 9, "file": 1}, "message": "Value stored to 'u' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "8c97d4c98c4601605c416c8c16c38e84", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 2613, "col": 9, "file": 1}, "message": "Value stored to 'kmsg_socket' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "26f2c9974b65bf43c7f0c44d27904077", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 2625, "col": 17, "file": 1}, "message": "Value stored to 'rtnl_socket' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "5c43b7f0e78f5a43823bbba6bee22c2a", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 2539, "col": 9, "file": 1}, "message": "Assuming 'barrier' is non-null"}, {"location": {"line": 2540, "col": 9, "file": 1}, "message": "Assuming 'directory' is non-null"}, {"location": {"line": 2541, "col": 9, "file": 1}, "message": "Assuming 'kmsg_socket' is >= 0"}, {"location": {"line": 2543, "col": 13, "file": 1}, "message": "Assuming 'arg_userns_mode' is equal to USER_NAMESPACE_NO"}, {"location": {"line": 2555, "col": 13, "file": 1}, "message": "Assuming 'r' is >= 0"}, {"location": {"line": 2563, "col": 13, "file": 1}, "message": "Assuming 'r' is >= 0"}, {"location": {"line": 2566, "col": 13, "file": 1}, "message": "Assuming 'arg_network_namespace_path' is non-null"}, {"location": {"line": 2576, "col": 13, "file": 1}, "message": "Assuming 'r' is >= 0"}, {"location": {"line": 2581, "col": 13, "file": 1}, "message": "Assuming the condition is false"}, {"location": {"line": 2586, "col": 13, "file": 1}, "message": "Assuming 'arg_use_cgns' is 0"}, {"location": {"line": 2602, "col": 21, "file": 1}, "message": "Assuming 'r' is >= 0"}, {"location": {"line": 2607, "col": 13, "file": 1}, "message": "Assuming 'r' is >= 0"}, {"location": {"line": 2611, "col": 13, "file": 1}, "message": "Assuming 'r' is >= 0"}, {"location": {"line": 2615, "col": 13, "file": 1}, "message": "Assuming the condition is false"}, {"location": {"line": 2618, "col": 13, "file": 1}, "message": "Assuming 'arg_private_network' is 0"}, {"location": {"line": 2621, "col": 13, "file": 1}, "message": "Assuming 'arg_expose_ports' is null"}, {"location": {"line": 2628, "col": 13, "file": 1}, "message": "Assuming 'arg_oom_score_adjust_set' is 0"}, {"location": {"line": 2634, "col": 13, "file": 1}, "message": "Assuming 'arg_cpuset' is null"}, {"location": {"line": 2639, "col": 13, "file": 1}, "message": "Assuming 'r' is >= 0"}, {"location": {"line": 2644, "col": 13, "file": 1}, "message": "Assuming 'arg_personality' is equal to PERSONALITY_INVALID"}, {"location": {"line": 2648, "col": 20, "file": 1}, "message": "Assuming 'secondary' is 0"}, {"location": {"line": 2661, "col": 13, "file": 1}, "message": "Assuming 'r' is >= 0"}, {"location": {"line": 2664, "col": 13, "file": 1}, "message": "Assuming 'arg_no_new_privileges' is 0"}, {"location": {"line": 2669, "col": 25, "file": 1}, "message": "Entering loop body"}, {"location": {"line": 2669, "col": 25, "file": 1}, "message": "Looping back to the head of the loop"}, {"location": {"line": 2669, "col": 25, "file": 1}, "message": "Entering loop body"}, {"location": {"line": 2669, "col": 25, "file": 1}, "message": "Looping back to the head of the loop"}, {"location": {"line": 2672, "col": 13, "file": 1}, "message": "Assuming the condition is false"}, {"location": {"line": 2675, "col": 60, "file": 1}, "message": "Assuming 'home' is null"}, {"location": {"line": 2675, "col": 14, "file": 1}, "message": "Assuming the condition is false"}, {"location": {"line": 2676, "col": 60, "file": 1}, "message": "Assuming 'arg_user' is null"}, {"location": {"line": 2676, "col": 14, "file": 1}, "message": "Assuming the condition is false"}, {"location": {"line": 2677, "col": 14, "file": 1}, "message": "Assuming the condition is false"}, {"location": {"line": 2682, "col": 13, "file": 1}, "message": "Assuming the condition is false"}, {"location": {"line": 2685, "col": 13, "file": 1}, "message": "Assuming the condition is false"}, {"location": {"line": 2694, "col": 13, "file": 1}, "message": "Assuming the condition is false"}, {"location": {"line": 2698, "col": 13, "file": 1}, "message": "Assuming 'env_use' is non-null"}, {"location": {"line": 2704, "col": 13, "file": 1}, "message": "Assuming the condition is false"}, {"location": {"line": 2709, "col": 13, "file": 1}, "message": "Assuming 'arg_chdir' is null"}, {"location": {"line": 2713, "col": 13, "file": 1}, "message": "Assuming 'arg_start_mode' is not equal to START_PID2"}, {"location": {"line": 2727, "col": 13, "file": 1}, "message": "Assuming 'arg_start_mode' is equal to START_BOOT"}, {"location": {"line": 2734, "col": 21, "file": 1}, "message": "Call to 'alloca' has an allocation size of 0 bytes"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "a5497e2975cbea5f4805d71461a56013", "checkerName": "unix.API", "reviewStatus": null, "severity": "MEDIUM"}, {"events": [{"location": {"line": 2931, "col": 17, "file": 1}, "message": "Value stored to 'unified_cgroup_hierarchy_socket' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "8fe70ad456867e5f242469dd84f5959c", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 3082, "col": 17, "file": 1}, "message": "Value stored to 'pid_socket' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "5384648023e9dec418145a6889a65f9c", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 3083, "col": 17, "file": 1}, "message": "Value stored to 'uuid_socket' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "b391a185d8d7373e37cdfa8f18dd7105", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 3084, "col": 17, "file": 1}, "message": "Value stored to 'notify_socket' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "01bf261f82bd98ad7b31a57e04102802", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 3085, "col": 17, "file": 1}, "message": "Value stored to 'uid_shift_socket' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "a22ec2e93560f7bc9f21ea605f0926a9", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 3124, "col": 9, "file": 1}, "message": "Value stored to 'pid_socket' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "f4e51f499f938d6aa933bde06d23b5bb", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 3125, "col": 9, "file": 1}, "message": "Value stored to 'uuid_socket' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "5424cf1779f502879dba832015fff34d", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 3126, "col": 9, "file": 1}, "message": "Value stored to 'notify_socket' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "a6d8024492578448be89728a275a144d", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 3127, "col": 9, "file": 1}, "message": "Value stored to 'kmsg_socket' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "32670e9a83ed8e5763cd0061e3034d9b", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 3128, "col": 9, "file": 1}, "message": "Value stored to 'rtnl_socket' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "92a663ab047379a898a09946a71059b4", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 3129, "col": 9, "file": 1}, "message": "Value stored to 'netns_fd' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "77164b95220d5599b84ff913a27fe1c3", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 3722, "col": 17, "file": 1}, "message": "Value stored to 'master' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "4eb87e469cd20169fad7ef097da8c619", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 3758, "col": 9, "file": 1}, "message": "Value stored to 'fds' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "2050ec3b389ba4b5bbfca9caafc07aa6", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 4017, "col": 9, "file": 1}, "message": "Value stored to 'etc_passwd_lock' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "50cf1a21e27bab6586b2a4cc9d4c8bd0", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}, {"events": [{"location": {"line": 4533, "col": 17, "file": 1}, "message": "Value stored to 'master' is never read"}], "macros": [], "notes": [], "path": "/media/lavo07/lavo07/systemd-239/src/nspawn/nspawn.c", "reportHash": "713f6af28381b467d3255a2bdd276e5a", "checkerName": "deadcode.DeadStores", "reviewStatus": null, "severity": "LOW"}]};
      window.onload = function() {
        if (!browserCompatible) {
          setNonCompatibleBrowserMessage();
        } else {
          BugViewer.init(data.files, data.reports);
          BugViewer.create();
          BugViewer.initByUrl();
        }
      };
    </script>
  </head>
  <body>
  <div class="container">
    <div id="content">
      <div id="side-bar">
        <div class="header">
          <a href="index.html" class="button">&#8249; Return to List</a>
        </div>
        <div id="report-nav">
          <div class="header">Reports</div>
        </div>
      </div>
      <div id="editor-wrapper">
        <div class="header">
          <div id="file">
            <span class="label">File:</span>
            <span id="file-path"></span>
          </div>
          <div id="checker">
            <span class="label">Checker name:</span>
            <span id="checker-name"></span>
          </div>
          <div id="review-status-wrapper">
            <span class="label">Review status:</span>
            <span id="review-status"></span>
          </div>
        </div>
        <div id="editor"></div>
      </div>
    </div>
  </div>
  </body>
</html>
